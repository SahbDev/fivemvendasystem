<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Vendas FiveM - Sistema de Munições</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ========== ESTILOS GERAIS ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #8e44ff;
      --primary-dark: #5e0fa4;
      --accent: #00cec9;
      --text: #f0f0f0;
      --darker: #0a0a16;
      --dark-card: #1a1a2e;
      --warning: #fdcb6e;
      --danger: #ff4c4c;
      --secondary: #ff6b6b;
      --light: #fff;
      --text-secondary: #c3a6ff;
      --success: #00b894;
      --comissao: #fdcb6e;
      --fac: #00cec9;
    }

    body {
      background: linear-gradient(135deg, var(--darker), #0c1e3e);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* ========== TELA DE LOGIN ========== */
    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 0;
      background: radial-gradient(circle at 10% 20%, rgba(142, 68, 255, 0.1) 0%, transparent 20%),
                  radial-gradient(circle at 90% 80%, rgba(0, 206, 201, 0.1) 0%, transparent 20%);
    }

    .login-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      background: rgba(26, 26, 46, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 50px 60px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
                  0 0 50px rgba(142, 68, 255, 0.3),
                  inset 0 0 15px rgba(142, 68, 255, 0.2);
      border: 1px solid rgba(142, 68, 255, 0.5);
      opacity: 1;
      transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: loginEntrance 1.2s ease-out forwards;
    }

    @keyframes loginEntrance {
      0% { transform: translate(-50%, -40%); opacity: 0; }
      100% { transform: translate(-50%, -50%); opacity: 1; }
    }

    .login-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 25px;
      margin-bottom: 35px;
    }

    .logo-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 30px rgba(142, 68, 255, 0.5),
                  0 0 60px rgba(0, 206, 201, 0.3);
      animation: pulse 3s infinite alternate;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 30px rgba(142, 68, 255, 0.5), 0 0 60px rgba(0, 206, 201, 0.3); }
      100% { transform: scale(1.05); box-shadow: 0 0 40px rgba(142, 68, 255, 0.7), 0 0 80px rgba(0, 206, 201, 0.5); }
    }

    .logo-circle i {
      color: white;
      font-size: 3.5rem;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
    }

    .login-header h2 {
      font-size: 2.2rem;
      color: var(--text);
      font-weight: 600;
      letter-spacing: 1px;
      background: linear-gradient(to right, #f0f0f0, #c3a6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 10px rgba(142, 68, 255, 0.3);
    }

    .login-header p {
      color: #c3a6ff;
      font-size: 1.1rem;
      margin-top: 10px;
    }

    .form-group {
      margin-bottom: 30px;
      position: relative;
    }

    /* Removido o input-icon para o campo de senha principal */
    /* .input-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      font-size: 1.3rem;
    } */

    #senha {
      width: 100%;
      padding: 18px 20px; /* Ajustado para centralizar o texto */
      font-size: 1.1rem;
      background: rgba(30, 30, 50, 0.5);
      color: var(--text);
      border: 2px solid rgba(142, 68, 255, 0.3);
      border-radius: 12px;
      transition: all 0.4s ease;
      outline: none;
      text-align: center; /* Centraliza o texto */
    }

    #senha:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(0, 206, 201, 0.3);
      background: rgba(30, 30, 50, 0.7);
    }

    #senha::placeholder {
      color: rgba(195, 166, 255, 0.6);
    }

    #btn-login, #btn-login-sem-senha {
      padding: 16px;
      font-size: 1.2rem;
      background: linear-gradient(45deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(142, 68, 255, 0.4);
      margin-top: 15px; /* Adicionado para espaçamento entre os botões */
    }

    #btn-login::before, #btn-login-sem-senha::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }

    #btn-login:hover::before, #btn-login-sem-senha:hover::before {
      left: 100%;
    }

    #btn-login:hover, #btn-login-sem-senha:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(142, 68, 255, 0.6);
    }

    #btn-login:active, #btn-login-sem-senha:active {
      transform: translateY(1px);
    }

    #login-message {
      margin-top: 20px;
      min-height: 25px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .error-shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    .security-tip {
      margin-top: 30px;
      padding: 15px;
      background: rgba(253, 203, 110, 0.1);
      border-radius: 12px;
      border-left: 4px solid var(--warning); /* Mantido 4px conforme o OLD.html */
      font-size: 0.95rem;
      color: #fdcb6e;
      text-align: center;
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .footer-note {
      position: absolute;
      bottom: 25px;
      width: 100%;
      text-align: center;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.9rem;
      z-index: 5;
    }

    /* ========== SISTEMA PRINCIPAL ========== */
    #main-content {
      display: none;
      padding-bottom: 60px;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
      justify-content: center;
      padding-top: 40px;
    }

    .section {
      display: none;
      flex-wrap: wrap;
      gap: 30px;
      width: 100%;
      animation: fadeIn 0.8s ease-out;
      justify-content: center;
    }

    .section.active {
      display: flex;
    }

    .card {
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                  0 0 0 1px rgba(142, 68, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 400px;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
                  0 0 0 1px var(--primary);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(142, 68, 255, 0.3);
      justify-content: center; /* Centralize card headers */
    }

    .card-header i {
      color: var(--primary);
      font-size: 1.8rem;
      background: rgba(142, 68, 255, 0.1);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
    }

    .card-header h2 {
      font-size: 1.5rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* ========== CALCULADORA DE MUNIÇÕES ========== */
    #propt-container {
      background: rgba(30, 30, 50, 0.7);
      border: 1px solid rgba(142, 68, 255, 0.3);
      border-radius: 10px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      color: var(--light);
      margin-top: 15px;
      max-height: 150px;
      overflow-y: auto;
      line-height: 1.5;
    }

    #lista-compras {
      max-height: 250px;
      overflow-y: auto;
      padding-right: 10px;
      margin-bottom: 20px;
      border-radius: 10px;
    }

    .linha-compra {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: rgba(30, 30, 50, 0.5);
      border-radius: 10px;
      margin-bottom: 10px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
    }

    .linha-compra:hover {
      background: rgba(142, 68, 255, 0.1);
      transform: translateX(5px);
    }

    .linha-compra button {
      background: var(--danger);
      color: var(--light);
      border: none;
      border-radius: 6px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .linha-compra button:hover {
      background: #ff2e2e;
      transform: scale(1.1);
    }

    .total-box {
      background: rgba(30, 30, 50, 0.7);
      border-radius: 12px;
      padding: 15px;
      margin-top: 15px;
      text-align: center;
      border: 1px solid var(--primary);
    }

    .total-box p {
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .total-box strong {
      font-size: 1.4rem;
      color: var(--accent);
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 25px 0 15px;
      cursor: pointer;
      user-select: none;
      padding: 12px;
      background: rgba(142, 68, 255, 0.1);
      border-radius: 10px;
      transition: all 0.3s ease;
      border: 1px solid rgba(142, 68, 255, 0.3);
    }

    .checkbox-container:hover {
      background: rgba(142, 68, 255, 0.2);
      border-color: var(--primary);
    }

    .checkbox-container input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .checkbox-custom {
      position: relative;
      width: 24px;
      height: 24px;
      border: 2px solid var(--primary);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      background: rgba(30, 30, 50, 0.7);
    }

    .checkbox-container input[type="checkbox"]:checked + .checkbox-custom {
      background: var(--primary);
      border-color: var(--primary);
    }

    .checkbox-custom::after {
      content: "\f00c";
      font-family: "Font Awesome 5 Free";
      font-weight: 900;
      color: white;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s ease;
      position: absolute;
    }

    .checkbox-container input[type="checkbox"]:checked + .checkbox-custom::after {
      opacity: 1;
    }

    .checkbox-container span {
      flex: 1;
      font-weight: 500;
    }

    /* ========== ANÁLISE DE RECIBOS ========== */
    #analise-recibos {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      display: flex; /* Alterado para flex */
      flex-direction: column; /* Para o header ficar em cima dos dois quadros */
      gap: 20px; /* Espaçamento entre o header e os quadros */
    }

    #analise-recibos .card-header {
        width: 100%; /* Ocupa toda a largura */
        margin-bottom: 0; /* Remove margem inferior padrão */
    }

    .analise-container {
      display: flex;
      gap: 30px;
      width: 100%;
      flex-wrap: wrap; /* Permite que os quadros quebrem em telas menores */
    }

    .analise-left, .analise-right {
      flex: 1;
      min-width: 300px; /* Garante que não fiquem muito pequenos */
      display: flex;
      flex-direction: column;
      align-items: center;
      
      /* Estilo de card para os quadros da análise */
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                  0 0 0 1px rgba(142, 68, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .analise-left:hover, .analise-right:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
                  0 0 0 1px var(--primary);
    }

    /* Estilo dos itens de vendedor */
    .vendedor-item {
      background: rgba(30, 30, 50, 0.7);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid var(--accent);
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .vendedor-item:hover {
      background: rgba(30, 30, 50, 0.8);
    }

    .vendedor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .vendedor-nome {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .vendedor-total {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--accent);
    }

    .vendedor-detalhes {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      padding-top: 0;
    }

    .vendedor-item.expandido .vendedor-detalhes {
      max-height: 500px;
      padding-top: 15px;
    }

    .vendedor-resumo {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .vendedor-comissao {
      background: rgba(26, 26, 46, 0.8);
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
      border: 1px solid rgba(142, 68, 255, 0.2);
    }

    .vendedor-comissao span {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }

    .vendedor-comissao .fac {
      color: var(--fac);
    }

    .vendedor-comissao .ganho {
      color: var(--comissao);
    }

    .toggle-icon {
      transition: transform 0.3s ease;
      color: var(--accent);
    }

    .vendedor-item.expandido .toggle-icon {
      transform: rotate(180deg);
    }

    /* Gráfico de barras simples */
    .grafico-barras {
      margin-top: 15px;
      height: 10px;
      background: rgba(30, 30, 50, 0.5);
      border-radius: 5px;
      overflow: hidden;
    }

    .barra {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    /* Estilo para os arquivos */
    .file-list {
      max-height: 300px;
      overflow-y: auto;
      margin: 15px 0;
      padding: 10px;
      background: rgba(30, 30, 50, 0.5);
      border-radius: 10px;
      border: 1px dashed rgba(142, 68, 255, 0.3);
      width: 100%;
    }

    .file-item {
      padding: 10px;
      border-bottom: 1px solid rgba(142, 68, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-item i {
      color: var(--primary);
    }

    /* Barra de rolagem personalizada */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(30, 30, 50, 0.5);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* ========== BOTÕES E FORMULÁRIOS ========== */
    .btn {
      padding: 14px;
      font-size: 1.1rem;
      background: linear-gradient(45deg, var(--primary), var(--primary-dark));
      color: var(--light);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      box-shadow: 0 5px 15px rgba(142, 68, 255, 0.3);
      width: 100%;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(142, 68, 255, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-secondary {
      background: linear-gradient(45deg, #6a11cb, #2575fc);
    }

    .btn-success {
      background: linear-gradient(45deg, var(--success), #009d7c);
    }

    .btn-danger {
      background: linear-gradient(45deg, var(--danger), #c0392b);
    }

    .btn-warning {
      background: linear-gradient(45deg, var(--warning), #e17055);
    }

    .btn-principal {
      display: block;
      width: 90%;
      margin: 20px auto 0;
      padding: 15px;
      font-size: 1.1rem;
    }

    .form-group {
      margin-bottom: 20px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
    }

    select, input[type="number"], input[type="file"], input[type="text"] {
      width: 100%;
      max-width: 300px;
      padding: 14px;
      font-size: 1rem;
      background: rgba(30, 30, 50, 0.7);
      color: var(--light);
      border: 1px solid rgba(142, 68, 255, 0.5);
      border-radius: 10px;
      transition: all 0.3s ease;
      text-align: center;
    }

    select:focus, input[type="number"]:focus, 
    input[type="file"]:focus, input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 206, 201, 0.3);
      outline: none;
    }

    /* ========== NAVEGAÇÃO ========== */
    .nav-tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .nav-tab {
      padding: 12px 25px;
      background: rgba(26, 26, 46, 0.8);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 1px solid var(--primary);
    }

    .nav-tab.active {
      background: var(--primary);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(142, 68, 255, 0.4);
    }

    /* ========== RESUMO GERAL ========== */
    .resumo-geral {
      background: rgba(26, 26, 46, 0.8);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid var(--accent);
    }

    .resumo-geral h3 {
      color: var(--text-secondary);
      margin-bottom: 15px;
      text-align: center;
    }

    .resumo-geral p {
      margin: 8px 0;
      font-size: 1.05rem;
    }

    .resumo-geral strong {
      color: var(--accent);
    }

    /* ========== EFEITOS E ANIMAÇÕES ========== */
    .firework {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 1;
    }

    .fa-spinner {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ========== MARCA D'ÁGUA ========== */
    #marca-dagua {
      position: fixed;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
      pointer-events: none;
      user-select: none;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      font-weight: 300;
    }

    #marca-dagua .borboleta {
      color: var(--accent);
      font-size: 1.2rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }

    /* ========== MELHORIAS SOLICITADAS ========== */
    /* Ajuste para os botões de processar e arquivar */
    #btn-processar, #btn-arquivar-recibos {
      width: 50%; /* Ocupa metade da largura */
      padding: 14px 20px;
      display: inline-flex;
      margin-top: 0; /* Remove margem superior padrão */
    }

    /* Remove o botão de limpar seleção */
    /* #btn-limpar {
      margin-left: 10px;
    } */

    .comissao-info, #analise-recibos .form-group label {
      text-align: center;
    }

    /* Centralizar botões na análise de recibos */
    .button-group {
      display: flex;
      justify-content: center;
      width: 100%;
      gap: 10px;
      margin-top: 15px;
    }

    /* Estilo específico para o input file */
    input[type="file"] {
      cursor: pointer;
    }

    input[type="file"]::file-selector-button {
      background: linear-gradient(45deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    input[type="file"]::file-selector-button:hover {
      background: linear-gradient(45deg, var(--primary-dark), var(--primary));
    }

    /* ========== ADMINISTRAÇÃO ========== */
    .admin-container {
      background: rgba(26, 26, 46, 0.8);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }

    .admin-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-width: 400px;
      margin: 0 auto;
    }

    .admin-form input {
      padding: 14px;
      font-size: 1rem;
      background: rgba(30, 30, 50, 0.7);
      color: var(--text);
      border: 1px solid rgba(142, 68, 255, 0.5);
      border-radius: 10px;
      width: 100%;
    }

    .admin-form button {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .vendedores-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .vendedor-admin-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(30, 30, 50, 0.5);
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .vendedor-admin-item button {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
      width: 80px; /* Fixed width for consistency */
      height: 36px; /* Fixed height for consistency */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lembrete-comissao {
      margin-top: 20px;
      padding: 15px;
      background: rgba(253, 203, 110, 0.1);
      border-radius: 12px;
      border-left: 4px solid var(--warning);
      font-size: 0.95rem;
      color: #fdcb6e;
      text-align: center;
    }

    /* ========== AJUSTES SOLICITADOS ========== */
    /* Ajuste para o container de login administrativo */
    .admin-login-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    /* Estilo do campo de senha administrativa */
    .admin-senha {
      width: 100%;
      padding: 18px 20px; /* Ajustado para centralizar o texto */
      font-size: 1.1rem;
      background: rgba(30, 30, 50, 0.5);
      color: var(--text);
      border: 2px solid rgba(142, 68, 255, 0.3);
      border-radius: 12px;
      transition: all 0.4s ease;
      outline: none;
      margin-bottom: 25px;
      text-align: center; /* Centraliza o texto */
    }

    .admin-senha:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(0, 206, 201, 0.3);
      background: rgba(30, 30, 50, 0.7);
    }

    .admin-senha::placeholder {
      color: rgba(195, 166, 255, 0.6);
    }

    /* Ícone do campo de senha - REMOVIDO */
    /* .admin-senha-container {
      position: relative;
      width: 100%;
      margin-bottom: 25px;
    } */

    /* .admin-senha-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      font-size: 1.3rem;
    } */

    /* Ajuste para o botão de acesso administrativo */
    .btn-admin-login {
      width: auto;
      padding: 12px 25px;
      background: linear-gradient(45deg, #6a11cb, #2575fc);
      margin: 0 auto;
      display: block;
    }

    /* ========== NOVOS ESTILOS PARA RESUMO DE VENDAS ========== */
    .resumo-vendas-container {
      display: flex;
      gap: 30px;
      width: 100%;
      justify-content: center;
    }

    .resumo-card {
      flex: 1;
      min-width: 0;
      max-width: 500px;
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                  0 0 0 1px rgba(142, 68, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .resumo-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
                  0 0 0 1px var(--primary);
    }

    .vendedores-container {
      max-height: 65vh;
      overflow-y: auto;
      padding-right: 10px;
    }

    /* ========== NOVOS ESTILOS PARA ADMINISTRAR RESUMO ========== */
    #admin-resumo-content {
      margin-top: 30px;
    }

    #editar-resumo-container {
      margin-top: 30px;
      padding: 20px;
      background: rgba(26, 26, 46, 0.6);
      border-radius: 15px;
      border: 1px solid rgba(142, 68, 255, 0.3);
    }

    #lista-vendedores-resumo {
      max-height: 50vh;
      overflow-y: auto;
    }

    #btn-zerar-resumo {
      width: 100%;
      margin-bottom: 10px;
    }

    /* ========== NOVO LOGIN PARA ANÁLISE DE RECIBOS ========== */
    #analise-login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      padding: 30px;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    #analise-login-container .card-header {
      justify-content: center;
      margin-bottom: 30px;
    }

    #analise-login-container .card-header i {
      font-size: 2rem;
    }

    #analise-login-container .card-header h2 {
      font-size: 1.5rem;
    }

    #analise-content {
      display: none;
    }

    /* ========== RESPONSIVIDADE ========== */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      
      .card {
        max-width: 100%;
      }
      
      .nav-tabs {
        flex-direction: column;
        gap: 10px;
      }
      
      .analise-container {
        flex-direction: column;
      }
      
      .analise-left, .analise-right {
        width: 100%;
      }
      
      .login-container {
        padding: 40px 30px;
      }
      
      .logo-circle {
        width: 80px;
        height: 80px;
      }
      
      .login-header h2 {
        font-size: 1.8rem;
      }

      /* Ajustes para mobile nos botões */
      .button-group {
        flex-direction: column;
      }

      #btn-processar, #btn-arquivar-recibos {
        width: 100%;
        margin-left: 0;
      }

      select, input[type="number"], input[type="file"], input[type="text"] {
        max-width: 100%;
      }

      .admin-form {
        flex-direction: column;
      }

      /* Ajustes para o resumo de vendas em mobile */
      .resumo-vendas-container {
        flex-direction: column;
      }

      .resumo-card {
        max-width: 100%;
      }

      /* Ajustes para administração em mobile */
      #lista-vendedores-resumo .vendedor-admin-item {
        flex-direction: column;
        gap: 10px;
      }
      
      #lista-vendedores-resumo .vendedor-admin-item input {
        width: 100% !important;
      }
    }

    /* Novo estilo para o formulário de adicionar vendedor */
    .admin-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
      max-width: 400px;
      margin: 0 auto 20px auto;
    }

    .admin-form-grid input {
      width: 100%;
    }

    .admin-form-grid button {
      grid-column: span 2; /* Faz o botão ocupar as duas colunas */
      width: 100%;
    }

    /* Melhoria no estilo da lista de vendedores */
    .vendedores-list {
      background: rgba(30, 30, 50, 0.5);
      border-radius: 12px;
      padding: 15px;
      max-height: 350px; /* Aumenta a altura para mais itens */
      overflow-y: auto;
      border: 1px solid rgba(142, 68, 255, 0.3);
    }

    .vendedor-admin-item {
      background: rgba(26, 26, 46, 0.7);
      border-radius: 10px;
      padding: 12px 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid var(--accent);
      transition: all 0.2s ease;
    }

    .vendedor-admin-item:hover {
      background: rgba(26, 26, 46, 0.9);
      transform: translateX(3px);
    }

    .vendedor-admin-item span {
      font-size: 1rem;
      color: var(--text);
      font-weight: 500;
    }

    .vendedor-admin-item button {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
      font-size: 0.9rem;
    }

    .vendedor-admin-item button:hover {
      background: #ff2e2e;
      transform: scale(1.05);
    }

    /* Estilos para o modal de edição */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
        backdrop-filter: blur(5px);
        padding-top: 60px;
    }

    .modal-content {
        background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(16, 16, 32, 0.95));
        margin: 5% auto; /* 15% from the top and centered */
        padding: 30px;
        border: 1px solid var(--primary);
        border-radius: 20px;
        width: 80%; /* Could be more or less, depending on screen size */
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease-out;
    }

    .modal-content h3 {
        color: var(--text);
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.8rem;
    }

    .modal-content .form-group {
        margin-bottom: 15px;
    }

    .modal-content label {
        color: var(--text-secondary);
        font-size: 1rem;
        margin-bottom: 5px;
        text-align: left;
        width: 100%;
    }

    .modal-content input[type="text"] {
        width: 100%;
        max-width: none;
        padding: 12px;
        font-size: 1rem;
        background: rgba(30, 30, 50, 0.7);
        color: var(--light);
        border: 1px solid rgba(142, 68, 255, 0.5);
        border-radius: 8px;
    }

    .modal-buttons {
        display: flex;
        justify-content: space-around;
        gap: 15px;
        margin-top: 25px;
    }

    .modal-buttons .btn {
        width: 100%;
        margin-top: 0;
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        transition: 0.3s;
    }

    .close-button:hover,
    .close-button:focus {
        color: var(--danger);
        text-decoration: none;
        cursor: pointer;
    }

    /* Estilos para os novos botões de ação na lista de vendedores */
    .vendedor-admin-item .action-buttons {
        display: flex;
        gap: 8px;
    }

    .vendedor-admin-item .action-buttons .btn {
        width: auto;
        padding: 8px 12px;
        font-size: 0.9rem;
        margin-top: 0;
        box-shadow: none;
    }

    .vendedor-admin-item .action-buttons .btn-edit {
        background: linear-gradient(45deg, #00cec9, #009d9a);
    }

    .vendedor-admin-item .action-buttons .btn-edit:hover {
        background: linear-gradient(45deg, #009d9a, #00cec9);
    }

    .vendedor-admin-item .action-buttons .btn-danger {
        background: linear-gradient(45deg, var(--danger), #c0392b);
    }

    .vendedor-admin-item .action-buttons .btn-danger:hover {
        background: linear-gradient(45deg, #c0392b, var(--danger));
    }

    /* Ajuste para o container de login administrativo principal */
    #admin-main-login-container {
        max-width: 500px;
        margin: 0 auto;
        padding: 30px;
        background: rgba(26, 26, 46, 0.7);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
                    0 0 50px rgba(142, 68, 255, 0.3),
                    inset 0 0 15px rgba(142, 68, 255, 0.2);
        border: 1px solid rgba(142, 68, 255, 0.5);
        text-align: center;
    }

    #admin-main-login-container .login-header {
        margin-bottom: 30px;
    }

    #admin-main-login-container .login-header h2 {
        font-size: 2rem;
    }

    #admin-main-login-container .form-group {
        margin-bottom: 20px;
    }

    #admin-main-login-container .btn {
        margin-top: 20px;
    }

    /* Estilos para as seções de administração após o login único */
    .admin-section-content {
        display: none; /* Hidden by default */
        flex-wrap: wrap; /* Permite que os cartões fiquem lado a lado */
        gap: 30px; /* Espaçamento entre os cartões */
        width: 100%;
        animation: fadeIn 0.8s ease-out;
        justify-content: center; /* Centraliza os cartões */
    }

    .admin-section-content.active {
        display: flex;
    }

    /* Ajustes para responsividade dos botões de ação */
    @media (max-width: 480px) {
        .vendedor-admin-item .action-buttons {
            flex-direction: column;
            gap: 5px;
        }
        .vendedor-admin-item .action-buttons .btn {
            width: 100%;
        }
    }

    /* NOVOS ESTILOS PARA ANALISE DE RECIBOS (DO OLD.HTML) */
    .analise-recibos-container {
      display: flex;
      gap: 30px;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap; /* Adicionado para quebrar em telas menores */
    }

    .analise-card {
      flex: 1;
      min-width: 0;
      max-width: 500px;
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                  0 0 0 1px rgba(142, 68, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .analise-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
                  0 0 0 1px var(--primary);
    }

    .duplicado-warning {
      background: rgba(253, 203, 110, 0.1);
      border-left: 4px solid var(--warning);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--warning);
      font-size: 0.9rem;
    }

    /* Centralização dos títulos */
    .card-header-center {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(142, 68, 255, 0.3);
    }

    /* Ajustes para mobile nos botões */
    @media (max-width: 768px) {
      .analise-recibos-container {
        flex-direction: column;
      }
      .analise-card {
        max-width: 100%;
      }
      .button-group {
        flex-direction: column;
      }
    }

    /* Adicionado para centralizar o label e input da webhook */
    .admin-form .form-group {
        align-items: center; /* Centraliza horizontalmente o conteúdo do form-group */
    }

    .admin-form .form-group label {
        text-align: center; /* Centraliza o texto do label */
        width: 100%; /* Garante que o label ocupe toda a largura para centralizar */
    }

    .admin-form .form-group input[type="text"] {
        max-width: 300px; /* Mantém a largura máxima para o input */
        margin: 0 auto; /* Centraliza o input */
    }

    /* Adicionado para centralizar o input de ID Discord */
    .admin-form-grid input[placeholder="ID Discord (opcional)"] {
        margin: 0 auto; /* Centraliza o input */
    }

    /* Estilos para o novo card de Arquivados */
    .arquivados-list {
      max-height: 65vh;
      overflow-y: auto;
      padding-right: 10px;
    }

    .arquivado-item {
      background: rgba(30, 30, 50, 0.7);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid var(--success);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .arquivado-item:hover {
      background: rgba(30, 30, 50, 0.8);
    }

    .arquivado-item strong {
      color: var(--accent);
    }

    .arquivado-item p {
      margin: 5px 0;
    }

    /* Estilo para o alerta de senha */
    .password-alert {
      margin-top: 15px;
      padding: 10px;
      background: rgba(255, 76, 76, 0.1); /* Cor de perigo */
      border-radius: 8px;
      border-left: 4px solid var(--danger);
      font-size: 0.9rem;
      color: var(--danger);
      text-align: center;
      margin-bottom: 10px; /* Espaçamento antes do input */
    }

  </style>
</head>
<body>
  <!-- ========== TELA DE LOGIN ========== -->
  <div id="particles-js"></div>
  <div id="fireworks"></div>
  
  <div class="login-container">
    <div class="login-header">
      <div class="logo-circle">
        <i class="fas fa-lock"></i>
      </div>
      <div>
        <h2>Acesso Restrito</h2>
        <p>Sistema de Vendas FiveM Security System</p>
      </div>
    </div>
    
    <div class="form-group">
      <!-- Removido o input-icon -->
      <input type="password" id="senha" placeholder="Digite a senha de acesso" />
    </div>
    
    <button class="btn" id="btn-login">
      <i class="fas fa-sign-in-alt"></i> Acessar Sistema
    </button>

    <button class="btn" id="btn-login-sem-senha">
      <i class="fas fa-user-alt"></i> Acessar sem senha
    </button>
    
    <div id="login-message"></div>
    
    <div class="security-tip">
      <i class="fas fa-shield-alt"></i> Sistema protegido com criptografia AES-256
    </div>
  </div>
  
  <div class="footer-note">
    Sistema de Vendas FiveM © 2025 - Todos os direitos reservados
  </div>

  <!-- ========== SISTEMA PRINCIPAL ========== -->
  <div id="main-content">
    <div class="container">
      <div class="nav-tabs">
        <div class="nav-tab active" data-target="calculadora">Calculadora de Munições</div>
        <div class="nav-tab" data-target="analise">Análise de Recibos</div>
        <div class="nav-tab" data-target="admin">Administração</div>
      </div>

      <!-- Calculadora de Munições -->
      <div id="calculadora" class="section active">
        <div class="card">
          <div class="card-header">
            <i class="fas fa-calculator"></i>
            <h2>Calculadora de Munições</h2>
          </div>
          
          <div class="form-group">
            <label for="arma"><i class="fas fa-gun"></i> Tipo de Munição</label>
            <select id="arma" onchange="calcular()">
              <option value="Munição de Sub">Munição de Sub</option>
              <option value="Munição de Rifle">Munição de Rifle</option>
              <option value="Munição de Pistola">Munição de Pistola</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="quantidade"><i class="fas fa-boxes"></i> Quantidade</label>
            <input type="number" id="quantidade" value="1" min="1" onchange="calcular()" />
          </div>
          
          <button class="btn" id="btn-calcular" onclick="calcular()">
            <i class="fas fa-cogs"></i> Calcular Quantidade
          </button>
          
          <div id="propt-container"></div>
          
          <button class="btn btn-secondary" id="botao-copiar">
            <i class="fas fa-copy"></i> Copie o PROPT Acima e Cole no F8
          </button>
          
          <div class="form-group" style="margin-top: 20px; background: rgba(253, 203, 110, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid var(--warning);">
            <p><i class="fas fa-lightbulb"></i> <strong>Dica:</strong></p>
            <p>Para evitar falta de materiais, use quantidades múltiplas de 15 (ex: 150, 300, 600, 1050, 1200, 2100, 3000).</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <i class="fas fa-dollar-sign"></i>
            <h2>Valor das Munições</h2>
          </div>
          
          <div class="total-box">
            <p>Preço por Unidade</p>
            <p><strong id="preco-unitario">-</strong></p>
          </div>
          
          <div class="total-box">
            <p>Valor Total da Produção</p>
            <p><strong id="preco-total">-</strong></p>
          </div>
          
          <button class="btn btn-success btn-principal" id="btn-adicionar">
            <i class="fas fa-cart-plus"></i> Adicionar ao Resumo
          </button>
          
          <div class="checkbox-container" onclick="toggleDesconto()">
            <input type="checkbox" id="desconto">
            <div class="checkbox-custom"></div>
            <span>Aplicar desconto de parceria</span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <i class="fas fa-receipt"></i>
            <h2>Resumo da Venda</h2>
          </div>
          
          <div id="lista-compras"></div>
          
          <div class="form-group">
            <label><i class="fas fa-user-tie"></i> Vendido Por</label>
            <select id="nome-comprador">
              <option value="">-- Selecione o Vendedor --</option>
              <!-- Os vendedores serão carregados dinamicamente -->
            </select>
          </div>
          
          <div class="total-box">
            <p>Total Geral da Venda</p>
            <p><strong id="total-geral">R$ 0</strong></p>
          </div>
          
          <button class="btn btn-warning btn-principal" id="baixar-recibo">
            <i class="fas fa-file-download"></i> Finalizar Venda e Gerar Recibo
          </button>
          <div id="lembrete-container" style="margin-top: 25px;"></div>
        </div>
      </div>

      <!-- Análise de Recibos -->
      <div id="analise" class="section">
        <div class="analise-recibos-container">
          <!-- Card de Upload -->
          <div class="analise-card">
            <div class="card-header-center">
              <i class="fas fa-file-upload"></i>
              <h2>Upload de Recibos</h2>
            </div>
            
            <div class="comissao-info">
              <i class="fas fa-money-bill-wave"></i> A comissão para vendedores é de 50% do valor total das vendas
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-file-upload"></i> Selecione os Recibos (.txt)</label>
              <input type="file" id="recibo-upload" multiple accept=".txt">
            </div>
            
            <div class="file-list" id="lista-arquivos">
              <p>Nenhum arquivo selecionado</p>
            </div>
            
            <div id="duplicados-container"></div>
            
            <div class="button-group">
              <button class="btn btn-secondary" id="btn-processar">
                <i class="fas fa-cogs"></i> Processar Recibos
              </button>
              
              <button class="btn btn-success" id="btn-arquivar-recibos">
                <i class="fas fa-archive"></i> Arquivar Recibos
              </button>
            </div>
          </div>
          
          <!-- Card de Resultados -->
          <div class="analise-card">
            <div class="card-header-center">
              <i class="fas fa-chart-bar"></i>
              <h2>Resultados da Análise</h2>
            </div>
            
            <div class="form-group">
              <input type="text" id="filtro-vendedores" placeholder="Filtrar vendedores..." class="form-control">
            </div>
            
            <div class="form-group">
              <label>Ordenar por:</label>
              <select id="ordenar-por" class="form-control">
                <option value="valor">Valor Total (maior primeiro)</option>
                <option value="nome">Nome (A-Z)</option>
                <option value="quantidade">Quantidade (maior primeiro)</option>
              </select>
            </div>
            
            <div id="resumo-vendedores" style="max-height: 65vh; overflow-y: auto;">
              <p style="text-align: center; color: var(--text-secondary);">Selecione e processe os recibos para ver os resultados</p>
            </div>
          </div>

          <!-- Novo Card de Arquivados -->
          <div class="analise-card">
            <div class="card-header-center">
              <i class="fas fa-box-archive"></i>
              <h2>Recibos Arquivados</h2>
            </div>
            <div id="lista-arquivados" class="arquivados-list">
              <p style="text-align: center; color: var(--text-secondary);">Nenhum recibo arquivado ainda.</p>
            </div>
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-danger" id="btn-limpar-arquivados">
                    <i class="fas fa-eraser"></i> Limpar Arquivados
                </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Administração -->
      <div id="admin" class="section">
        <div id="admin-main-login-container">
            <div class="login-header">
                <div class="logo-circle">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h2>Acesso Administrativo</h2>
                    <p>Gerencie as configurações do sistema</p>
                </div>
            </div>
            <div class="form-group">
                <!-- Removido o input-icon para o campo de senha administrativa -->
                <input type="password" id="admin-master-senha" placeholder="Digite a senha administrativa" class="admin-senha" />
            </div>
            <button class="btn" id="btn-admin-master-login">
                <i class="fas fa-sign-in-alt"></i> Acessar Painel Admin
            </button>
            <div id="admin-master-message" style="margin-top: 10px;"></div>
        </div>

        <div id="admin-content-wrapper" class="admin-section-content">
            <!-- Gerenciar Vendedores -->
            <div class="resumo-card">
                <div class="card-header">
                    <i class="fas fa-users"></i>
                    <h2>Gerenciar Vendedores</h2>
                </div>
                <div class="admin-container">
                    <div class="admin-form-grid">
                        <input type="text" id="vendedor-id" placeholder="ID do Vendedor">
                        <input type="text" id="vendedor-nome" placeholder="Nome do Vendedor">
                        <input type="text" id="vendedor-discord-id" placeholder="ID Discord (opcional)">
                        <button class="btn btn-success" id="btn-adicionar-vendedor">
                            <i class="fas fa-plus"></i> Adicionar
                        </button>
                    </div>
                    <div class="vendedores-list" id="lista-vendedores">
                        <!-- Lista de vendedores será carregada aqui -->
                    </div>
                </div>
            </div>

            <!-- Gerenciar Webhook do Discord -->
            <div class="resumo-card">
                <div class="card-header">
                    <i class="fab fa-discord"></i>
                    <h2>Gerenciar Webhook Discord</h2>
                </div>
                <div class="admin-container">
                    <div class="admin-form">
                        <div class="form-group"> <!-- Adicionado form-group para centralização -->
                            <label for="webhook-url">URL da Webhook do Discord:</label>
                            <input type="text" id="webhook-url" placeholder="Cole a URL da Webhook aqui">
                        </div>
                        <button class="btn btn-success" id="btn-salvar-webhook">
                            <i class="fas fa-save"></i> Salvar URL da Webhook
                        </button>
                    </div>
                </div>
            </div>

            <!-- Gerenciar Configurações de Recibo -->
            <div class="resumo-card">
                <div class="card-header">
                    <i class="fas fa-cogs"></i>
                    <h2>Configurações de Recibo</h2>
                </div>
                <div class="admin-container">
                    <div class="admin-form">
                        <div class="checkbox-container" onclick="toggleEnviarReciboDiscord()">
                            <input type="checkbox" id="toggle-discord-send">
                            <div class="checkbox-custom"></div>
                            <span>Enviar recibo para o Discord</span>
                        </div>
                        <div class="checkbox-container" onclick="toggleBaixarReciboLocalmente()">
                            <input type="checkbox" id="toggle-local-download">
                            <div class="checkbox-custom"></div>
                            <span>Baixar recibo localmente</span>
                        </div>
                        <button class="btn btn-success" id="btn-salvar-config">
                            <i class="fas fa-save"></i> Salvar Configurações
                        </button>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <div id="marca-dagua">
      <span>Sistema Profissional Sistema de Vendas FiveM v6.0</span>
      <span class="borboleta">🦋</span>
      <span>Criado por Sammy Lee | Discord: @ssammylee</span>
    </div>
  </div>

  <!-- Modal de Edição de Vendedor -->
  <div id="editVendedorModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h3>Editar Vendedor</h3>
      <div class="form-group">
        <label for="edit-vendedor-id">ID do Vendedor:</label>
        <input type="text" id="edit-vendedor-id" readonly>
      </div>
      <div class="form-group">
        <label for="edit-vendedor-nome">Nome do Vendedor:</label>
        <input type="text" id="edit-vendedor-nome">
      </div>
      <div class="form-group">
        <label for="edit-vendedor-discord-id">ID Discord (opcional):</label>
        <input type="text" id="edit-vendedor-discord-id">
      </div>
      <div class="modal-buttons">
        <button class="btn btn-success" id="btn-salvar-edicao">
            <i class="fas fa-save"></i> Salvar Alterações
        </button>
        <button class="btn btn-danger" id="btn-cancelar-edicao">
            <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmação de Limpeza de Arquivados -->
  <div id="confirmClearArchivedModal" class="modal">
    <div class="modal-content">
      <span class="close-button" id="closeClearArchivedModal">&times;</span>
      <h3>Confirmar Limpeza de Arquivados</h3>
      <div class="password-alert">
        <i class="fas fa-exclamation-triangle"></i> Realmente deseja prosseguir? Todos os dados arquivados serão perdidos. Digite a senha para confirmar.
      </div>
      <div class="form-group">
        <!-- Removido o label e adicionado a classe admin-senha -->
        <input type="password" id="clear-archived-password" placeholder="Digite a senha" class="admin-senha">
      </div>
      <div class="modal-buttons">
        <button class="btn btn-danger" id="btn-confirm-clear-archived">
            <i class="fas fa-trash"></i> Confirmar Limpeza
        </button>
        <button class="btn btn-secondary" id="btn-cancel-clear-archived">
            <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
      <div id="clear-archived-message" style="margin-top: 10px; color: var(--danger);"></div>
    </div>
  </div>

  <script>
    // ================= CONFIGURAÇÕES DA API =================
    const JSONBIN_API_KEY = "$2a$10$B2ei2N0lbw3uuXk7JcOdMOtYxjT/lp179qx0hDuDenkTfRD9Tdj1O";
    
    // Configurações da nova bin para resumo global
    const RESUMO_BIN_ID = "688421fef7e7a370d1ee0b15";
    const RESUMO_API_KEY = JSONBIN_API_KEY;
    const RESUMO_URL = `https://api.jsonbin.io/v3/b/${RESUMO_BIN_ID}`;

    // NOVA BIN ÚNICA PARA ADMINISTRAÇÃO
    const BIN_ADMIN_ID = "68920a0af7e7a370d1f46299"; // ID da bin única para o painel administrativo
    const BIN_ADMIN_API_KEY = JSONBIN_API_KEY; // Reutiliza a mesma chave mestra
    const BIN_ADMIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ADMIN_ID}`;

    // ================= DADOS DO SISTEMA =================
    const armas = {
      "Munição de Rifle": { "Pólvora": 1, "Alumínio": 18, "Cobre": 12 },
      "Munição de Sub": { "Pólvora": 1, "Alumínio": 10, "Cobre": 10 },
      "Munição de Pistola": { "Pólvora": 1, "Cobre": 12 }
    };
    
    const precos = {
      "Munição de Pistola": { normal: 250, desconto: 150 },
      "Munição de Sub": { normal: 400, desconto: 300 },
      "Munição de Rifle": { normal: 500, desconto: 400 }
    };
    
    // Lista de vendedores (será carregada da BIN_ADMIN_ID)
    let vendedores = [];
    let compras = [];
    let arquivosSelecionados = [];
    let maxValorVenda = 0;
    let resumoGlobal = {};
    let discordWebhookUrl = ""; // Variável para armazenar a URL da webhook
    let arquivosProcessadosSet = new Set(); // Para controle de arquivos duplicados na análise de recibos
    let resultadosAnaliseAtual = {}; // Para armazenar os resultados da análise atual
    let recibosArquivados = []; // Nova variável para armazenar os recibos arquivados

    // Variáveis globais para controle de envio/download de recibo
    let enviarReciboDiscord = true;
    let baixarReciboLocalmente = true;

    // ================= FUNÇÕES DA API =================

    // Função para carregar TODOS os dados administrativos da BIN_ADMIN_ID
    async function carregarDadosAdmin() {
      try {
        const response = await fetch(BIN_ADMIN_URL, {
          headers: {
            "X-Master-Key": BIN_ADMIN_API_KEY,
            "Content-Type": "application/json",
            "X-Bin-Private": "false"
          }
        });
        
        if (!response.ok) {
          console.error(`HTTP error! status: ${response.status}`);
          throw new Error("Erro na requisição ao carregar dados administrativos");
        }
        
        const data = await response.json();
        if (data.record) {
          // Carrega vendedores
          if (Array.isArray(data.record.vendedores)) {
            vendedores = data.record.vendedores;
            console.log("Vendedores carregados com sucesso:", vendedores);
          } else {
            console.warn("Formato inesperado para vendedores na bin admin. Inicializando vazio.");
            vendedores = [];
          }

          // Carrega URL da webhook
          if (typeof data.record.discordWebhookUrl === 'string') {
            discordWebhookUrl = data.record.discordWebhookUrl;
            console.log("URL da Webhook carregada com sucesso:", discordWebhookUrl);
          } else {
            console.warn("Formato inesperado para URL da webhook na bin admin. Inicializando vazio.");
            discordWebhookUrl = "";
          }

          // Carrega configurações do sistema
          if (data.record.configuracoesSistema) {
            enviarReciboDiscord = data.record.configuracoesSistema.enviarReciboDiscord !== undefined ? data.record.configuracoesSistema.enviarReciboDiscord : true;
            baixarReciboLocalmente = data.record.configuracoesSistema.baixarReciboLocalmente !== undefined ? data.record.configuracoesSistema.baixarReciboLocalmente : true;
            console.log("Configurações do sistema carregadas com sucesso:", { enviarReciboDiscord, baixarReciboLocalmente });
          } else {
            console.warn("Formato inesperado para configurações do sistema na bin admin. Inicializando padrão.");
            enviarReciboDiscord = true;
            baixarReciboLocalmente = true;
          }

          // Carrega recibos arquivados
          if (Array.isArray(data.record.recibosArquivados)) {
            recibosArquivados = data.record.recibosArquivados;
            console.log("Recibos arquivados carregados com sucesso:", recibosArquivados);
          } else {
            console.warn("Formato inesperado para recibos arquivados na bin admin. Inicializando vazio.");
            recibosArquivados = [];
          }

          return true;
        } else {
          console.warn("JSONBin retornou formato de dados inesperado para admin:", data);
          // Fallback para valores padrão se o formato for inesperado
          vendedores = [
            { id: "7441", nome: "Sammy Lee", discordId: "7441" },
            { id: "13191", nome: "Kyan Davinci", discordId: "13191" },
            { id: "13499", nome: "Yenry Sky", discordId: "13499" },
            { id: "8456", nome: "Pedro Bacana", discordId: "8456" }
          ];
          discordWebhookUrl = "";
          enviarReciboDiscord = true;
          baixarReciboLocalmente = true;
          recibosArquivados = [];
          return false;
        }
      } catch (error) {
        console.error("Erro ao carregar dados administrativos:", error);
        // Fallback para valores padrão em caso de erro
        vendedores = [
          { id: "7441", nome: "Sammy Lee", discordId: "7441" },
          { id: "13191", nome: "Kyan Davinci", discordId: "13191" },
          { id: "13499", nome: "Yenry Sky", discordId: "13499" },
          { id: "8456", nome: "Pedro Bacana", discordId: "8456" }
        ];
        discordWebhookUrl = "";
        enviarReciboDiscord = true;
        baixarReciboLocalmente = true;
        recibosArquivados = [];
        return false;
      }
    }

    // Função para salvar TODOS os dados administrativos na BIN_ADMIN_ID
    async function salvarDadosAdmin() {
      const dadosParaSalvar = {
        vendedores: vendedores,
        discordWebhookUrl: discordWebhookUrl,
        configuracoesSistema: {
          enviarReciboDiscord: enviarReciboDiscord,
          baixarReciboLocalmente: baixarReciboLocalmente
        },
        recibosArquivados: recibosArquivados // Inclui os recibos arquivados
      };

      try {
        const response = await fetch(BIN_ADMIN_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": BIN_ADMIN_API_KEY,
            "X-Bin-Private": "false"
          },
          body: JSON.stringify(dadosParaSalvar)
        });
        
        if (!response.ok) {
          console.error(`HTTP error! status: ${response.status}`);
          throw new Error("Erro ao salvar dados administrativos");
        }
        const data = await response.json();
        console.log("Dados administrativos salvos com sucesso:", data);
        return true;
      } catch (error) {
        console.error("Erro ao salvar dados administrativos:", error);
        alert("⚠️ Erro ao salvar dados administrativos! Os dados serão mantidos apenas localmente.");
        return false;
      }
    }

    // Funções para o resumo global (mantidas, mas a seção de exibição foi removida)
    async function carregarResumoGlobal() {
      try {
        const response = await fetch(RESUMO_URL, {
          headers: {
            "X-Master-Key": RESUMO_API_KEY,
            "Content-Type": "application/json"
          }
        });
        
        if (!response.ok) {
          console.error(`HTTP error! status: ${response.status}`);
          throw new Error("Erro na requisição ao carregar resumo global");
        }
        
        const data = await response.json();
        if (data.record) {
          resumoGlobal = data.record;
          return true;
        } else {
          console.warn("JSONBin returned unexpected data format for global summary:", data);
          resumoGlobal = {}; // Initialize as empty object if unexpected format
          return false;
        }
      } catch (error) {
        console.error("Erro ao carregar resumo global:", error);
        resumoGlobal = {}; // Initialize as empty object on error
        return false;
      }
    }

    async function salvarResumoGlobal() {
      try {
        const response = await fetch(RESUMO_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": RESUMO_API_KEY
          },
          body: JSON.stringify(resumoGlobal)
        });
        
        if (!response.ok) {
          console.error(`HTTP error! status: ${response.status}`);
          throw new Error("Erro ao salvar resumo global");
        }
        const data = await response.json();
        console.log("Resumo global salvo com sucesso:", data);
        return true;
      } catch (error) {
        console.error("Erro ao salvar resumo global:", error);
        return false;
      }
    }

    async function atualizarResumoGlobal(novosDados) {
      for (const vendedor in novosDados) {
        if (!resumoGlobal[vendedor]) {
          resumoGlobal[vendedor] = {
            totalMuni: 0,
            totalValor: 0,
            comissao: 0
          };
        }
        
        resumoGlobal[vendedor].totalMuni += novosDados[vendedor].totalMuni || 0;
        resumoGlobal[vendedor].totalValor += novosDados[vendedor].totalValor || 0;
        resumoGlobal[vendedor].comissao += novosDados[vendedor].comissao || 0;
        resumoGlobal[vendedor].ultimaAtualizacao = new Date().toLocaleString('pt-BR');
      }
      
      await salvarResumoGlobal();
    }

    // ================= FUNÇÕES DO SISTEMA =================
    function atualizarSelectVendedores() {
      const select = document.getElementById('nome-comprador');
      select.innerHTML = '<option value="">-- Selecione o Vendedor --</option>';
      vendedores.forEach(v => {
        const option = document.createElement('option');
        option.value = v.id;
        option.textContent = v.nome;
        select.appendChild(option);
      });
    }

    async function atualizarListaVendedores() {
      const lista = document.getElementById('lista-vendedores');
      lista.innerHTML = '';
      vendedores.forEach((v, index) => {
        const item = document.createElement('div');
        item.className = 'vendedor-admin-item';
        item.innerHTML = `
          <span>${v.id} - ${v.nome} ${v.discordId ? `(@${v.discordId})` : ''}</span>
          <div class="action-buttons">
            <button class="btn btn-edit" data-index="${index}" onclick="openEditModal(${index})">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn btn-danger" data-index="${index}" onclick="removerVendedor(${index})">
              <i class="fas fa-trash"></i> Remover
            </button>
          </div>
        `;
        lista.appendChild(item);
      });
    }

    async function removerVendedor(index) {
        if (confirm(`Tem certeza que deseja remover o vendedor ${vendedores[index].nome}?`)) {
            vendedores.splice(index, 1);
            await salvarDadosAdmin();
            atualizarListaVendedores();
            atualizarSelectVendedores();
        }
    }

    let currentEditIndex = -1; // Variável para armazenar o índice do vendedor sendo editado

    function openEditModal(index) {
        currentEditIndex = index;
        const vendedor = vendedores[index];
        document.getElementById('edit-vendedor-id').value = vendedor.id;
        document.getElementById('edit-vendedor-nome').value = vendedor.nome;
        document.getElementById('edit-vendedor-discord-id').value = vendedor.discordId || '';
        document.getElementById('editVendedorModal').style.display = 'block';
    }

    async function saveEditedVendedor() {
        if (currentEditIndex === -1) return;

        const newNome = document.getElementById('edit-vendedor-nome').value.trim();
        const newDiscordId = document.getElementById('edit-vendedor-discord-id').value.trim();
        const originalId = document.getElementById('edit-vendedor-id').value;

        if (!newNome) {
            alert("O nome do vendedor não pode ser vazio!");
            return;
        }

        // Atualiza o objeto vendedor na lista
        const vendedor = vendedores[currentEditIndex];
        vendedor.nome = newNome;
        vendedor.discordId = newDiscordId;

        const salvou = await salvarDadosAdmin();
        if (salvou) {
            alert("Vendedor atualizado com sucesso!");
            closeEditModal();
            atualizarListaVendedores();
            atualizarSelectVendedores();
        }
    }

    function closeEditModal() {
        document.getElementById('editVendedorModal').style.display = 'none';
        currentEditIndex = -1;
    }

    // Event Listeners para o modal de edição
    document.getElementById('btn-salvar-edicao').addEventListener('click', saveEditedVendedor);
    document.getElementById('btn-cancelar-edicao').addEventListener('click', closeEditModal);
    document.querySelector('#editVendedorModal .close-button').addEventListener('click', closeEditModal);
    window.addEventListener('click', (event) => {
        if (event.target == document.getElementById('editVendedorModal')) {
            closeEditModal();
        }
    });


    // ================= TELA DE LOGIN =================
    async function handleLogin() {
      const senha = document.getElementById("senha").value;
      const loginContainer = document.querySelector('.login-container');
      const loginMessage = document.getElementById('login-message');
      
      if (senha === "adm00") { /* SENHA ALTERADA AQUI */
        loginMessage.textContent = "";
        loginMessage.style.color = "var(--accent)";
        
        loginContainer.style.opacity = "0";
        loginContainer.style.transform = "translate(-50%, -50%) scale(0.9)";
        
        createFireworks();
        
        setTimeout(() => { // Adiciona um pequeno delay para a animação de fade out
            loginContainer.style.display = "none";
            document.querySelector('.footer-note').style.display = "none";
            document.getElementById('particles-js').style.display = "none";
            document.getElementById('main-content').style.display = "block";
        }, 700); // Tempo do delay deve ser menor que a duração da animação de loginEntrance

        // Carregar TODOS os dados administrativos da bin única
        await carregarDadosAdmin();
        atualizarSelectVendedores();
        
        await carregarResumoGlobal();
      } else {
        loginMessage.textContent = "Senha incorreta! Tente novamente.";
        loginMessage.style.color = "var(--danger)";
        
        loginContainer.classList.remove('error-shake');
        void loginContainer.offsetWidth;
        loginContainer.classList.add('error-shake');
      }
    }

    async function handleLoginSemSenha() {
      const loginContainer = document.querySelector('.login-container');
      
      loginContainer.style.opacity = "0";
      loginContainer.style.transform = "translate(-50%, -50%) scale(0.9)";
      
      createFireworks();
      
      setTimeout(() => { // Adiciona um pequeno delay para a animação de fade out
        loginContainer.style.display = "none";
        document.querySelector('.footer-note').style.display = "none";
        document.getElementById('particles-js').style.display = "none";
        document.getElementById('main-content').style.display = "block";
      }, 700); // Tempo do delay deve ser menor que a duração da animação de loginEntrance
      
      // Carregar TODOS os dados administrativos da bin única
      await carregarDadosAdmin();
      atualizarSelectVendedores();
      
      await carregarResumoGlobal();
    }

    document.getElementById("btn-login").addEventListener("click", handleLogin);
    document.getElementById("btn-login-sem-senha").addEventListener("click", handleLoginSemSenha);

    document.getElementById("senha").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        handleLogin();
      }
    });

    function initParticles() {
      const container = document.getElementById('particles-js');
      const particlesCount = 80;
      
      for (let i = 0; i < particlesCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.position = 'absolute';
        particle.style.width = `${Math.random() * 5 + 2}px`;
        particle.style.height = particle.style.width;
        particle.style.background = `rgba(${Math.floor(Math.random() * 100 + 156)}, ${Math.floor(Math.random() * 100 + 68)}, ${Math.floor(Math.random() * 150 + 105)}, ${Math.random() * 0.5 + 0.3})`;
        particle.style.borderRadius = '50%';
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.boxShadow = '0 0 10px rgba(142, 68, 255, 0.5)';
        particle.style.zIndex = '0';
        
        container.appendChild(particle);
        
        animateParticle(particle);
      }
    }

    function animateParticle(particle) {
      const startX = Math.random() * 100;
      const startY = Math.random() * 100;
      const endX = Math.random() * 100;
      const endY = Math.random() * 100;
      const duration = Math.random() * 20000 + 10000;
      
      particle.style.left = `${startX}%`;
      particle.style.top = `${startY}%`;
      
      const keyframes = [
        { transform: `translate(0, 0)` },
        { transform: `translate(${endX - startX}vw, ${endY - startY}vh)` }
      ];
      
      const options = {
        duration: duration,
        iterations: Infinity,
        direction: 'alternate',
        easing: 'ease-in-out'
      };
      
      particle.animate(keyframes, options);
    }

    function createFireworks() {
      const container = document.getElementById('fireworks');
      const colors = ['#ff4c4c', '#00cec9', '#8e44ff', '#fdcb6e', '#ffffff'];
      const fireworkCount = 30;
      
      for (let i = 0; i < fireworkCount; i++) {
        setTimeout(() => {
          const firework = document.createElement('div');
          firework.className = 'firework';
          
          const posX = Math.random() * 100;
          const posY = Math.random() * 100;
          firework.style.left = `${posX}%`;
          firework.style.top = `${posY}%`;
          
          const color = colors[Math.floor(Math.random() * colors.length)];
          firework.style.backgroundColor = color;
          firework.style.boxShadow = `0 0 10px ${color}`;
          
          container.appendChild(firework);
          
          const size = Math.random() * 8 + 4;
          const animation = firework.animate([
            { transform: 'scale(0)', opacity: 1 },
            { transform: `scale(${size})`, opacity: 0 }
          ], {
            duration: Math.random() * 1000 + 500,
            easing: 'ease-out'
          });
          
          animation.onfinish = () => {
            firework.remove();
          };
        }, i * 200);
      }
    }

    window.addEventListener('load', initParticles);

    // ================= SISTEMA PRINCIPAL =================
    document.addEventListener('DOMContentLoaded', async () => {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(tab.dataset.target).classList.add('active');

          // Se a aba de análise for clicada, atualiza os arquivados
          if (tab.dataset.target === 'analise') {
            exibirArquivados();
          }
        });
      });
      
      document.getElementById('recibo-upload').addEventListener('change', function(e) {
        arquivosSelecionados = Array.from(e.target.files);
        verificarDuplicados(); // Adicionado para verificar duplicados
        atualizarListaArquivos();
      });
      
      document.getElementById('btn-processar').addEventListener('click', processarRecibos);
      
      // Removido o botão de limpar seleção
      /*
      document.getElementById('btn-limpar').addEventListener('click', function() {
        arquivosSelecionados = [];
        arquivosProcessadosSet.clear(); // Limpa o set de arquivos processados
        document.getElementById('recibo-upload').value = '';
        atualizarListaArquivos();
        document.getElementById('resumo-vendedores').innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Selecione e processe os recibos para ver os resultados</p>';
        document.getElementById('duplicados-container').innerHTML = ''; // Limpa o aviso de duplicados
        resultadosAnaliseAtual = {}; // Limpa os resultados da análise atual
      });
      */

      document.getElementById('btn-arquivar-recibos').addEventListener('click', arquivarRecibos);
      
      // Event listener para abrir o modal de confirmação de limpeza
      document.getElementById('btn-limpar-arquivados').addEventListener('click', function() {
        document.getElementById('confirmClearArchivedModal').style.display = 'block';
        document.getElementById('clear-archived-password').value = ''; // Limpa o campo de senha
        document.getElementById('clear-archived-message').textContent = ''; // Limpa a mensagem de erro
      });

      // Event listeners para o modal de confirmação de limpeza
      document.getElementById('closeClearArchivedModal').addEventListener('click', function() {
        document.getElementById('confirmClearArchivedModal').style.display = 'none';
      });
      document.getElementById('btn-cancel-clear-archived').addEventListener('click', function() {
        document.getElementById('confirmClearArchivedModal').style.display = 'none';
      });
      document.getElementById('btn-confirm-clear-archived').addEventListener('click', limparRecibosArquivadosComSenha); // Chama a função com senha

      // Event listener para fechar o modal clicando fora
      window.addEventListener('click', (event) => {
        if (event.target == document.getElementById('confirmClearArchivedModal')) {
          document.getElementById('confirmClearArchivedModal').style.display = 'none';
        }
      });

      // Login administrativo ÚNICO
      document.getElementById('btn-admin-master-login').addEventListener('click', async function() {
        const senha = document.getElementById('admin-master-senha').value;
        const messageElement = document.getElementById('admin-master-message');
        const loginContainer = document.getElementById('admin-main-login-container');
        
        if (senha === 'adm00') { /* SENHA ALTERADA AQUI */
          const carregou = await carregarDadosAdmin(); // Carrega todos os dados admin
          if (carregou) {
            messageElement.textContent = '';
            messageElement.style.color = '';
            loginContainer.style.display = 'none';
            document.getElementById('admin-content-wrapper').classList.add('active');
            
            // Atualiza todos os campos com os dados carregados
            atualizarListaVendedores();
            atualizarSelectVendedores();
            document.getElementById('webhook-url').value = discordWebhookUrl;
            document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
            document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;

          } else {
            messageElement.textContent = '⚠️ Erro ao carregar dados administrativos. Dados padrão/locais serão usados.';
            messageElement.style.color = 'var(--warning)';
            loginContainer.style.display = 'none';
            document.getElementById('admin-content-wrapper').classList.add('active');
            
            // Atualiza todos os campos com os dados padrão/locais
            atualizarListaVendedores();
            atualizarSelectVendedores();
            document.getElementById('webhook-url').value = discordWebhookUrl;
            document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
            document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
          }
        } else {
          messageElement.textContent = 'Senha administrativa incorreta!';
          messageElement.style.color = 'var(--danger)';
          
          loginContainer.classList.remove('error-shake');
          void loginContainer.offsetWidth;
          loginContainer.classList.add('error-shake');
        }
      });

      // Event listener para o campo de senha principal de admin (Enter)
      document.getElementById('admin-master-senha').addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
              document.getElementById('btn-admin-master-login').click();
          }
      });
      
      document.getElementById('btn-adicionar-vendedor').addEventListener('click', async function() {
        const id = document.getElementById('vendedor-id').value.trim();
        const nome = document.getElementById('vendedor-nome').value.trim();
        const discordId = document.getElementById('vendedor-discord-id').value.trim();
        
        if (!id || !nome) return alert("Preencha ID e Nome!");
        if (vendedores.some(v => v.id === id)) return alert("ID já existe!");
        
        vendedores.push({ id, nome, discordId: discordId || id });
        const salvou = await salvarDadosAdmin(); // Salva na bin única
        if (salvou) {
          document.getElementById('vendedor-id').value = '';
          document.getElementById('vendedor-nome').value = '';
          document.getElementById('vendedor-discord-id').value = '';
          atualizarListaVendedores();
          atualizarSelectVendedores();
        }
      });

      document.getElementById('btn-salvar-webhook').addEventListener('click', async function() {
        const url = document.getElementById('webhook-url').value.trim();
        if (!url) {
          alert("Por favor, insira a URL da Webhook.");
          return;
        }
        discordWebhookUrl = url; // Atualiza a variável global
        await salvarDadosAdmin(); // Salva na bin única
        alert("URL da Webhook salva com sucesso!");
      });

      document.getElementById('btn-salvar-config').addEventListener('click', async function() {
        // As variáveis globais enviarReciboDiscord e baixarReciboLocalmente já são atualizadas
        // pelas funções toggle, então basta chamar salvarDadosAdmin()
        await salvarDadosAdmin(); // Salva na bin única
        alert("Configurações salvas com sucesso!");
      });
      
      initEvents();

      // Carregar todos os dados administrativos e o resumo global ao iniciar o sistema principal
      await carregarDadosAdmin();
      atualizarSelectVendedores();
      await carregarResumoGlobal();
    });

    function initEvents() {
      document.getElementById("btn-calcular").addEventListener("click", calcular);
      document.getElementById("btn-adicionar").addEventListener("click", adicionarCompra);
      document.getElementById("desconto").addEventListener("change", () => {
        calcular();
        atualizarResumo();
      });
      
      document.getElementById("botao-copiar").addEventListener("click", () => {
        const texto = document.getElementById("propt-container").textContent;
        navigator.clipboard.writeText(texto).then(() => {
          const originalText = document.getElementById("botao-copiar").innerHTML;
          document.getElementById("botao-copiar").innerHTML = '<i class="fas fa-check"></i> Copiado!';
          setTimeout(() => {
            document.getElementById("botao-copiar").innerHTML = originalText;
          }, 1500);
        });
      });
      
      document.getElementById("baixar-recibo").addEventListener("click", baixarRecibo);

      // Event listeners para filtro e ordenação na Análise de Recibos
      document.getElementById('filtro-vendedores').addEventListener('input', function(e) {
        const termo = e.target.value.toLowerCase();
        const itens = document.querySelectorAll('#resumo-vendedores .vendedor-item');
        
        itens.forEach(item => {
          const nome = item.querySelector('.vendedor-nome').textContent.toLowerCase();
          if (nome.includes(termo)) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
      
      document.getElementById('ordenar-por').addEventListener('change', function(e) {
        const criterio = e.target.value;
        const resumoContainer = document.getElementById('resumo-vendedores');
        const itens = Array.from(document.querySelectorAll('#resumo-vendedores .vendedor-item'));
        const resumoGeral = document.querySelector('#resumo-vendedores .resumo-geral');
        
        // Remover o resumo geral temporariamente
        if (resumoGeral) {
          resumoGeral.remove();
        }
        
        itens.sort((a, b) => {
          if (criterio === 'nome') {
            return a.querySelector('.vendedor-nome').textContent.localeCompare(b.querySelector('.vendedor-nome').textContent);
          } else if (criterio === 'valor') {
            const valorA = parseFloat(a.querySelector('.vendedor-total').textContent.replace(/[^\d,]/g, '').replace(',', '.'));
            const valorB = parseFloat(b.querySelector('.vendedor-total').textContent.replace(/[^\d,]/g, '').replace(',', '.'));
            return valorB - valorA;
          } else if (criterio === 'quantidade') {
            const qtdA = parseInt(a.querySelector('.vendedor-resumo > span:first-child').textContent);
            const qtdB = parseInt(b.querySelector('.vendedor-resumo > span:first-child').textContent);
            return qtdB - qtdA;
          }
          return 0;
        });
        
        // Limpar e reordenar os itens
        resumoContainer.innerHTML = '';
        itens.forEach(item => resumoContainer.appendChild(item));
        
        // Adicionar o resumo geral novamente no final
        if (resumoGeral) {
          resumoContainer.appendChild(resumoGeral);
        }
      });
    }

    function calcular() {
      const tipo = document.getElementById("arma").value;
      let qnt = parseInt(document.getElementById("quantidade").value);
      if (isNaN(qnt) || qnt < 1) qnt = 1;
      const lotes = Math.ceil(qnt / 15);
      const materiais = armas[tipo];
      let linha = `Acrescente número ${lotes} na fabricação: `;
      for (let item in materiais) {
        linha += `${item} ${materiais[item] * lotes} - `;
      }
      document.getElementById("propt-container").textContent = linha.slice(0, -3);
      const aplicarDesconto = document.getElementById("desconto").checked;
      const preco = precos[tipo];
      const unitario = aplicarDesconto ? preco.desconto : preco.normal;
      const total = unitario * qnt;
      
      document.getElementById("preco-unitario").innerHTML = 
        `<span style="color: ${aplicarDesconto ? '#00cec9' : '#fdcb6e'}">R$ ${unitario.toLocaleString('pt-BR')}</span>`;
      
      document.getElementById("preco-total").innerHTML = 
        `<span style="color: ${aplicarDesconto ? '#00cec9' : '#fdcb6e'}">R$ ${total.toLocaleString('pt-BR')}</span>`;
    }

    function adicionarCompra() {
      const btnAdicionar = document.getElementById("btn-adicionar");
      btnAdicionar.disabled = true;
      const tipo = document.getElementById("arma").value;
      let qnt = parseInt(document.getElementById("quantidade").value);
      if (isNaN(qnt) || qnt < 1) qnt = 1;
      
      const itemExistente = compras.find(c => c.arma === tipo);
      if (itemExistente) itemExistente.quantidade += qnt;
      else compras.push({ arma: tipo, quantidade: qnt });
      
      atualizarResumo();
      setTimeout(() => {
        btnAdicionar.disabled = false;
      }, 700);
      
      btnAdicionar.innerHTML = '<i class="fas fa-check"></i> Adicionado!';
      setTimeout(() => {
        btnAdicionar.innerHTML = '<i class="fas fa-cart-plus"></i> Adicionar ao Resumo';
      }, 1500);
    }

    function atualizarResumo() {
      const container = document.getElementById("lista-compras");
      container.innerHTML = "";
      let totalGeral = 0;
      const aplicarDesconto = document.getElementById("desconto").checked;
      
      compras.forEach((item, i) => {
        const precoUnit = aplicarDesconto ? precos[item.arma].desconto : precos[item.arma].normal;
        const totalItem = precoUnit * item.quantidade;
        totalGeral += totalItem;

        const div = document.createElement("div");
        div.className = "linha-compra";

        div.innerHTML = `
          <div>
            <strong>${item.quantidade}x</strong> ${item.arma}
            <div style="color: #c3a6ff; font-size: 0.9rem;">R$ ${totalItem.toLocaleString('pt-BR')}</div>
          </div>
          <button title="Remover item">
            <i class="fas fa-times"></i>
          </button>
        `;
        
        div.querySelector("button").onclick = () => {
          compras.splice(i, 1);
          atualizarResumo();
        };
        
        container.appendChild(div);
      });
      
      document.getElementById("total-geral").innerHTML = 
        `<span style="color: #00cec9">R$ ${totalGeral.toLocaleString('pt-BR')}</span>`;
    }

    function toggleDesconto() {
      const descontoCheckbox = document.getElementById("desconto");
      descontoCheckbox.checked = !descontoCheckbox.checked;
      calcular();
      atualizarResumo();
      
      const checkboxContainer = document.querySelector('.checkbox-container');
      if (descontoCheckbox.checked) {
        checkboxContainer.style.background = "rgba(0, 184, 148, 0.15)";
        checkboxContainer.style.borderColor = "#00b894";
      } else {
        checkboxContainer.style.background = "rgba(142, 68, 255, 0.1)";
        checkboxContainer.style.borderColor = "rgba(142, 68, 255, 0.3)";
      }
    }

    function toggleEnviarReciboDiscord() {
      enviarReciboDiscord = !enviarReciboDiscord;
      document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
    }

    function toggleBaixarReciboLocalmente() {
      baixarReciboLocalmente = !baixarReciboLocalmente;
      document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
    }

    function formatarDataHora() {
      const agora = new Date();
      const dia = String(agora.getDate()).padStart(2, '0');
      const mes = String(agora.getMonth() + 1).padStart(2, '0');
      const ano = agora.getFullYear();
      const horas = String(agora.getHours()).padStart(2, '0');
      const minutos = String(agora.getMinutes()).padStart(2, '0');
      const segundos = String(agora.getSeconds()).padStart(2, '0');
      
      return `${dia}-${mes}-${ano}_${horas}-${minutos}-${segundos}`;
    }

    async function baixarRecibo() {
      if (compras.length === 0) {
        alert("Adicione ao menos um item para finalizar a venda.");
        return;
      }
      const vendedorId = document.getElementById("nome-comprador").value;
      if (!vendedorId) {
        alert("Selecione quem realizou a venda.");
        return;
      }
      
      const vendedor = vendedores.find(v => v.id === vendedorId);
      const vendedorNome = vendedor ? vendedor.nome : "Desconhecido";
      const aplicarDesconto = document.getElementById("desconto").checked;

      let conteudo = "===== RECIBO DE VENDAS =====\n";
      conteudo += `SISTEMA DE VENDAS FIVEM v6.0\n`;
      conteudo += `Data: ${new Date().toLocaleDateString()}\n\n`;
      conteudo += `VENDIDO POR: ${vendedorNome}\n\n`;
      conteudo += "ITENS VENDIDOS:\n";
      conteudo += "--------------------------------\n";
      
      compras.forEach(item => {
        const precoUnit = aplicarDesconto ? precos[item.arma].desconto : precos[item.arma].normal;
        const totalItem = precoUnit * item.quantidade;
        conteudo += `${item.quantidade}x ${item.arma}\n`;
        conteudo += `  Preço unid: R$ ${precoUnit.toLocaleString('pt-BR')}\n`;
        conteudo += `  Total: R$ ${totalItem.toLocaleString('pt-BR')}\n`;
        conteudo += "--------------------------------\n";
      });
      
      const totalGeral = compras.reduce((acc, item) => {
        const precoUnit = aplicarDesconto ? precos[item.arma].desconto : precos[item.arma].normal;
        return acc + precoUnit * item.quantidade;
      }, 0);
      
      conteudo += `\nTOTAL GERAL: R$ ${totalGeral.toLocaleString('pt-BR')}\n`;
      conteudo += aplicarDesconto ? "DESCONTO DE PARCERIA APLICADO\n" : "";
      conteudo += "===============================\n";
      conteudo += "Sistema de Vendas FiveM © 2025 - Todos os direitos reservados";

      const fileName = `Comprovante de Venda - ${formatarDataHora()}.txt`;
      const blob = new Blob([conteudo], { type: "text/plain" });
      
      if (baixarReciboLocalmente) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);
        console.log("Recibo baixado localmente.");
      } else {
        console.log("Download local do recibo desativado.");
      }

      if (enviarReciboDiscord && discordWebhookUrl) {
        const formData = new FormData();
        formData.append('file', blob, fileName);

        const vendedorDiscordId = vendedor && vendedor.discordId ? `<@${vendedor.discordId}>` : `@${vendedorNome}`;
        const messageContent = `**Novo Recibo de Venda Gerado!**\n**Vendido Por:** ${vendedorDiscordId}`;
        formData.append('content', messageContent);

        try {
          const webhookResponse = await fetch(discordWebhookUrl, {
            method: "POST",
            body: formData
          });

          if (webhookResponse.ok) {
            console.log("Recibo (.txt) enviado para o Discord com sucesso!");
          } else {
            console.error("Erro ao enviar recibo para o Discord:", webhookResponse.status, webhookResponse.statusText);
            alert("Erro ao enviar recibo para o Discord. Verifique a URL da webhook.");
          }
        } catch (error) {
          console.error("Erro na requisição da webhook do Discord:", error);
          alert("Erro na requisição da webhook do Discord. Verifique sua conexão ou a URL.");
        }
      } else {
        console.warn("Envio de recibo para o Discord desativado ou URL da Webhook não configurada.");
      }

      compras = [];
      atualizarResumo();
      
      const originalText = document.getElementById("baixar-recibo").innerHTML;
      document.getElementById("baixar-recibo").innerHTML = '<i class="fas fa-check"></i> Recibo Gerado!';
      setTimeout(() => {
        document.getElementById("baixar-recibo").innerHTML = originalText;
      }, 2000);

      const lembreteContainer = document.getElementById("lembrete-container");
      lembreteContainer.innerHTML = `
        <div class="lembrete-comissao">
          <i class="fas fa-exclamation-circle"></i> 
          Lembre-se de retirar sua comissão de 50% e adicionar os outros 50% no Painel da Facção
        </div>
      `;
    }

    // Funções de análise de recibos
    function verificarDuplicados() {
      const duplicadosContainer = document.getElementById('duplicados-container');
      duplicadosContainer.innerHTML = '';
      
      const duplicados = [];
      const nomesArquivos = new Set();
      
      arquivosSelecionados.forEach(arquivo => {
        if (nomesArquivos.has(arquivo.name) || arquivosProcessadosSet.has(arquivo.name)) {
          duplicados.push(arquivo.name);
        } else {
          nomesArquivos.add(arquivo.name);
        }
      });
      
      if (duplicados.length > 0) {
        const warningDiv = document.createElement('div');
        warningDiv.className = 'duplicado-warning';
        warningDiv.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>Atenção!</strong> Os seguintes arquivos já foram processados ou estão duplicados na seleção:
            <ul style="margin-top: 5px; padding-left: 20px;">
              ${duplicados.map(nome => `<li>${nome}</li>`).join('')}
            </ul>
          </div>
        `;
        duplicadosContainer.appendChild(warningDiv);
      }
    }

    function atualizarListaArquivos() {
      const listaArquivos = document.getElementById('lista-arquivos');
      listaArquivos.innerHTML = '';
      
      if (arquivosSelecionados.length === 0) {
        listaArquivos.innerHTML = '<p>Nenhum arquivo selecionado</p>';
        return;
      }
      
      // Adiciona contador de arquivos
      const header = document.createElement('div');
      header.innerHTML = `<p><strong>${arquivosSelecionados.length} arquivo(s) selecionado(s)</strong></p>`;
      listaArquivos.appendChild(header);
      
      arquivosSelecionados.forEach(arquivo => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `<i class="fas fa-file-alt"></i> ${arquivo.name}`;
        listaArquivos.appendChild(fileItem);
      });
    }

    async function processarRecibos() {
      if (arquivosSelecionados.length === 0) {
        alert('Selecione pelo menos um arquivo de recibo para processar.');
        return;
      }
      
      const btnProcessar = document.getElementById('btn-processar');
      const originalText = btnProcessar.innerHTML;
      btnProcessar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
      btnProcessar.disabled = true;
      
      const resumo = {};
      let arquivosProcessadosComSucessoCount = 0; // Contador para arquivos processados nesta sessão
      const tiposMunicao = {
        "Rifle": 0,
        "Sub": 0,
        "Pistola": 0
      };
      
      maxValorVenda = 0; // Resetar o valor máximo para o gráfico
      
      const promises = arquivosSelecionados.map(arquivo => {
        return new Promise((resolve) => {
          // Verificar se o arquivo já foi processado anteriormente ou é duplicado na seleção atual
          if (arquivosProcessadosSet.has(arquivo.name)) {
            resolve(); // Pular arquivos já processados/duplicados
            return;
          }

          const reader = new FileReader();
          reader.onload = function(e) {
            const conteudo = e.target.result;
            const vendedorMatch = conteudo.match(/VENDIDO POR: (.+)/);
            
            if (vendedorMatch && vendedorMatch[1]) {
              const vendedor = vendedorMatch[1].trim();
              const itensMatch = conteudo.match(/\d+x Munição de .+/g);
              const totalGeralMatch = conteudo.match(/TOTAL GERAL: R\$\s*([\d.,]+)/);
              
              let totalMuni = 0;
              let totalValor = 0;
              const tipos = {};
              
              if (itensMatch) {
                itensMatch.forEach(item => {
                  const quantidadeMatch = item.match(/(\d+)x/);
                  const tipoMatch = item.match(/Munição de (\w+)/);
                  
                  if (quantidadeMatch && quantidadeMatch[1] && tipoMatch && tipoMatch[1]) {
                    const qtd = parseInt(quantidadeMatch[1]);
                    const tipo = tipoMatch[1];
                    totalMuni += qtd;
                    
                    // Contabiliza por tipo
                    if (!tipos[tipo]) tipos[tipo] = 0;
                    tipos[tipo] += qtd;
                    
                    // Atualiza total por tipo
                    if (tiposMunicao[tipo] !== undefined) {
                      tiposMunicao[tipo] += qtd;
                    }
                  }
                });
              }
              
              if (totalGeralMatch && totalGeralMatch[1]) {
                const valorString = totalGeralMatch[1];
                const valorLimpo = valorString.replace(/\./g, '').replace(',', '.');
                totalValor = parseFloat(valorLimpo);
                
                if (isNaN(totalValor)) {
                  console.error('Erro ao parsear valor:', valorString);
                  totalValor = 0;
                }
                
                // Atualizar valor máximo para o gráfico
                if (totalValor > maxValorVenda) {
                  maxValorVenda = totalValor;
                }
              }
              
              // Formata detalhes dos tipos
              let detalhesTipos = '';
              for (const tipo in tipos) {
                detalhesTipos += `${tipos[tipo]} ${tipo}, `;
              }
              detalhesTipos = detalhesTipos.replace(/,\s*$/, '');
              
              // Calcula a comissão (50% do valor total)
              const comissao = totalValor * 0.5;
              
              // Armazena os dados completos
              if (!resumo[vendedor]) {
                resumo[vendedor] = { totalMuni: 0, totalValor: 0, comissao: 0, detalhes: '' };
              }
              
              resumo[vendedor].totalMuni += totalMuni;
              resumo[vendedor].totalValor += totalValor;
              resumo[vendedor].comissao += comissao;
              resumo[vendedor].detalhes = detalhesTipos;
              
              // Adiciona o nome do arquivo ao set de arquivos processados
              arquivosProcessadosSet.add(arquivo.name);
              arquivosProcessadosComSucessoCount++;
            }
            resolve();
          };
          
          reader.readAsText(arquivo);
        });
      });

      await Promise.all(promises); // Espera todas as promises serem resolvidas

      if (arquivosProcessadosComSucessoCount > 0) {
        resultadosAnaliseAtual = resumo; // Armazena os resultados para possível adição ao resumo
        exibirResumo(resumo, tiposMunicao);
        await atualizarResumoGlobal(resumo); // Garante que o resumo global seja atualizado após o processamento
      } else {
        alert('Nenhum novo arquivo válido foi processado. Verifique se os arquivos estão no formato correto ou se já foram processados.');
      }
      
      btnProcessar.innerHTML = originalText;
      btnProcessar.disabled = false;
    }

    function exibirResumo(resumo, tiposMunicao) {
      const resumoContainer = document.getElementById('resumo-vendedores');
      resumoContainer.innerHTML = '';
      
      // Converter para array e ordenar por valor total (decrescente)
      const vendedores = Object.entries(resumo)
        .map(([nome, dados]) => ({ nome, ...dados }))
        .sort((a, b) => b.totalValor - a.totalValor);
      
      if (vendedores.length === 0) {
        resumoContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhum dado válido encontrado nos recibos</p>';
        return;
      }
      
      // Calcular totais gerais
      let totalVendas = 0;
      let totalComissao = 0;
      
      vendedores.forEach(vendedor => {
        totalVendas += vendedor.totalValor;
        totalComissao += vendedor.comissao;
        
        const vendedorItem = document.createElement('div');
        vendedorItem.className = 'vendedor-item';
        
        // Calcular porcentagem para o gráfico
        const porcentagem = maxValorVenda > 0 ? (vendedor.totalValor / maxValorVenda) * 100 : 0;
        
        vendedorItem.innerHTML = `
          <div class="vendedor-header">
            <div class="vendedor-nome">${vendedor.nome}</div>
            <div class="vendedor-total">R$ ${vendedor.totalValor.toLocaleString('pt-BR')}</div>
            <i class="fas fa-chevron-down toggle-icon"></i>
          </div>
          <div class="vendedor-detalhes">
            <div class="grafico-barras">
              <div class="barra" style="width: ${porcentagem}%"></div>
            </div>
            <div class="vendedor-resumo">
              <span><i class="fas fa-box"></i> ${vendedor.totalMuni.toLocaleString('pt-BR')} munições</span>
              <span>${vendedor.detalhes}</span>
            </div>
            <div class="vendedor-comissao">
              <span class="fac"><i class="fas fa-building"></i> +R$ ${vendedor.comissao.toLocaleString('pt-BR')} Facção</span>
              <span class="ganho"><i class="fas fa-hand-holding-usd"></i> -R$ ${vendedor.comissao.toLocaleString('pt-BR')} Comissão</span>
            </div>
          </div>
        `;
        
        // Adicionar evento de clique para expandir/recolher
        vendedorItem.addEventListener('click', function() {
          this.classList.toggle('expandido');
        });
        
        resumoContainer.appendChild(vendedorItem);
      });

      // Criar resumo geral DEPOIS dos vendedores
      const resumoGeral = document.createElement('div');
      resumoGeral.className = 'resumo-geral';
      resumoGeral.innerHTML = `
        <h3><i class="fas fa-chart-pie"></i> Resumo Geral</h3>
        <p><strong>Total de Vendas:</strong> R$ ${totalVendas.toLocaleString('pt-BR')}</p>
        <p><strong>Total em Comissões:</strong> R$ ${totalComissao.toLocaleString('pt-BR')}</p>
        <p><strong>Lucro Total:</strong> R$ ${(totalVendas - totalComissao).toLocaleString('pt-BR')}</p>
      `;
      resumoContainer.appendChild(resumoGeral);
    }

    async function arquivarRecibos() {
      if (Object.keys(resultadosAnaliseAtual).length === 0) {
        alert("Não há recibos processados para arquivar. Por favor, processe os recibos primeiro.");
        return;
      }

      const confirmacao = confirm("Deseja realmente arquivar os recibos processados? Isso irá adicioná-los à lista de arquivados e limpar os resultados da análise atual.");
      if (!confirmacao) {
        return;
      }

      // Adicionar os resultados da análise atual aos recibos arquivados
      const dataArquivamento = new Date().toLocaleString('pt-BR');
      for (const vendedorNome in resultadosAnaliseAtual) {
        const dadosVendedor = resultadosAnaliseAtual[vendedorNome];
        recibosArquivados.push({
          nome: vendedorNome,
          totalMuni: dadosVendedor.totalMuni,
          totalValor: dadosVendedor.totalValor,
          comissao: dadosVendedor.comissao,
          detalhes: dadosVendedor.detalhes,
          dataArquivamento: dataArquivamento
        });
      }

      // Salvar os dados administrativos atualizados (incluindo os recibos arquivados)
      const salvou = await salvarDadosAdmin();
      if (salvou) {
        alert("Recibos arquivados com sucesso!");
        
        // Limpar os resultados da análise atual e a lista de arquivos selecionados
        resultadosAnaliseAtual = {};
        arquivosSelecionados = [];
        arquivosProcessadosSet.clear();
        document.getElementById('recibo-upload').value = '';
        atualizarListaArquivos();
        document.getElementById('resumo-vendedores').innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Selecione e processe os recibos para ver os resultados</p>';
        document.getElementById('duplicados-container').innerHTML = '';

        // Atualizar a exibição dos recibos arquivados
        exibirArquivados();
      } else {
        alert("Erro ao arquivar recibos. Tente novamente.");
      }
    }

    async function limparRecibosArquivadosComSenha() {
        const senhaDigitada = document.getElementById('clear-archived-password').value;
        const messageElement = document.getElementById('clear-archived-message');
        const SENHA_ADMIN = 'adm00'; // Senha para limpar arquivados

        if (senhaDigitada !== SENHA_ADMIN) {
            messageElement.textContent = 'Senha incorreta!';
            return;
        }

        if (recibosArquivados.length === 0) {
            messageElement.textContent = "Não há recibos arquivados para limpar.";
            return;
        }

        recibosArquivados = []; // Zera o array de recibos arquivados
        const salvou = await salvarDadosAdmin(); // Salva a alteração na bin

        if (salvou) {
            alert("Recibos arquivados limpos com sucesso!");
            document.getElementById('confirmClearArchivedModal').style.display = 'none'; // Fecha o modal
            exibirArquivados(); // Atualiza a exibição para mostrar que está vazio
        } else {
            messageElement.textContent = "Erro ao limpar recibos arquivados. Tente novamente.";
        }
    }

    function exibirArquivados() {
      const listaArquivadosContainer = document.getElementById('lista-arquivados');
      listaArquivadosContainer.innerHTML = '';

      if (recibosArquivados.length === 0) {
        listaArquivadosContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhum recibo arquivado ainda.</p>';
        return;
      }

      // Agrupar por vendedor para exibir o total acumulado
      const resumoArquivadosPorVendedor = {};
      recibosArquivados.forEach(recibo => {
        if (!resumoArquivadosPorVendedor[recibo.nome]) {
          resumoArquivadosPorVendedor[recibo.nome] = {
            totalMuni: 0,
            totalValor: 0,
            comissao: 0,
            ultimosDetalhes: '',
            ultimaData: ''
          };
        }
        resumoArquivadosPorVendedor[recibo.nome].totalMuni += recibo.totalMuni;
        resumoArquivadosPorVendedor[recibo.nome].totalValor += recibo.totalValor;
        resumoArquivadosPorVendedor[recibo.nome].comissao += recibo.comissao;
        resumoArquivadosPorVendedor[recibo.nome].ultimosDetalhes = recibo.detalhes; // Pode ser útil ver os últimos detalhes
        resumoArquivadosPorVendedor[recibo.nome].ultimaData = recibo.dataArquivamento;
      });

      // Converter para array e ordenar por nome do vendedor
      const vendedoresArquivados = Object.entries(resumoArquivadosPorVendedor)
        .map(([nome, dados]) => ({ nome, ...dados }))
        .sort((a, b) => a.nome.localeCompare(b.nome));

      vendedoresArquivados.forEach(vendedor => {
        const item = document.createElement('div');
        item.className = 'arquivado-item';
        item.innerHTML = `
          <p><strong>Vendedor:</strong> ${vendedor.nome}</p>
          <p><strong>Total em Vendas:</strong> R$ ${vendedor.totalValor.toLocaleString('pt-BR')}</p>
          <p style="font-size: 0.85rem; color: #c3a6ff;">Último arquivamento: ${vendedor.ultimaData}</p>
        `;
        listaArquivadosContainer.appendChild(item);
      });
    }
  </script>
</body>
</html>
