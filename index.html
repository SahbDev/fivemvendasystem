<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Vendas FiveM - Sistema de Munições</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== ESTILOS GERAIS ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #8e44ff;
            --primary-dark: #5e0fa4;
            --accent: #00cec9;
            --text: #f0f0f0;
            --darker: #0a0a16;
            --dark-card: #1a1a2e;
            --warning: #fdcb6e;
            --danger: #ff4c4c;
            --secondary: #ff6b6b;
            --light: #fff;
            --text-secondary: #c3a6ff;
            --success: #00b894;
            --comissao: #fdcb6e;
            --fac: #00cec9;

            /* Variáveis do PAINELL.html para o novo painel de vendedores */
            --bg-primary-panel: #0a0a16; /* Fundo muito escuro */
            --bg-secondary-panel: rgba(26, 26, 46, 0.7); /* Fundo do painel com transparência */
            --item-bg-panel: rgba(30, 30, 50, 0.5); /* Fundo dos itens da lista com transparência */
            --item-hover-bg-panel: rgba(40, 40, 60, 0.7); /* Fundo do item ao passar o mouse */
            --text-light-panel: #e2e8f0; /* Texto claro */
            --text-muted-panel: #94a3b8; /* Texto secundário/cinza */
            --accent-blue-panel: #6366f1; /* Azul mais suave para destaque */
            --accent-blue-dark-panel: #4f46e5; /* Azul mais escuro para hover */
            --success-panel: #22c55e; /* Verde para sucesso */
            --danger-panel: #ef4444; /* Vermelho para perigo */
            --warning-panel: #f59e0b; /* Amarelo para aviso */
            --border-color-panel: rgba(148, 163, 184, 0.1); /* Borda muito sutil */
            --shadow-subtle-panel: rgba(0, 0, 0, 0.2); /* Sombra mais suave */
        }

        body {
            background: linear-gradient(135deg, var(--darker), #0c1e3e);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* ========== TELA DE LOGIN ========== */
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(circle at 10% 20%, rgba(142, 68, 255, 0.1) 0%, transparent 20%),
            radial-gradient(circle at 90% 80%, rgba(0, 206, 201, 0.1) 0%, transparent 20%);
        }

        .login-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background: rgba(26, 26, 46, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 50px 60px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
            0 0 50px rgba(142, 68, 255, 0.3),
            inset 0 0 15px rgba(142, 68, 255, 0.2);
            border: 1px solid rgba(142, 68, 255, 0.5);
            opacity: 1;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: loginEntrance 1.2s ease-out forwards;
        }

        @keyframes loginEntrance {
            0% {
                transform: translate(-50%, -40%);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .login-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 25px;
            margin-bottom: 35px;
        }

        .logo-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(142, 68, 255, 0.5),
            0 0 60px rgba(0, 206, 201, 0.3);
            animation: pulse 3s infinite alternate;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 30px rgba(142, 68, 255, 0.5), 0 0 60px rgba(0, 206, 201, 0.3);
            }
            100% {
                transform: scale(1.05);
                box-shadow: 0 0 40px rgba(142, 68, 255, 0.7), 0 0 80px rgba(0, 206, 201, 0.5);
            }
        }

        .logo-circle i {
            color: white;
            font-size: 3.5rem;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
        }

        .login-header h2 {
            font-size: 2.2rem;
            color: var(--text);
            font-weight: 600;
            letter-spacing: 1px;
            background: linear-gradient(to right, #f0f0f0, #c3a6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(142, 68, 255, 0.3);
        }

        .login-header p {
            color: #c3a6ff;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        #senha {
            width: 100%;
            padding: 18px 20px; /* Ajustado para centralizar o texto */
            font-size: 1.1rem;
            background: rgba(30, 30, 50, 0.5);
            color: var(--text);
            border: 2px solid rgba(142, 68, 255, 0.3);
            border-radius: 12px;
            transition: all 0.4s ease;
            outline: none;
            text-align: center; /* Centraliza o texto */
        }

        #senha:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 206, 201, 0.3);
            background: rgba(30, 30, 50, 0.7);
        }

        #senha::placeholder {
            color: rgba(195, 166, 255, 0.6);
        }

        .btn {
            padding: 16px;
            font-size: 1.2rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(142, 68, 255, 0.4);
            margin-top: 15px; /* Adicionado para espaçamento entre os botões */
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(142, 68, 255, 0.6);
        }

        .btn:active {
            transform: translateY(1px);
        }

        #login-message {
            margin-top: 20px;
            min-height: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .error-shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
        }

        /* CORREÇÃO DA ANIMAÇÃO DE SHAKE */
        @keyframes shake {
            0%, 100% {
                left: 50%;
            } /* Volta para a posição central */
            10%, 30%, 50%, 70%, 90% {
                left: calc(50% - 10px);
            } /* Move 10px para a esquerda */
            20%, 40%, 60%, 80% {
                left: calc(50% + 10px);
            } /* Move 10px para a direita */
        }

        .security-tip {
            margin-top: 30px;
            padding: 15px;
            background: rgba(253, 203, 110, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--warning); /* Mantido 4px conforme o OLD.html */
            font-size: 0.95rem;
            color: #fdcb6e;
            text-align: center;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .footer-note {
            position: absolute;
            bottom: 25px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            z-index: 5;
        }

        /* ========== SISTEMA PRINCIPAL ========== */
        #main-content {
            display: none;
            padding-bottom: 60px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            justify-content: center;
            padding-top: 40px;
        }

        .section {
            display: none;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            animation: fadeIn 0.8s ease-out;
            justify-content: center;
        }

        .section.active {
            display: flex;
        }

        .card {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(142, 68, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
            max-width: 400px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
            0 0 0 1px var(--primary);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(142, 68, 255, 0.3);
            justify-content: center; /* Centralize card headers */
        }

        .card-header i {
            color: var(--primary);
            font-size: 1.8rem;
            background: rgba(142, 68, 255, 0.1);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .card-header h2 {
            font-size: 1.5rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* ========== CALCULADORA DE MUNIÇÕES ========== */
        #propt-container {
            background: rgba(30, 30, 50, 0.7);
            border: 1px solid rgba(142, 68, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--light);
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            line-height: 1.5;
        }

        #lista-compras {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .linha-compra {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(30, 30, 50, 0.5);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .linha-compra:hover {
            background: rgba(142, 68, 255, 0.1);
            transform: translateX(5px);
        }

        .linha-compra button {
            background: var(--danger);
            color: var(--light);
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .linha-compra button:hover {
            background: #ff2e2e;
            transform: scale(1.1);
        }

        .total-box {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            border: 1px solid var(--primary);
        }

        .total-box p {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .total-box strong {
            font-size: 1.4rem;
            color: var(--accent);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 25px 0 15px;
            cursor: pointer;
            user-select: none;
            padding: 12px;
            background: rgba(142, 68, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 1px solid rgba(142, 68, 255, 0.3);
        }

        .checkbox-container:hover {
            background: rgba(142, 68, 255, 0.2);
            border-color: var(--primary);
        }

        .checkbox-container input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkbox-custom {
            position: relative;
            width: 24px;
            height: 24px;
            border: 2px solid var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: rgba(30, 30, 50, 0.7);
        }

        .checkbox-container input[type="checkbox"]:checked + .checkbox-custom {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-custom::after {
            content: "\f00c";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            color: white;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: absolute;
        }

        .checkbox-container input[type="checkbox"]:checked + .checkbox-custom::after {
            opacity: 1;
        }

        .checkbox-container span {
            flex: 1;
            font-weight: 500;
        }

        /* ========== ANÁLISE DE RECIBOS ========== */
        /* Removido #analise-recibos e .analise-container para simplificar o layout */

        .analise-card {
            flex: 1;
            min-width: 0;
            max-width: 500px;
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(142, 68, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .analise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
            0 0 0 1px var(--primary);
        }

        /* Estilo dos itens de vendedor */
        .vendedor-item {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .vendedor-item:hover {
            background: rgba(30, 30, 50, 0.8);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vendedor-nome {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .vendedor-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
        }

        /* Removido .vendedor-detalhes, .grafico-barras, .barra, .vendedor-resumo, .vendedor-comissao, .toggle-icon */

        /* Estilo para os arquivos */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: rgba(30, 30, 50, 0.5);
            border-radius: 10px;
            border: 1px dashed rgba(142, 68, 255, 0.3);
            width: 100%;
        }

        .file-item {
            padding: 10px;
            border-bottom: 1px solid rgba(142, 68, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item i {
            color: var(--primary);
        }

        /* Barra de rolagem personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 30, 50, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ========== BOTÕES E FORMULÁRIOS ========== */
        .btn-secondary {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success), #009d7c);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #c0392b);
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--warning), #e17055);
        }

        .btn-principal {
            display: block;
            width: 90%;
            margin: 20px auto 0;
            padding: 15px;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
        }

        select, input[type="number"], input[type="file"], input[type="text"] {
            width: 100%;
            max-width: 300px;
            padding: 14px;
            font-size: 1rem;
            background: rgba(30, 30, 50, 0.7);
            color: var(--light);
            border: 1px solid rgba(142, 68, 255, 0.5);
            border-radius: 10px;
            transition: all 0.3s ease;
            text-align: center;
        }

        select:focus, input[type="number"]:focus,
        input[type="file"]:focus, input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 206, 201, 0.3);
            outline: none;
        }

        /* ========== NAVEGAÇÃO ========== */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 12px 25px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid var(--primary);
        }

        .nav-tab.active {
            background: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(142, 68, 255, 0.4);
        }

        /* ========== RESUMO GERAL ========== */
        .resumo-geral {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }

        .resumo-geral h3 {
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .resumo-geral p {
            margin: 8px 0;
            font-size: 1.05rem;
        }

        .resumo-geral strong {
            color: var(--accent);
        }

        /* ========== EFEITOS E ANIMAÇÕES ========== */
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }

        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* ========== MARCA D'ÁGUA ========== */
        #marca-dagua {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            pointer-events: none;
            user-select: none;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-weight: 300;
        }

        #marca-dagua .borboleta {
            color: var(--accent);
            font-size: 1.2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
            100% {
                transform: translateY(0);
            }
        }

        /* ========== MELHORIAS SOLICITADAS ========== */
        /* Ajuste para os botões de processar e arquivar */
        /* Removido para aplicar flex-direction column no button-group */
        /* #btn-processar, #btn-arquivar-recibos {
            width: 50%;
            padding: 14px 20px;
            display: inline-flex;
            margin-top: 0;
        } */

        .comissao-info, #analise-recibos .form-group label {
            text-align: center;
        }

        /* Centralizar botões na análise de recibos */
        .button-group {
            display: flex;
            flex-direction: column; /* Alterado para empilhar os botões */
            justify-content: center;
            width: 100%;
            gap: 10px;
            margin-top: 15px;
        }

        /* Garante que os botões dentro de button-group tenham largura total */
        .button-group .btn {
            width: 100%;
        }

        /* Estilo específico para o input file */
        input[type="file"] {
            cursor: pointer;
        }

        input[type="file"]::file-selector-button {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        input[type="file"]::file-selector-button:hover {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary));
        }

        /* ========== ADMINISTRAÇÃO ========== */
        .admin-container {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .admin-form input {
            padding: 14px;
            font-size: 1rem;
            background: rgba(30, 30, 50, 0.7);
            color: var(--text);
            border: 1px solid rgba(142, 68, 255, 0.5);
            border-radius: 10px;
            width: 100%;
        }

        /* Aplicando o estilo de animação de textura aos botões da administração */
        .admin-form .btn,
        .admin-container .btn {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .admin-form .btn::before,
        .admin-container .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%; /* Mais largo para o efeito de varredura */
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: transform 0.8s ease-out;
            z-index: -1;
        }

        .admin-form .btn:hover::before,
        .admin-container .btn:hover::before {
            transform: translateX(50%); /* Move para a direita */
        }


        .lembrete-comissao {
            margin-top: 20px;
            padding: 15px;
            background: rgba(253, 203, 110, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--warning);
            font-size: 0.95rem;
            color: #fdcb6e;
            text-align: center;
        }

        /* ========== AJUSTES SOLICITADOS ========== */
        /* Ajuste para o container de login administrativo */
        .admin-login-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: transparent;
            border: none;
            box-shadow: none;
        }

        /* Estilo do campo de senha administrativa */
        .admin-senha {
            width: 100%;
            padding: 18px 20px; /* Ajustado para centralizar o texto */
            font-size: 1.1rem;
            background: rgba(30, 30, 50, 0.5);
            color: var(--text);
            border: 2px solid rgba(142, 68, 255, 0.3);
            border-radius: 12px;
            transition: all 0.4s ease;
            outline: none;
            margin-bottom: 25px;
            text-align: center; /* Centraliza o texto */
        }

        .admin-senha:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 206, 201, 0.3);
            background: rgba(30, 30, 50, 0.7);
        }

        #admin-senha::placeholder {
            color: rgba(195, 166, 255, 0.6);
        }

        /* Ajuste para o botão de acesso administrativo */
        .btn-admin-login {
            width: auto;
            padding: 12px 25px;
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            margin: 0 auto;
            display: block;
        }

        /* ========== NOVOS ESTILOS PARA RESUMO DE VENDAS ========== */
        .resumo-vendas-container {
            display: flex;
            gap: 30px;
            width: 100%;
            justify-content: center;
        }

        .resumo-card {
            flex: 1;
            min-width: 0;
            max-width: 500px;
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(142, 68, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .resumo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
            0 0 0 1px var(--primary);
        }

        .vendedores-container {
            max-height: 65vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* ========== NOVOS ESTILOS PARA ADMINISTRAR RESUMO ========== */
        #admin-resumo-content {
            margin-top: 30px;
        }

        #editar-resumo-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(26, 26, 46, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(142, 68, 255, 0.3);
        }

        #lista-vendedores-resumo {
            max-height: 50vh;
            overflow-y: auto;
        }

        #btn-zerar-resumo {
            width: 100%;
            margin-bottom: 10px;
        }

        /* ========== NOVO LOGIN PARA ANÁLISE DE RECIBOS ========== */
        #analise-login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: transparent;
            border: none;
            box-shadow: none;
        }

        #analise-login-container .card-header {
            justify-content: center;
            margin-bottom: 30px;
        }

        #analise-login-container .card-header i {
            font-size: 2rem;
        }

        #analise-login-container .card-header h2 {
            font-size: 1.5rem;
        }

        #analise-content {
            display: none;
        }

        /* ========== RESPONSIVIDADE ========== */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .card {
                max-width: 100%;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 10px;
            }

            /* Removido .analise-container para simplificar o layout */

            .login-container {
                padding: 40px 30px;
            }

            .logo-circle {
                width: 80px;
                height: 80px;
            }

            .login-header h2 {
                font-size: 1.8rem;
            }

            /* Ajustes para mobile nos botões */
            .button-group {
                flex-direction: column; /* Garante que os botões fiquem um abaixo do outro */
            }

            #btn-processar, #btn-arquivar-recibos {
                width: 100%; /* Garante que os botões ocupem a largura total */
                margin-left: 0;
            }

            select, input[type="number"], input[type="file"], input[type="text"] {
                max-width: 100%;
            }

            .admin-form {
                flex-direction: column;
            }

            /* Ajustes para o resumo de vendas em mobile */
            .resumo-vendas-container {
                flex-direction: column;
            }

            .resumo-card {
                max-width: 100%;
            }

            /* Ajustes para administração em mobile */
            #lista-vendedores-resumo .vendedor-admin-item {
                flex-direction: column;
                gap: 10px;
            }

            #lista-vendedores-resumo .vendedor-admin-item input {
                width: 100% !important;
            }

            /* Ajustes para o modal de lista de vendedores em mobile */
            #vendedoresListModal .modal-content {
                width: 95%;
                margin: 2.5vh auto;
                padding: 20px;
            }
            .vendedores-list-modal {
                grid-template-columns: 1fr; /* Uma coluna em telas muito pequenas */
            }
            .vendedor-modal-item .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            .vendedor-modal-item .action-buttons .btn {
                width: 100%;
            }
        }

        /* Novo estilo para o formulário de adicionar vendedor */
        .admin-form-grid {
            display: grid;
            grid-template-columns: 1fr; /* Alterado para uma única coluna */
            gap: 15px;
            margin-bottom: 20px;
            max-width: 400px;
            margin: 0 auto 20px auto;
        }

        .admin-form-grid input {
            width: 100%;
            margin: 0 auto; /* Centraliza os inputs */
        }

        .admin-form-grid button {
            grid-column: auto; /* Removido span 2 para alinhar em uma coluna */
            width: 100%;
        }

        /* Melhoria no estilo da lista de vendedores */
        .vendedores-list-modal { /* NOVO ESTILO PARA A LISTA DENTRO DO MODAL */
            background: rgba(30, 30, 50, 0.5);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(142, 68, 255, 0.3);
            /* Ajustado para ser mais quadrado e compacto */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px; /* Espaçamento reduzido */
        }

        .vendedor-modal-item { /* NOVO ESTILO PARA ITENS DENTRO DO MODAL */
            background: rgba(26, 26, 46, 0.7);
            border-radius: 10px;
            padding: 10px 12px; /* Padding ajustado */
            display: flex;
            flex-direction: column; /* Padrão para empilhar */
            justify-content: space-between;
            align-items: flex-start;
            border-left: 4px solid var(--accent);
            transition: all 0.2s ease;
            font-size: 0.95rem;
            color: var(--text);
            font-weight: 500;
            gap: 5px; /* Espaçamento interno reduzido */
        }

        .vendedor-modal-item:hover {
            background: rgba(26, 26, 46, 0.9);
            transform: translateX(3px);
        }

        .vendedor-modal-item .vendedor-info {
            margin-bottom: 0; /* Removido espaçamento extra */
            width: 100%;
            flex-grow: 1;
        }

        .vendedor-modal-item .vendedor-display {
            display: flex;
            flex-direction: row; /* ID e Nome na mesma linha */
            align-items: center;
            flex-wrap: wrap; /* Quebra a linha se necessário */
            gap: 10px; /* Espaçamento entre ID e Nome */
            flex-grow: 1; /* Ocupa o espaço disponível */
        }

        .vendedor-modal-item .vendedor-display span {
            white-space: nowrap; /* Evita quebra de linha no texto */
        }

        .vendedor-modal-item .vendedor-edit-fields {
            display: none; /* Escondido por padrão */
            flex-direction: column; /* Campos de edição empilhados */
            width: 100%;
            gap: 5px;
        }

        .vendedor-modal-item.editing .vendedor-display {
            display: none;
        }

        .vendedor-modal-item.editing .vendedor-edit-fields {
            display: flex;
        }

        .vendedor-modal-item input[type="text"] {
            width: 100%;
            padding: 6px 8px; /* Padding reduzido */
            font-size: 0.85rem; /* Fonte reduzida */
            background: rgba(30, 30, 50, 0.7);
            color: var(--light);
            border: 1px solid rgba(142, 68, 255, 0.5);
            border-radius: 6px;
            text-align: left;
        }

        .vendedor-modal-item input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 206, 201, 0.3);
            outline: none;
        }

        .vendedor-modal-item .action-buttons {
            display: flex;
            gap: 5px;
            width: 100%;
            justify-content: flex-end;
            margin-top: 5px; /* Espaçamento reduzido */
            flex-shrink: 0; /* Evita que os botões encolham */
        }

        .vendedor-modal-item .action-buttons .btn {
            width: auto; /* Ajusta a largura para o conteúdo */
            padding: 8px 12px; /* Padding para botões com texto */
            font-size: 0.9rem;
            margin-top: 0;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px; /* Espaçamento entre ícone e texto */
        }

        .vendedor-modal-item .action-buttons .btn-edit {
            background: linear-gradient(45deg, #00cec9, #009d9a);
        }

        .vendedor-modal-item .action-buttons .btn-edit:hover {
            background: linear-gradient(45deg, #009d9a, #00cec9);
        }

        .vendedor-modal-item .action-buttons .btn-danger {
            background: linear-gradient(45deg, var(--danger), #c0392b);
        }

        .vendedor-modal-item .action-buttons .btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, var(--danger));
        }

        .vendedor-modal-item .action-buttons .btn-success { /* Para o botão Salvar */
            background: linear-gradient(45deg, var(--success), #009d7c);
        }

        .vendedor-modal-item .action-buttons .btn-success:hover {
            background: linear-gradient(45deg, #009d7c, var(--success));
        }

        .vendedor-modal-item .action-buttons .btn-secondary { /* Para o botão Cancelar */
            background: linear-gradient(45deg, #6a11cb, #2575fc);
        }

        .vendedor-modal-item .action-buttons .btn-secondary:hover {
            background: linear-gradient(45deg, #2575fc, #6a11cb);
        }

        .empty-slot {
            background: rgba(30, 30, 50, 0.3);
            border-radius: 10px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(195, 166, 255, 0.5);
            font-style: italic;
            border: 1px dashed rgba(142, 68, 255, 0.2);
            min-height: 70px; /* Garante altura similar aos itens reais */
        }


        /* Estilos para o modal de edição */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.7); /* Black w/ opacity */
            backdrop-filter: blur(5px);
            padding-top: 60px;
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(16, 16, 32, 0.95));
            margin: 5% auto; /* 15% from the top and centered */
            padding: 30px;
            border: 1px solid var(--primary);
            border-radius: 20px;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-out;
        }

        /* NOVO MODAL DE LISTA DE VENDEDORES */
        #vendedoresListModal .modal-content {
            max-width: 1200px; /* Mais largo para a lista */
            max-height: 90vh; /* Altura máxima para rolagem */
            overflow-y: auto; /* Adiciona rolagem ao próprio modal-content */
            margin: 2.5vh auto; /* Centraliza verticalmente */
            display: flex;
            flex-direction: column;
            padding: 20px; /* Ajuste o padding */
        }

        #vendedoresListModal .modal-content h3 {
            margin-bottom: 15px;
        }

        #vendedoresListModal .modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 25px;
        }

        .modal-content h3 {
            color: var(--text);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .modal-content .form-group {
            margin-bottom: 15px;
        }

        .modal-content label {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 5px;
            text-align: left;
            width: 100%;
        }

        .modal-content input[type="text"] {
            width: 100%;
            max-width: none;
            padding: 12px;
            font-size: 1rem;
            background: rgba(30, 30, 50, 0.7);
            color: var(--light);
            border: 1px solid rgba(142, 68, 255, 0.5);
            border-radius: 8px;
        }

        .modal-content input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 206, 201, 0.3);
            outline: none;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-buttons .btn {
            width: 100%;
            margin-top: 0;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            transition: 0.3s;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--danger);
            text-decoration: none;
            cursor: pointer;
        }

        /* Ajuste para o container de login administrativo principal */
        #admin-main-login-container, #municao-main-login-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 30px;
            background: rgba(26, 26, 46, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
            0 0 50px rgba(142, 68, 255, 0.3),
            inset 0 0 15px rgba(142, 68, 255, 0.2);
            border: 1px solid rgba(142, 68, 255, 0.5);
            text-align: center;
        }

        #admin-main-login-container .login-header, #municao-main-login-container .login-header {
            margin-bottom: 30px;
        }

        #admin-main-login-container .login-header h2, #municao-main-login-container .login-header h2 {
            font-size: 2rem;
        }

        #admin-main-login-container .form-group, #municao-main-login-container .form-group {
            margin-bottom: 20px;
        }

        #admin-main-login-container .btn, #municao-main-login-container .btn {
            margin-top: 20px;
        }

        /* Estilos para as seções de administração após o login único */
        .admin-section-content, .municao-section-content {
            display: none; /* Hidden by default */
            flex-wrap: wrap; /* Permite que os cartões fiquem lado a lado */
            gap: 30px; /* Espaçamento entre os cartões */
            width: 100%;
            animation: fadeIn 0.8s ease-out;
            justify-content: center; /* Centraliza os cartões */
        }

        .admin-section-content.active, .municao-section-content.active {
            display: flex;
        }

        /* Ajustes para responsividade dos botões de ação */
        @media (max-width: 480px) {
            .vendedor-modal-item .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            .vendedor-modal-item .action-buttons .btn {
                width: 100%;
            }
        }

        /* NOVOS ESTILOS PARA ANALISE DE RECIBOS (DO OLD.HTML) */
        .analise-recibos-container {
            display: flex;
            gap: 30px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap; /* Adicionado para quebrar em telas menores */
        }

        .analise-card {
            flex: 1;
            min-width: 0;
            max-width: 500px;
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(16, 16, 32, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(142, 68, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .analise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
            0 0 0 1px var(--primary);
        }

        .duplicado-warning {
            background: rgba(253, 203, 110, 0.1);
            border-left: 4px solid var(--warning);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--warning);
            font-size: 0.9rem;
        }

        /* Centralização dos títulos */
        .card-header-center {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(142, 68, 255, 0.3);
        }

        /* Ajustes para mobile nos botões */
        @media (max-width: 768px) {
            .analise-recibos-container {
                flex-direction: column;
            }
            .analise-card {
                max-width: 100%;
            }
            .button-group {
                flex-direction: column;
            }
        }

        /* Adicionado para centralizar o label e input da webhook */
        .admin-form .form-group {
            align-items: center; /* Centraliza horizontalmente o conteúdo do form-group */
        }

        .admin-form .form-group label {
            text-align: center; /* Centraliza o texto do label */
            width: 100%; /* Garante que o label ocupe toda a largura para centralizar */
        }

        .admin-form .form-group input[type="text"] {
            max-width: 300px; /* Mantém a largura máxima para o input */
            margin: 0 auto; /* Centraliza o input */
        }

        /* Adicionado para centralizar o input de ID Discord */
        .admin-form-grid input[placeholder="ID Discord (opcional)"] {
            margin: 0 auto; /* Centraliza o input */
        }

        /* Estilos para o novo card de Arquivados */
        .arquivados-list {
            max-height: 65vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .arquivado-item {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .arquivado-item:hover {
            background: rgba(30, 30, 50, 0.8);
        }

        .arquivado-item strong {
            color: var(--accent);
        }

        .arquivado-item p {
            margin: 5px 0;
        }

        /* Estilo para o alerta de senha */
        .password-alert {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 76, 76, 0.1); /* Cor de perigo */
            border-radius: 8px;
            border-left: 4px solid var(--danger);
            font-size: 0.9rem;
            color: var(--danger);
            text-align: center;
            margin-bottom: 10px; /* Espaçamento antes do input */
        }

        /* Estilos para a nova seção de gerenciamento de munições */
        .municao-admin-item {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 10px;
            padding: 8px 12px; /* Reduzido para ser mais compacto */
            margin-bottom: 8px; /* Reduzido o espaçamento entre itens */
            display: flex;
            flex-direction: row; /* Alterado para linha */
            justify-content: space-between; /* Espaça nome e botões */
            align-items: center; /* Alinha verticalmente */
            gap: 10px; /* Espaçamento entre elementos na linha */
            border-left: 4px solid var(--accent);
            transition: all 0.2s ease;
        }

        .municao-admin-item:hover {
            background: rgba(26, 26, 46, 0.9);
            transform: translateX(3px);
        }

        .municao-admin-item .municao-name {
            font-size: 1rem; /* Levemente menor */
            font-weight: 600;
            color: var(--text);
            flex-grow: 1; /* Permite que o nome ocupe o espaço disponível */
            white-space: nowrap; /* Evita quebra de linha */
            overflow: hidden; /* Esconde o excesso */
            text-overflow: ellipsis; /* Adiciona reticências se o texto for muito longo */
        }

        .municao-admin-item .action-buttons {
            display: flex;
            gap: 5px; /* Espaçamento menor entre os botões de ação */
            flex-shrink: 0; /* Impede que os botões encolham */
        }

        .municao-admin-item .action-buttons .btn-icon {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.1rem; /* Tamanho do ícone */
            padding: 5px; /* Padding para área de clique */
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
            display: flex; /* Para centralizar o ícone */
            align-items: center;
            justify-content: center;
            border-radius: 5px; /* Pequeno arredondamento */
        }

        .municao-admin-item .action-buttons .btn-icon:hover {
            transform: scale(1.1);
        }

        .municao-admin-item .action-buttons .btn-icon.edit:hover {
            color: var(--accent);
        }

        .municao-admin-item .action-buttons .btn-icon.remove:hover {
            color: var(--danger);
        }

        /* Remove a seção de detalhes que não será mais usada no item da lista */
        .municao-admin-item .details {
            display: none;
        }

        .municao-list {
            /* Removido max-height e overflow-y para que a lista se ajuste ao conteúdo */
            /* A barra de rolagem será controlada pelo card pai se necessário */
            background: rgba(30, 30, 50, 0.5);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(142, 68, 255, 0.3);
            display: grid; /* Usa grid para organizar os itens em colunas */
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Ajusta para 250px de largura mínima */
            gap: 10px; /* Espaçamento entre os itens do grid */
        }

        /* Estilos para o modal de edição de munição */
        #editMunicaoModal .modal-content {
            max-width: 600px; /* Aumenta a largura para o formulário de materiais */
        }

        #editMunicaoModal .materials-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        #editMunicaoModal .materials-grid .material-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(30, 30, 50, 0.5);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(142, 68, 255, 0.3);
        }

        #editMunicaoModal .materials-grid .material-item input {
            flex: 1;
            padding: 8px;
            font-size: 0.9rem;
            max-width: none; /* Remove max-width para inputs dentro do modal */
        }

        #editMunicaoModal .materials-grid .material-item button {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        #editMunicaoModal .add-material-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        #editMunicaoModal .add-material-group input {
            flex: 1;
            max-width: none;
        }

        #editMunicaoModal .add-material-group button {
            width: auto;
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        /* Responsividade para a lista de munições */
        @media (max-width: 480px) {
            .municao-admin-item {
                flex-direction: column; /* Volta a ser coluna em telas muito pequenas */
                align-items: flex-start;
                gap: 5px;
            }
            .municao-admin-item .municao-name {
                width: 100%; /* Ocupa toda a largura */
                text-align: left;
            }
            .municao-admin-item .action-buttons {
                width: 100%;
                justify-content: flex-start;
            }
            #editMunicaoModal .materials-grid {
                grid-template-columns: 1fr;
            }
            .municao-list {
                grid-template-columns: 1fr; /* Uma coluna em telas muito pequenas */
            }
        }

        /* Estilos para o modal de backup/restauração */
        #backupRestoreModal .modal-content {
            max-width: 550px; /* Ajuste a largura se necessário */
        }

        #backupRestoreModal .modal-content h3 {
            font-size: 1.6rem;
        }

        #backupRestoreModal .modal-content p {
            margin-bottom: 15px;
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
        }

        #backupRestoreModal .modal-content .password-alert {
            margin-top: 10px;
            margin-bottom: 20px;
        }

        #backupRestoreModal .modal-content .admin-senha {
            margin-bottom: 20px;
        }

        /* Estilo para o botão de backup discreto (o "mini círculo") */
        #discreet-backup-button {
            display: none; /* REMOVIDO CONFORME SOLICITADO */
        }

        /* Opcional: Animação alternativa para "backup" */
        /*
        @keyframes pulse-small {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        #discreet-backup-button i {
            animation: pulse-small 1.5s infinite;
        }
        */

        /* NOVO: Estilos para animação de textura nos botões de backup */
        .btn-animated-texture {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-animated-texture::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%; /* Mais largo para o efeito de varredura */
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: transform 0.8s ease-out;
            z-index: -1;
        }

        .btn-animated-texture:hover::before {
            transform: translateX(50%); /* Move para a direita */
        }

        /* Espaçamento entre os botões de backup */
        .backup-buttons-group {
            display: flex;
            flex-direction: column; /* Para empilhar os botões */
            gap: 15px; /* Espaçamento entre eles */
            width: 100%;
            align-items: center;
        }

        /* ==================== ESTILOS DO POP-UP PERSONALIZADO ==================== */
        .custom-alert-popup {
            position: fixed;
            top: 20px; /* Distância do topo */
            right: 20px; /* Distância da direita */
            z-index: 10000; /* Acima de tudo */
            background: rgba(26, 26, 46, 0.9); /* Fundo escuro semitransparente */
            backdrop-filter: blur(10px); /* Efeito de desfoque */
            border-radius: 8px; /* Menor para ser mais discreto */
            padding: 10px 15px; /* Menor padding */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Sombra mais suave */
            display: flex;
            align-items: center;
            gap: 10px; /* Menor gap */
            min-width: 250px; /* Menor largura mínima */
            max-width: 350px; /* Menor largura máxima */
            opacity: 0;
            transform: translateX(100%); /* Começa fora da tela à direita */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* Transição mais rápida */
            border: 1px solid; /* Borda que muda de cor */
            pointer-events: none; /* Não interfere com cliques */
        }

        .custom-alert-popup.show {
            opacity: 1;
            transform: translateX(0); /* Desliza para dentro */
        }

        .custom-alert-popup.hide {
            opacity: 0;
            transform: translateX(100%); /* Desliza para fora */
        }

        .custom-alert-popup .popup-content {
            display: flex;
            align-items: center;
            gap: 10px; /* Menor gap */
            width: 100%;
        }

        .custom-alert-popup i {
            font-size: 1.4rem; /* Menor ícone */
            flex-shrink: 0; /* Não encolhe o ícone */
        }

        .custom-alert-popup p {
            font-size: 0.9rem; /* Menor fonte */
            font-weight: 500;
            color: var(--text);
            margin: 0;
            flex-grow: 1; /* Permite que o texto ocupe o espaço restante */
        }

        /* Cores e ícones para cada tipo de alerta */
        .custom-alert-popup.success {
            border-color: var(--success);
        }
        .custom-alert-popup.success i {
            color: var(--success);
        }

        .custom-alert-popup.error {
            border-color: var(--danger);
        }
        .custom-alert-popup.error i {
            color: var(--danger);
        }

        .custom-alert-popup.warning {
            border-color: var(--warning);
        }
        .custom-alert-popup.warning i {
            color: var(--warning);
        }

        .custom-alert-popup.info {
            border-color: var(--accent);
        }
        .custom-alert-popup.info i {
            color: var(--accent);
        }

        /* Responsividade para o pop-up */
        @media (max-width: 600px) {
            .custom-alert-popup {
                top: 10px; /* Mais próximo do topo em mobile */
                right: 10px;
                left: 10px; /* Ocupa quase toda a largura em telas pequenas */
                max-width: calc(100% - 20px);
                min-width: unset;
                padding: 10px 15px;
                gap: 8px;
            }
            .custom-alert-popup i {
                font-size: 1.2rem;
            }
            .custom-alert-popup p {
                font-size: 0.85rem;
            }
        }

        /* Estilos do PAINELL.html para o novo painel de vendedores */
        .main-wrapper-panel {
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 0 auto; /* Centraliza o painel */
            padding: 20px; /* Adiciona padding para não colar nas bordas */
        }

        .panel-container-panel {
            background: var(--bg-secondary-panel); /* Fundo semi-transparente */
            backdrop-filter: blur(8px); /* Efeito glassmorphism */
            border-radius: 16px;
            padding: 35px;
            box-shadow: 0 15px 30px var(--shadow-subtle-panel);
            border: 1px solid var(--border-color-panel);
            display: flex;
            flex-direction: column;
            gap: 30px;
            animation: fadeIn 0.8s ease-out;
        }

        .panel-header-panel {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color-panel);
            justify-content: center;
        }

        .panel-header-panel i {
            color: var(--accent-blue-panel);
            font-size: 2.8rem;
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        .panel-header-panel h2 {
            font-size: 2.4rem;
            color: var(--text-light-panel);
            font-weight: 700;
            letter-spacing: 0.8px;
            background: linear-gradient(to right, var(--text-light-panel), var(--accent-blue-panel));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .vendedores-list-panel {
            display: grid; /* Alterado para grid */
            gap: 8px; /* Espaçamento entre as linhas */
            padding: 0; /* Remove padding do container da lista */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* Mais quadrado */
        }

        .list-header-panel {
            display: none; /* Alterado para ocultar o cabeçalho */
            padding: 15px 20px;
            background-color: rgba(40, 40, 60, 0.8); /* Fundo para o cabeçalho */
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-muted-panel);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color-panel);
        }

        .vendedor-item-panel {
            display: flex; /* Alterado para flex */
            flex-direction: column; /* Empilha conteúdo */
            gap: 5px; /* Espaçamento interno reduzido */
            padding: 10px 12px; /* Padding ajustado */
            background: var(--item-bg-panel); /* Fundo semi-transparente */
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            font-size: 0.95rem;
            align-items: flex-start; /* Alinha itens ao topo */
            position: relative; /* Para posicionar os botões de ação */
        }

        .vendedor-item-panel:hover {
            background: var(--item-hover-bg-panel);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow-subtle-panel);
        }

        .vendedor-item-panel span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .vendedor-item-panel strong {
            color: var(--text-light-panel);
            font-weight: 500;
        }

        .vendedor-display-panel {
            display: flex; /* ID e Nome na mesma linha */
            flex-direction: row;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px; /* Espaçamento entre ID e Nome */
            flex-grow: 1; /* Ocupa o espaço disponível */
            width: 100%; /* Ocupa a largura total */
        }

        .vendedor-edit-fields-panel {
            display: none; /* Escondido por padrão */
            flex-direction: column; /* Campos de edição empilhados */
            gap: 5px;
            width: 100%; /* Ocupa a largura total */
        }

        .vendedor-item-panel.editing .vendedor-display-panel {
            display: none;
        }

        .vendedor-item-panel.editing .vendedor-edit-fields-panel {
            display: flex;
        }

        .vendedor-item-panel input[type="text"] {
            width: 100%;
            padding: 6px 8px; /* Padding reduzido */
            font-size: 0.85rem; /* Fonte reduzida */
            background-color: rgba(40, 40, 60, 0.9);
            color: var(--text-light-panel);
            border: 1px solid var(--border-color-panel);
            border-radius: 6px;
            transition: all 0.2s ease-in-out;
        }

        .vendedor-item-panel input[type="text"]:focus {
            border-color: var(--accent-blue-panel);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
            outline: none;
        }

        .action-buttons-panel {
            display: flex;
            gap: 5px; /* Espaçamento reduzido */
            justify-content: flex-end; /* Alinha botões à direita */
            width: 100%;
            margin-top: 5px; /* Espaçamento reduzido */
            flex-shrink: 0; /* Evita que os botões encolham */
        }

        .btn-panel {
            padding: 8px 12px;
            font-size: 0.8rem;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-panel:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-edit-panel {
            background-color: var(--accent-blue-panel);
        }
        .btn-edit-panel:hover {
            background-color: var(--accent-blue-dark-panel);
        }

        .btn-save-panel {
            background-color: var(--success-panel);
        }
        .btn-save-panel:hover {
            background-color: #16a34a;
        }

        .btn-cancel-panel {
            background-color: var(--text-muted-panel);
        }
        .btn-cancel-panel:hover {
            background-color: #64748b;
        }

        .btn-danger-panel {
            background-color: var(--danger-panel);
        }
        .btn-danger-panel:hover {
            background-color: #dc2626;
        }

        /* Empty State para quando não há vendedores */
        .empty-state-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px; /* Aumenta o padding */
            text-align: center;
            color: var(--text-muted-panel);
            font-style: italic;
            border: 1px dashed var(--border-color-panel);
            border-radius: 12px;
            background-color: rgba(40, 40, 60, 0.5);
            gap: 20px;
            margin-top: 20px; /* Espaçamento do cabeçalho da lista */
        }

        .empty-state-panel i {
            font-size: 3.5rem; /* Ícone maior */
            color: var(--text-muted-panel);
            opacity: 0.7;
        }

        .empty-state-panel p {
            font-size: 1.2rem; /* Texto maior */
            margin: 0;
            line-height: 1.5;
        }

        /* RESPONSIVIDADE do PAINELL.html */
        @media (max-width: 768px) {
            .main-wrapper-panel {
                padding: 20px 15px;
            }
            .panel-container-panel {
                padding: 25px;
            }
            .panel-header-panel h2 {
                font-size: 2rem;
            }
            .panel-header-panel i {
                font-size: 2.2rem;
            }

            .vendedores-list-panel {
                grid-template-columns: 1fr; /* Uma coluna em telas menores */
            }
            .list-header-panel {
                display: none; /* Oculta o cabeçalho da lista em mobile */
            }
            .vendedor-item-panel {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px; /* Espaçamento ajustado */
                padding: 15px;
            }
            .vendedor-display-panel {
                flex-direction: column; /* Volta a ser coluna para mobile */
                align-items: flex-start;
                gap: 5px; /* Espaçamento ajustado */
            }
            .vendedor-item-panel.editing .vendedor-edit-fields-panel {
                width: 100%;
            }
            .action-buttons-panel {
                flex-direction: column;
                width: 100%;
                gap: 8px;
                margin-top: 10px;
                justify-content: flex-start;
            }
            .btn-panel {
                width: 100%;
            }
            .empty-state-panel {
                padding: 40px 15px;
                gap: 15px;
            }
            .empty-state-panel i {
                font-size: 3rem;
            }
            .empty-state-panel p {
                font-size: 1rem;
            }
        }

        /* NOVO ESTILO PARA O MODAL DE RECIBOS ARQUIVADOS */
        #arquivedReceiptsModal .modal-content {
            max-width: 800px; /* Mais largo para a lista de recibos */
            max-height: 90vh; /* Altura máxima para rolagem */
            overflow-y: auto; /* Adiciona rolagem ao próprio modal-content */
            margin: 2.5vh auto; /* Centraliza verticalmente */
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        #arquivedReceiptsModal .modal-content h3 {
            margin-bottom: 15px;
        }

        #arquivedReceiptsModal .modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 25px;
        }

        .arquived-receipt-item {
            background: rgba(30, 30, 50, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--success);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .arquived-receipt-item:hover {
            background: rgba(30, 30, 50, 0.8);
        }

        .arquived-receipt-item strong {
            color: var(--accent);
        }

        .arquivado-item p {
            margin: 5px 0;
        }

        .arquived-receipt-item .receipt-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding-top: 0;
        }

        .arquived-receipt-item.expanded .receipt-details {
            max-height: 500px; /* Ajuste conforme necessário */
            padding-top: 10px;
        }

        .arquived-receipt-item .toggle-icon {
            transition: transform 0.3s ease;
            color: var(--accent);
            cursor: pointer;
        }

        .arquived-receipt-item.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .arquived-receipt-item .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .arquived-receipt-item .receipt-header .vendedor-nome {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .arquived-receipt-item .receipt-header .vendedor-total {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .arquived-receipt-item .receipt-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .arquived-receipt-item .receipt-info span {
            margin-right: 15px;
        }

        .arquived-receipt-item .receipt-info i {
            margin-right: 5px;
        }

        .arquived-receipt-item .receipt-materials {
            margin-top: 10px;
            padding: 8px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(142, 68, 255, 0.2);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .arquived-receipt-item .receipt-materials strong {
            color: var(--warning);
        }

        .arquived-receipt-item .receipt-comission {
            margin-top: 10px;
            padding: 8px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(142, 68, 255, 0.2);
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .arquived-receipt-item .receipt-comission .fac {
            color: var(--fac);
        }

        .arquived-receipt-item .receipt-comission .ganho {
            color: var(--comissao);
        }

        .arquived-receipt-item .receipt-comission i {
            margin-right: 5px;
        }

        /* Estilo para o botão de limpar arquivados dentro do modal */
        #arquivedReceiptsModal .modal-buttons {
            margin-top: 20px;
            justify-content: center;
        }

        #arquivedReceiptsModal .modal-buttons .btn {
            width: auto;
            padding: 10px 20px;
        }

        /* Responsividade para o modal de recibos arquivados */
        @media (max-width: 600px) {
            #arquivedReceiptsModal .modal-content {
                width: 95%;
                margin: 2.5vh auto;
                padding: 15px;
            }
            .arquived-receipt-item .receipt-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .arquived-receipt-item .receipt-header .vendedor-total {
                margin-top: 5px;
            }
            .arquived-receipt-item .receipt-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .arquived-receipt-item .receipt-info span {
                margin-right: 0;
            }
            .arquived-receipt-item .receipt-comission {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
<!-- Pop-up de Mensagens Personalizado -->
<div id="custom-alert-popup" class="custom-alert-popup">
    <div class="popup-content">
        <i id="popup-icon" class="fas"></i>
        <p id="popup-message"></p>
    </div>
</div>
<!-- Fim do Pop-up de Mensagens Personalizado -->

<!-- ========== TELA DE LOGIN ========== -->
<div id="particles-js"></div>
<div id="fireworks"></div>

<div class="login-container">
    <div class="login-header">
        <div class="logo-circle">
            <i class="fas fa-lock"></i>
        </div>
        <div>
            <h2>Acesso Restrito</h2>
            <p>Sistema de Vendas FiveM Security System</p>
        </div>
    </div>

    <div class="form-group">
        <input type="password" id="senha" placeholder="Digite a senha de acesso"/>
    </div>

    <!-- Novo checkbox para "Lembrar-me" -->
    <div class="checkbox-container" style="margin-top: 10px; margin-bottom: 20px;"
         onclick="document.getElementById('lembrar-me').checked = !document.getElementById('lembrar-me').checked;">
        <input type="checkbox" id="lembrar-me">
        <div class="checkbox-custom"></div>
        <span>Lembrar-me neste dispositivo</span>
    </div>

    <button class="btn" id="btn-login-membro">
        <i class="fas fa-user"></i> Acessar como Membro
    </button>

    <button class="btn" id="btn-login-admin">
        <i class="fas fa-user-shield"></i> Acessar como Administrador
    </button>

    <div id="login-message"></div>

    <div class="security-tip">
        <i class="fas fa-shield-alt"></i> Sistema protegido com criptografia AES-256
    </div>
</div>

<div class="footer-note">
    Sistema de Vendas FiveM © 2025 - Todos os direitos reservados
</div>

<!-- ========== SISTEMA PRINCIPAL ========== -->
<div id="main-content">
    <div class="container">
        <div class="nav-tabs">
            <div class="nav-tab active" data-target="calculadora" id="tab-calculadora">Calculadora de Munições</div>
            <div class="nav-tab" data-target="analise" id="tab-analise">Análise de Recibos</div>
            <div class="nav-tab" data-target="admin" id="tab-admin">Administração</div>
            <div class="nav-tab" data-target="gerenciar-municoes" id="tab-gerenciar-municoes">Gerenciar Munições</div>
        </div>

        <!-- Calculadora de Munições -->
        <div id="calculadora" class="section active">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-calculator"></i>
                    <h2>Calculadora de Munições</h2>
                </div>

                <div class="form-group">
                    <label for="arma"><i class="fas fa-gun"></i> Tipo de Munição</label>
                    <select id="arma" onchange="calcular()">
                        <!-- As opções serão carregadas dinamicamente pelo JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="quantidade"><i class="fas fa-boxes"></i> Quantidade</label>
                    <input type="number" id="quantidade" value="1" min="1" onchange="calcular()"/>
                </div>

                <button class="btn" id="btn-calcular" onclick="calcular()">
                    <i class="fas fa-cogs"></i> Calcular Quantidade
                </button>

                <div id="propt-container"></div>

                <button class="btn btn-secondary" id="botao-copiar">
                    <i class="fas fa-copy"></i> Copie o PROPT Acima e Cole no F8
                </button>

                <div class="form-group"
                     style="margin-top: 20px; background: rgba(253, 203, 110, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid var(--warning);">
                    <p><i class="fas fa-lightbulb"></i> <strong>Dica:</strong></p>
                    <p id="calculadora-dica">Para evitar falta de materiais, use quantidades múltiplas da base de
                        produção da munição selecionada.</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-dollar-sign"></i>
                    <h2>Valor das Munições</h2>
                </div>

                <div class="total-box">
                    <p>Preço por Unidade</p>
                    <p><strong id="preco-unitario">-</strong></p>
                </div>

                <div class="total-box">
                    <p>Valor Total da Produção</p>
                    <p><strong id="preco-total">-</strong></p>
                </div>

                <button class="btn btn-success btn-principal" id="btn-adicionar">
                    <i class="fas fa-cart-plus"></i> Adicionar ao Resumo
                </button>

                <div class="checkbox-container" onclick="toggleDesconto()">
                    <input type="checkbox" id="desconto">
                    <div class="checkbox-custom"></div>
                    <span>Aplicar desconto de parceria</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-receipt"></i>
                    <h2>Resumo da Venda</h2>
                </div>

                <div id="lista-compras"></div>

                <div class="form-group">
                    <label><i class="fas fa-user-tie"></i> Vendido Por</label>
                    <select id="nome-comprador">
                        <option value="">-- Selecione o Vendedor --</option>
                        <!-- Os vendedores serão carregados dinamicamente -->
                    </select>
                </div>

                <div class="total-box">
                    <p>Total Geral da Venda</p>
                    <p><strong id="total-geral">R$ 0</strong></p>
                </div>

                <button class="btn btn-warning btn-principal" id="baixar-recibo">
                    <i class="fas fa-file-download"></i> Finalizar Venda e Gerar Recibo
                </button>
                <div id="lembrete-container" style="margin-top: 25px;"></div>
            </div>
        </div>

        <!-- Análise de Recibos -->
        <div id="analise" class="section">
            <!-- Card de Upload -->
            <div class="analise-card">
                <div class="card-header-center">
                    <i class="fas fa-file-upload"></i>
                    <h2>Upload de Recibos</h2>
                </div>

                <div class="comissao-info">
                    <i class="fas fa-money-bill-wave"></i> A comissão para vendedores é de 50% do valor total das
                    vendas
                </div>

                <div class="form-group">
                    <label><i class="fas fa-file-upload"></i> Selecione os Recibos (.txt)</label>
                    <input type="file" id="recibo-upload" multiple accept=".txt">
                </div>

                <div class="file-list" id="lista-arquivos">
                    <p>Nenhum arquivo selecionado</p>
                </div>

                <div id="duplicados-container"></div>

                <div class="button-group">
                    <button class="btn btn-secondary" id="btn-processar">
                        <i class="fas fa-cogs"></i> Processar Recibos
                    </button>
                </div>
            </div>

            <!-- Card de Resultados da Análise Simples -->
            <div class="analise-card">
                <div class="card-header-center">
                    <i class="fas fa-chart-simple"></i>
                    <h2>Resultados da Análise</h2>
                </div>

                <div id="resumo-vendedores-simples" style="max-height: 65vh; overflow-y: auto;">
                    <p style="text-align: center; color: var(--text-secondary);">Selecione e processe os recibos
                        para ver os resultados</p>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" id="btn-arquivar-recibos">
                        <i class="fas fa-archive"></i> Arquivar Recibos
                    </button>
                    <button class="btn btn-info" id="btn-abrir-recibos-arquivados">
                        <i class="fas fa-box-archive"></i> Recibos Arquivados
                    </button>
                </div>
            </div>
        </div>

        <!-- Administração -->
        <div id="admin" class="section">
            <!-- Conteúdo da Administração (sem login separado) -->
            <div id="admin-content-wrapper" class="admin-section-content active">
                <!-- Gerenciar Vendedores -->
                <div class="resumo-card">
                    <div class="card-header">
                        <i class="fas fa-users"></i>
                        <h2>Gerenciar Vendedores</h2>
                    </div>
                    <div class="admin-container">
                        <div class="admin-form-grid">
                            <input type="text" id="vendedor-id" placeholder="ID do Vendedor">
                            <input type="text" id="vendedor-nome" placeholder="Nome do Vendedor">
                            <button class="btn btn-success btn-animated-texture" id="btn-adicionar-vendedor">
                                <i class="fas fa-plus"></i> Adicionar
                            </button>
                        </div>
                        <button class="btn btn-secondary btn-animated-texture" id="btn-abrir-lista-vendedores">
                            <i class="fas fa-list"></i> Lista de Vendedores
                        </button>
                    </div>
                </div>

                <!-- Gerenciar Webhook do Discord (AGORA COM CONFIGURAÇÕES DE RECIBO) -->
                <div class="resumo-card">
                    <div class="card-header">
                        <i class="fab fa-discord"></i>
                        <h2>Gerenciar Webhook & Recibos</h2>
                    </div>
                    <div class="admin-container">
                        <div class="admin-form">
                            <div class="form-group">
                                <label for="webhook-url">URL da Webhook do Discord:</label>
                                <input type="text" id="webhook-url" placeholder="Cole a URL da Webhook aqui">
                            </div>
                            <div class="checkbox-container" onclick="toggleEnviarReciboDiscord()">
                                <input type="checkbox" id="toggle-discord-send">
                                <div class="checkbox-custom"></div>
                                <span>Enviar recibo para o Discord</span>
                            </div>
                            <div class="checkbox-container" onclick="toggleBaixarReciboLocalmente()">
                                <input type="checkbox" id="toggle-local-download">
                                <div class="checkbox-custom"></div>
                                <span>Baixar recibo localmente</span>
                            </div>
                            <button class="btn btn-success btn-animated-texture" id="btn-salvar-config">
                                <i class="fas fa-save"></i> Salvar Configurações
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card de Backup e Restauração -->
                <div class="resumo-card">
                    <div class="card-header">
                        <i class="fas fa-database"></i>
                        <h2>Backup e Restauração</h2>
                    </div>
                    <div class="admin-container">
                        <p style="text-align: center; margin-bottom: 20px; color: var(--text-secondary);">
                            Gerencie seus dados do sistema.
                        </p>
                        <div class="backup-buttons-group">
                            <button class="btn btn-secondary btn-animated-texture" id="btn-criar-backup">
                                <i class="fas fa-cloud-upload-alt"></i> Criar Backup
                            </button>
                            <button class="btn btn-warning btn-animated-texture" id="btn-restaurar-backup">
                                <i class="fas fa-cloud-download-alt"></i> Restaurar Backup
                            </button>
                            <button class="btn btn-danger btn-animated-texture" id="btn-restaurar-padrao">
                                <i class="fas fa-undo-alt"></i> Restaurar Padrão
                            </button>
                        </div>
                        <div id="last-backup-info"
                             style="margin-top: 20px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">
                            <!-- Informação do último backup será carregada aqui -->
                        </div>
                        <div class="security-tip" style="margin-top: 20px;">
                            <i class="fas fa-exclamation-triangle"></i> A restauração de um backup ou padrão
                            substituirá todos os dados atuais. Use com cautela!
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gerenciar Munições (NOVA SEÇÃO SEPARADA) -->
        <div id="gerenciar-municoes" class="section">
            <!-- Conteúdo de Gerenciamento de Munições (sem login separado) -->
            <div id="municao-content-wrapper" class="municao-section-content active">
                <!-- Card para Adicionar Munição -->
                <div class="resumo-card">
                    <div class="card-header">
                        <i class="fas fa-plus-circle"></i>
                        <h2>Adicionar Nova Munição</h2>
                    </div>
                    <div class="admin-container">
                        <div class="admin-form-grid">
                            <input type="text" id="municao-nome" placeholder="Nome da Munição">
                            <input type="number" id="municao-preco-normal" placeholder="Preço Normal" min="0">
                            <input type="number" id="municao-preco-desconto" placeholder="Preço Desconto" min="0">
                            <input type="number" id="municao-base-producao" placeholder="Base de Produção (ex: 15)"
                                   min="1">
                            <button class="btn btn-success btn-animated-texture" id="btn-adicionar-municao">
                                <i class="fas fa-plus"></i> Adicionar Munição
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card para Lista de Munições -->
                <div class="resumo-card">
                    <div class="card-header">
                        <i class="fas fa-list"></i>
                        <h2>Munições Cadastradas</h2>
                    </div>
                    <div class="admin-container">
                        <div class="municao-list" id="lista-municoes">
                            <!-- Lista de munições será carregada aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="marca-dagua">
        <span>Sistema Profissional Sistema de Vendas FiveM v6.0</span>
        <span class="borboleta">🦋</span>
        <span>Criado por Sammy Lee | Discord: @ssammylee</span>
    </div>
</div>

<!-- Modal de Edição de Munição -->
<div id="editMunicaoModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeEditMunicaoModal">&times;</span>
        <h3>Editar Munição</h3>
        <div class="form-group">
            <label for="edit-municao-nome">Nome da Munição:</label>
            <input type="text" id="edit-municao-nome">
        </div>
        <div class="form-group">
            <label for="edit-municao-preco-normal">Preço Normal:</label>
            <input type="number" id="edit-municao-preco-normal" min="0">
            <small style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">(Preço por unidade de
                munição)</small>
        </div>
        <div class="form-group">
            <label for="edit-municao-preco-desconto">Preço Desconto:</label>
            <input type="number" id="edit-municao-preco-desconto" min="0">
            <small style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 5px;">(Preço por unidade de
                munição com desconto)</small>
        </div>
        <div class="form-group">
            <label for="edit-municao-base-producao">Base de Produção (unidades mínimas para produção/Lote):</label>
            <input type="number" id="edit-municao-base-producao" min="1">
        </div>
        <div class="form-group">
            <label>Materiais Necessários (para 1 lote):</label>
            <div id="edit-municao-materials-grid" class="materials-grid">
                <!-- Materiais serão carregados aqui -->
            </div>
            <div class="add-material-group">
                <input type="text" id="new-material-name" placeholder="Nome do Material">
                <input type="number" id="new-material-quantity" placeholder="Quantidade" min="1">
                <button class="btn btn-secondary btn-animated-texture" id="btn-add-material"><i class="fas fa-plus"></i> Add Material
                </button>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn btn-success btn-animated-texture" id="btn-salvar-edicao-municao">
                <i class="fas fa-save"></i> Salvar Alterações
            </button>
            <button class="btn btn-danger btn-animated-texture" id="btn-cancelar-edicao-municao">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Limpeza de Arquivados -->
<div id="confirmClearArchivedModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeClearArchivedModal">&times;</span>
        <h3>Confirmar Limpeza de Arquivados</h3>
        <div class="password-alert">
            <i class="fas fa-exclamation-triangle"></i> Realmente deseja prosseguir? Todos os dados arquivados serão
            perdidos. Digite a senha para confirmar.
        </div>
        <div class="form-group">
            <input type="password" id="clear-archived-password" placeholder="Digite a senha" class="admin-senha">
        </div>
        <div class="modal-buttons">
            <button class="btn btn-danger btn-animated-texture" id="btn-confirm-clear-archived">
                <i class="fas fa-trash"></i> Confirmar Limpeza
            </button>
            <button class="btn btn-secondary btn-animated-texture" id="btn-cancel-clear-archived">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
        <div id="clear-archived-message" style="margin-top: 10px; color: var(--danger);"></div>
    </div>
</div>

<!-- NOVO: Modal de Backup/Restauração/Padrão -->
<div id="backupRestoreModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeBackupRestoreModal">&times;</span>
        <h3 id="backup-modal-title"></h3>
        <p id="backup-modal-message"></p>
        <div class="password-alert" id="backup-password-alert">
            <i class="fas fa-exclamation-triangle"></i> Esta é uma operação crítica. Digite a senha administrativa para
            confirmar.
        </div>
        <div class="form-group">
            <input type="password" id="backup-admin-password" placeholder="Digite a senha administrativa"
                   class="admin-senha">
        </div>
        <div class="modal-buttons">
            <button class="btn btn-success btn-animated-texture" id="btn-confirm-backup-action">
                <i class="fas fa-check"></i> Confirmar
            </button>
            <button class="btn btn-secondary btn-animated-texture" id="btn-cancel-backup-action">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
        <div id="backup-action-message" style="margin-top: 10px; color: var(--danger);"></div>
    </div>
</div>
<!-- FIM DO NOVO MODAL -->

<!-- NOVO: Modal de Gerenciar Vendedores (agora é um modal, não uma seção) -->
<div id="vendedoresListModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeVendedoresListModal">&times;</span>
        <div class="panel-header-panel">
            <i class="fas fa-users-cog"></i>
            <h2>Gerenciar Vendedores</h2>
        </div>

        <!-- Cabeçalho da Lista (para desktop) -->
        <div class="list-header-panel">
            <!-- Conteúdo removido para ocultar o cabeçalho -->
        </div>

        <!-- Lista de Vendedores -->
        <div class="vendedores-list-panel" id="lista-vendedores-panel-modal">
            <!-- Vendedores serão carregados aqui -->
        </div>
    </div>
</div>
<!-- FIM DO NOVO MODAL DE GERENCIAR VENDEDORES -->

<!-- NOVO: Modal de Recibos Arquivados -->
<div id="arquivedReceiptsModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeArquivedReceiptsModal">&times;</span>
        <div class="card-header-center">
            <i class="fas fa-box-archive"></i>
            <h2>Recibos Arquivados</h2>
        </div>
        <div id="lista-arquivados-modal" class="arquivados-list">
            <p style="text-align: center; color: var(--text-secondary);">Nenhum recibo arquivado ainda.</p>
        </div>
        <div class="modal-buttons">
            <button class="btn btn-danger btn-animated-texture" id="btn-limpar-arquivados-modal">
                <i class="fas fa-eraser"></i> Limpar Arquivados
            </button>
        </div>
    </div>
</div>
<!-- FIM DO NOVO MODAL DE RECIBOS ARQUIVADOS -->

<script>
    // ================= CONFIGURAÇÕES DA API =================
    const JSONBIN_API_KEY = "$2a$10$B2ei2N0lbw3uuXk7JcOdMOtYxjT/lp179qx0hDuDenkTfRD9Tdj1O";

    // Configurações da nova bin para resumo global
    const RESUMO_BIN_ID = "688421fef7e7a370d1ee0b15";
    const RESUMO_API_KEY = JSONBIN_API_KEY;
    const RESUMO_URL = `https://api.jsonbin.io/v3/b/${RESUMO_BIN_ID}`;

    // NOVA BIN ÚNICA PARA ADMINISTRAÇÃO
    const BIN_ADMIN_ID = "68920a0af7e7a370d1f46299"; // ID da bin única para o painel administrativo
    const BIN_ADMIN_API_KEY = JSONBIN_API_KEY; // Reutiliza a mesma chave mestra
    const BIN_ADMIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ADMIN_ID}`;

    // NOVA BIN PARA BACKUPS (ADICIONE ESTA LINHA)
    const BIN_BACKUP_ID = "68930deeae596e708fc2e247"; // <--- SUBSTITUA ESTE ID POR UM NOVO ID DO JSONBIN.IO
    const BIN_BACKUP_API_KEY = JSONBIN_API_KEY;
    const BIN_BACKUP_URL = `https://api.jsonbin.io/v3/b/${BIN_BACKUP_ID}`;

    // NOVA BIN PARA DADOS PADRÃO DE FÁBRICA
    const BIN_DEFAULT_ID = "689310fb7b4b8670d8ae7f51"; // <--- SUBSTITUA ESTE ID POR UM NOVO ID DO JSONBIN.IO
    const BIN_DEFAULT_API_KEY = JSONBIN_API_KEY;
    const BIN_DEFAULT_URL = `https://api.jsonbin.io/v3/b/${BIN_DEFAULT_ID}`;

    // ================= DADOS DO SISTEMA =================
    // Lista de munições (será carregada da BIN_ADMIN_ID)
    let municoes = [];

    // Lista de vendedores (será carregada da BIN_ADMIN_ID)
    let vendedores = [];
    let compras = [];
    let arquivosSelecionados = [];
    let maxValorVenda = 0;
    let resumoGlobal = {};
    let discordWebhookUrl = ""; // Variável para armazenar a URL da webhook
    let arquivosProcessadosSet = new Set(); // Para controle de arquivos duplicados na análise de recibos
    let resultadosAnaliseAtual = {}; // Para armazenar os resultados da análise atual
    let recibosArquivados = []; // Nova variável para armazenar os recibos arquivados
    let lastBackupDate = null; // Para armazenar a data do último backup

    // Variáveis globais para controle de envio/download de recibo
    let enviarReciboDiscord = true;
    let baixarReciboLocalmente = true;

    // Variável para armazenar o tipo de usuário logado
    let currentUserRole = null; // 'membro' ou 'admin'

    // ================= SENHAS DE ACESSO =================
    const SENHA_MEMBRO = "adm00"; // Senha para o login de membro
    const SENHA_ADMIN = "adm00"; // Senha para o login administrativo e outras áreas restritas
    // A SENHA_MUNICAO não é mais usada para login separado, mas mantida caso haja outras validações futuras.
    const SENHA_MUNICAO = "adm00"; 

    // ================= FUNÇÕES DA API =================

    // Função para carregar TODOS os dados administrativos da BIN_ADMIN_ID
    async function carregarDadosAdmin() {
        try {
            const response = await fetch(BIN_ADMIN_URL, {
                headers: {
                    "X-Master-Key": BIN_ADMIN_API_KEY,
                    "Content-Type": "application/json",
                    "X-Bin-Private": "false"
                }
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro ao carregar dados administrativos. Verifique o console.", "error");
                throw new Error("Erro na requisição ao carregar dados administrativos");
            }

            const data = await response.json();
            if (data.record) {
                // Carrega vendedores
                if (Array.isArray(data.record.vendedores)) {
                    vendedores = data.record.vendedores.map(v => ({
                        id: v.id,
                        nome: v.nome
                    }));
                    console.log("Vendedores carregados com sucesso:", vendedores);
                } else {
                    console.warn("Formato inesperado para vendedores na bin admin. Inicializando vazio.");
                    vendedores = [];
                }

                // Carrega URL da webhook
                if (typeof data.record.discordWebhookUrl === 'string') {
                    discordWebhookUrl = data.record.discordWebhookUrl;
                    console.log("URL da Webhook carregada com sucesso:", discordWebhookUrl);
                } else {
                    console.warn("Formato inesperado para URL da webhook na bin admin. Inicializando vazio.");
                    discordWebhookUrl = "";
                }

                // Carrega configurações do sistema
                if (data.record.configuracoesSistema) {
                    enviarReciboDiscord = data.record.configuracoesSistema.enviarReciboDiscord !== undefined ? data.record.configuracoesSistema.enviarReciboDiscord : true;
                    baixarReciboLocalmente = data.record.configuracoesSistema.baixarReciboLocalmente !== undefined ? data.record.configuracoesSistema.baixarReciboLocalmente : true;
                    console.log("Configurações do sistema carregadas com sucesso:", {enviarReciboDiscord, baixarReciboLocalmente});
                } else {
                    console.warn("Formato inesperado para configurações do sistema na bin admin. Inicializando padrão.");
                    enviarReciboDiscord = true;
                    baixarReciboLocalmente = true;
                }

                // Carrega recibos arquivados
                if (Array.isArray(data.record.recibosArquivados)) {
                    recibosArquivados = data.record.recibosArquivados;
                    console.log("Recibos arquivados carregados com sucesso:", recibosArquivados);
                } else {
                    console.warn("Formato inesperado para recibos arquivados na bin admin. Inicializando vazio.");
                    recibosArquivados = [];
                }

                // Carrega munições
                if (Array.isArray(data.record.municoes)) {
                    municoes = data.record.municoes;
                    console.log("Munições carregadas com sucesso:", municoes);
                } else {
                    console.warn("Formato inesperado para munições na bin admin. Inicializando padrão.");
                    // Valores padrão se não houver dados ou formato incorreto
                    municoes = [
                        {nome: "Munição de Rifle", materiais: {"Pólvora": 1, "Alumínio": 18, "Cobre": 12}, precoNormal: 500, precoDesconto: 400, baseProducao: 15},
                        {nome: "Munição de Sub", materiais: {"Pólvora": 1, "Alumínio": 10, "Cobre": 10}, precoNormal: 400, precoDesconto: 300, baseProducao: 15},
                        {nome: "Munição de Pistola", materiais: {"Pólvora": 1, "Cobre": 12}, precoNormal: 250, precoDesconto: 150, baseProducao: 15}
                    ];
                }

                return true;
            } else {
                console.warn("JSONBin retornou formato de dados inesperado para admin:", data);
                // Fallback para valores padrão se o formato for inesperado
                vendedores = []; // Removido nomes obsoletos
                discordWebhookUrl = "";
                enviarReciboDiscord = true;
                baixarReciboLocalmente = true;
                recibosArquivados = [];
                municoes = [
                    {nome: "Munição de Rifle", materiais: {"Pólvora": 1, "Alumínio": 18, "Cobre": 12}, precoNormal: 500, precoDesconto: 400, baseProducao: 15},
                    {nome: "Munição de Sub", materiais: {"Pólvora": 1, "Alumínio": 10, "Cobre": 10}, precoNormal: 400, precoDesconto: 300, baseProducao: 15},
                    {nome: "Munição de Pistola", materiais: {"Pólvora": 1, "Cobre": 12}, precoNormal: 250, precoDesconto: 150, baseProducao: 15}
                ];
                return false;
            }
        } catch (error) {
            console.error("Erro ao carregar dados administrativos:", error);
            showCustomAlert("Erro ao carregar dados administrativos! Os dados serão mantidos apenas localmente.", "error");
            // Fallback para valores padrão em caso de erro
            vendedores = []; // Removido nomes obsoletos
            discordWebhookUrl = "";
            enviarReciboDiscord = true;
            baixarReciboLocalmente = true;
            recibosArquivados = [];
            municoes = [
                {nome: "Munição de Rifle", materiais: {"Pólvora": 1, "Alumínio": 18, "Cobre": 12}, precoNormal: 500, precoDesconto: 400, baseProducao: 15},
                {nome: "Munição de Sub", materiais: {"Pólvora": 1, "Alumínio": 10, "Cobre": 10}, precoNormal: 400, precoDesconto: 300, baseProducao: 15},
                {nome: "Munição de Pistola", materiais: {"Pólvora": 1, "Cobre": 12}, precoNormal: 250, precoDesconto: 150, baseProducao: 15}
            ];
            return false;
        }
    }

    // Função para salvar TODOS os dados administrativos na BIN_ADMIN_ID
    async function salvarDadosAdmin() {
        const dadosParaSalvar = {
            vendedores: vendedores.map(v => ({
                id: v.id,
                nome: v.nome
            })),
            discordWebhookUrl: discordWebhookUrl,
            configuracoesSistema: {
                enviarReciboDiscord: enviarReciboDiscord,
                baixarReciboLocalmente: baixarReciboLocalmente
            },
            recibosArquivados: recibosArquivados, // Inclui os recibos arquivados
            municoes: municoes // Inclui as munições
        };

        try {
            const response = await fetch(BIN_ADMIN_URL, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": BIN_ADMIN_API_KEY,
                    "X-Bin-Private": "false"
                },
                body: JSON.stringify(dadosParaSalvar)
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro ao salvar dados administrativos! Os dados serão mantidos apenas localmente.", "error");
                throw new Error("Erro ao salvar dados administrativos");
            }
            const data = await response.json();
            console.log("Dados administrativos salvos com sucesso:", data);
            return true;
        } catch (error) {
            console.error("Erro ao salvar dados administrativos:", error);
            showCustomAlert("Erro ao salvar dados administrativos! Os dados serão mantidos apenas localmente.", "error");
            return false;
        }
    }

    // Funções para o resumo global (mantidas, mas a seção de exibição foi removida)
    async function carregarResumoGlobal() {
        try {
            const response = await fetch(RESUMO_URL, {
                headers: {
                    "X-Master-Key": RESUMO_API_KEY,
                    "Content-Type": "application/json"
                }
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro ao carregar resumo global. Verifique o console.", "error");
                throw new Error("Erro na requisição ao carregar resumo global");
            }

            const data = await response.json();
            if (data.record) {
                resumoGlobal = data.record;
                return true;
            } else {
                console.warn("JSONBin returned unexpected data format for global summary:", data);
                resumoGlobal = {}; // Initialize as empty object if unexpected format
                return false;
            }
        } catch (error) {
            console.error("Erro ao carregar resumo global:", error);
            showCustomAlert("Erro ao carregar resumo global!", "error");
            resumoGlobal = {}; // Initialize as empty object on error
            return false;
        }
    }

    async function salvarResumoGlobal() {
        try {
            const response = await fetch(RESUMO_URL, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": RESUMO_API_KEY
                },
                body: JSON.stringify(resumoGlobal)
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro ao salvar resumo global. Verifique o console.", "error");
                throw new Error("Erro ao salvar resumo global");
            }
            const data = await response.json();
            console.log("Resumo global salvo com sucesso:", data);
            return true;
        } catch (error) {
            console.error("Erro ao salvar resumo global:", error);
            showCustomAlert("Erro ao salvar resumo global!", "error");
            return false;
        }
    }

    async function atualizarResumoGlobal(novosDados) {
        for (const vendedor in novosDados) {
            if (!resumoGlobal[vendedor]) {
                resumoGlobal[vendedor] = {
                    totalMuni: 0,
                    totalValor: 0,
                    comissao: 0
                };
            }

            resumoGlobal[vendedor].totalMuni += novosDados[vendedor].totalMuni || 0;
            resumoGlobal[vendedor].totalValor += novosDados[vendedor].totalValor || 0;
            resumoGlobal[vendedor].comissao += novosDados[vendedor].comissao || 0;
            resumoGlobal[vendedor].ultimaAtualizacao = new Date().toLocaleString('pt-BR');
        }

        await salvarResumoGlobal();
    }

    // NOVO: Função para criar backup
    async function criarBackup() {
        const dadosParaBackup = {
            vendedores: vendedores.map(v => ({
                id: v.id,
                nome: v.nome
            })),
            discordWebhookUrl: discordWebhookUrl,
            configuracoesSistema: {
                enviarReciboDiscord: enviarReciboDiscord,
                baixarReciboLocalmente: baixarReciboLocalmente
            },
            recibosArquivados: recibosArquivados,
            municoes: municoes,
            dataBackup: new Date().toLocaleString('pt-BR')
        };

        try {
            const response = await fetch(BIN_BACKUP_URL, {
                method: "PUT", // PUT para sobrescrever o backup mais recente
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": BIN_BACKUP_API_KEY,
                    "X-Bin-Private": "false"
                },
                body: JSON.stringify(dadosParaBackup)
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro ao criar backup! Verifique sua conexão ou a configuração da BIN de backup.", "error");
                throw new Error("Erro ao criar backup");
            }
            const data = await response.json();
            console.log("Backup criado com sucesso:", data);
            lastBackupDate = data.record.dataBackup; // Atualiza a data do último backup
            updateLastBackupInfo(); // Atualiza a exibição
            return true;
        } catch (error) {
            console.error("Erro ao criar backup:", error);
            showCustomAlert("Erro ao criar backup! Verifique sua conexão ou a configuração da BIN de backup.", "error");
            return false;
        }
    }

    // NOVO: Função para restaurar backup
    async function restaurarBackup() {
        try {
            const response = await fetch(BIN_BACKUP_URL, {
                headers: {
                    "X-Master-Key": BIN_BACKUP_API_KEY,
                    "Content-Type": "application/json",
                    "X-Bin-Private": "false"
                }
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro na requisição ao carregar backup. Verifique o console.", "error");
                throw new Error("Erro na requisição ao carregar backup");
            }

            const data = await response.json();
            if (data.record) {
                // Carrega os dados do backup para as variáveis globais
                vendedores = data.record.vendedores ? data.record.vendedores.map(v => ({
                    id: v.id,
                    nome: v.nome
                })) : [];
                discordWebhookUrl = data.record.discordWebhookUrl || "";
                enviarReciboDiscord = data.record.configuracoesSistema?.enviarReciboDiscord ?? true;
                baixarReciboLocalmente = data.record.configuracoesSistema?.baixarReciboLocalmente ?? true;
                recibosArquivados = data.record.recibosArquivados || [];
                municoes = data.record.municoes || [];
                lastBackupDate = data.record.dataBackup; // Atualiza a data do último backup

                // Salva os dados restaurados na BIN_ADMIN_ID para que se tornem os dados "atuais"
                const salvouAtual = await salvarDadosAdmin();
                if (salvouAtual) {
                    console.log("Dados restaurados e salvos como dados atuais com sucesso.");
                    return true;
                } else {
                    console.error("Erro ao salvar dados restaurados como dados atuais.");
                    return false;
                }
            } else {
                console.warn("JSONBin retornou formato de dados inesperado para backup:", data);
                showCustomAlert("Nenhum backup válido encontrado para restaurar.", "warning");
                return false;
            }
        } catch (error) {
            console.error("Erro ao restaurar backup:", error);
            showCustomAlert("Erro ao restaurar backup! Verifique sua conexão ou se existe um backup válido.", "error");
            return false;
        }
    }

    // NOVO: Função para restaurar dados padrão de fábrica
    async function restaurarPadrao() {
        try {
            const response = await fetch(BIN_DEFAULT_URL, {
                headers: {
                    "X-Master-Key": BIN_DEFAULT_API_KEY,
                    "Content-Type": "application/json",
                    "X-Bin-Private": "false"
                }
            });

            if (!response.ok) {
                console.error(`HTTP error! status: ${response.status}`);
                showCustomAlert("Erro na requisição ao carregar dados padrão. Verifique o console.", "error");
                throw new Error("Erro na requisição ao carregar dados padrão");
            }

            const data = await response.json();
            if (data.record) {
                // Carrega os dados padrão para as variáveis globais
                vendedores = data.record.vendedores ? data.record.vendedores.map(v => ({
                    id: v.id,
                    nome: v.nome
                })) : [];
                discordWebhookUrl = data.record.discordWebhookUrl || "";
                enviarReciboDiscord = data.record.configuracoesSistema?.enviarReciboDiscord ?? true;
                baixarReciboLocalmente = data.record.configuracoesSistema?.baixarReciboLocalmente ?? true;
                recibosArquivados = data.record.recibosArquivados || [];
                municoes = data.record.municoes || [];
                lastBackupDate = null; // Ao restaurar padrão, não há último backup salvo pelo usuário

                // Salva os dados padrão na BIN_ADMIN_ID para que se tornem os dados "atuais"
                const salvouAtual = await salvarDadosAdmin();
                if (salvouAtual) {
                    console.log("Dados padrão restaurados e salvos como dados atuais com sucesso.");
                    return true;
                } else {
                    console.error("Erro ao salvar dados padrão como dados atuais.");
                    return false;
                }
            } else {
                console.warn("JSONBin retornou formato de dados inesperado para padrão:", data);
                showCustomAlert("Nenhum dado padrão válido encontrado para restaurar.", "warning");
                return false;
            }
        } catch (error) {
            console.error("Erro ao restaurar dados padrão:", error);
            showCustomAlert("Erro ao restaurar dados padrão! Verifique sua conexão ou se a BIN padrão está configurada.", "error");
            return false;
        }
    }

    // Função para carregar a data do último backup
    async function loadLastBackupDate() {
        try {
            const response = await fetch(BIN_BACKUP_URL, {
                headers: {
                    "X-Master-Key": BIN_BACKUP_API_KEY,
                    "Content-Type": "application/json",
                    "X-Bin-Private": "false"
                }
            });
            if (response.ok) {
                const data = await response.json();
                if (data.record && data.record.dataBackup) {
                    lastBackupDate = data.record.dataBackup;
                } else {
                    lastBackupDate = null;
                }
            } else {
                lastBackupDate = null;
            }
        } catch (error) {
            console.error("Erro ao carregar data do último backup:", error);
            lastBackupDate = null;
        }
        updateLastBackupInfo();
    }

    // Função para atualizar a informação do último backup na UI
    function updateLastBackupInfo() {
        const infoElement = document.getElementById('last-backup-info');
        if (lastBackupDate) {
            infoElement.innerHTML = `Último Backup: <strong>${lastBackupDate}</strong>`;
        } else {
            infoElement.innerHTML = `Nenhum backup salvo.`;
        }
    }

    // ================= FUNÇÕES DO SISTEMA =================
    // Função para exibir o pop-up personalizado (do SITE.html, mantida)
    function showCustomAlert(message, type = 'info', duration = 3000) {
        const popup = document.getElementById('custom-alert-popup');
        const popupIcon = document.getElementById('popup-icon');
        const popupMessage = document.getElementById('popup-message');

        // Limpa classes de tipo anteriores
        popup.classList.remove('success', 'error', 'warning', 'info');
        popupIcon.className = 'fas'; // Reseta o ícone

        // Adiciona a classe de tipo e define o ícone
        popup.classList.add(type);
        if (type === 'success') {
            popupIcon.classList.add('fa-check-circle');
        } else if (type === 'error') {
            popupIcon.classList.add('fa-times-circle');
        } else if (type === 'warning') {
            popupIcon.classList.add('fa-exclamation-triangle');
        } else { // Default 'info'
            popupIcon.classList.add('fa-info-circle');
        }

        popupMessage.textContent = message;
        popup.classList.remove('hide');
        popup.classList.add('show');

        // Esconde o pop-up após a duração especificada
        setTimeout(() => {
            popup.classList.remove('show');
            popup.classList.add('hide');
            // Opcional: Esconder completamente após a transição de saída
            setTimeout(() => {
                popup.style.display = 'none';
            }, 300); // Tempo da transição CSS (ajustado para ser mais rápido)
        }, duration);

        popup.style.display = 'flex'; // Garante que o display esteja correto para a transição
    }

    function atualizarSelectVendedores() {
        const select = document.getElementById('nome-comprador');
        select.innerHTML = '<option value="">-- Selecione o Vendedor --</option>';
        vendedores.forEach(v => {
            const option = document.createElement('option');
            option.value = v.id;
            option.textContent = v.nome;
            select.appendChild(option);
        });
    }

    // Funções de gerenciamento de vendedores do PAINELL.html (adaptadas para o SITE.html)
    // AGORA PARA O MODAL
    function renderizarListaVendedoresModal() {
        const listaContainer = document.getElementById('lista-vendedores-panel-modal');
        listaContainer.innerHTML = '';

        // Ordena os vendedores por nome para exibição consistente
        const vendedoresOrdenados = [...vendedores].sort((a, b) => a.nome.localeCompare(b.nome));

        if (vendedoresOrdenados.length === 0) {
            listaContainer.innerHTML = `
                <div class="empty-state-panel">
                    <i class="fas fa-users-slash"></i>
                    <p>Nenhum vendedor cadastrado ainda.</p>
                    <p>Use a funcionalidade de adição no painel de Administração para adicionar novos vendedores.</p>
                </div>
            `;
            listaContainer.style.display = 'flex';
            listaContainer.style.justifyContent = 'center';
            listaContainer.style.alignItems = 'center';
            listaContainer.style.minHeight = '200px';
            return;
        } else {
            listaContainer.style.display = 'grid'; /* Volta a ser grid para o layout de colunas */
            listaContainer.style.justifyContent = 'unset';
            listaContainer.style.alignItems = 'unset';
            listaContainer.style.minHeight = 'unset';
        }

        vendedoresOrdenados.forEach((vendedor) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'vendedor-item-panel';
            itemDiv.setAttribute('data-id', vendedor.id);

            itemDiv.innerHTML = `
                <div class="vendedor-display-panel">
                    <span><strong>ID:</strong> ${vendedor.id}</span>
                    <span><strong>Nome:</strong> ${vendedor.nome}</span>
                    <div class="action-buttons-panel">
                        <button class="btn-panel btn-edit-panel" onclick="toggleEditVendedorModal('${vendedor.id}')" title="Editar Vendedor">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-panel btn-danger-panel" onclick="removerVendedorModal('${vendedor.id}')" title="Remover Vendedor">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="vendedor-edit-fields-panel">
                    <input type="text" class="edit-vendedor-id-panel" value="${vendedor.id}" placeholder="Novo ID">
                    <input type="text" class="edit-vendedor-nome-panel" value="${vendedor.nome}" placeholder="Novo Nome">
                    <div class="action-buttons-panel">
                        <button class="btn-panel btn-save-panel" onclick="saveEditedVendedorModal('${vendedor.id}')" title="Salvar Alterações">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                        <button class="btn-panel btn-cancel-panel" onclick="cancelEditVendedorModal('${vendedor.id}')" title="Cancelar Edição">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            `;
            listaContainer.appendChild(itemDiv);
        });
    }

    function toggleEditVendedorModal(vendedorId) {
        const item = document.querySelector(`#lista-vendedores-panel-modal .vendedor-item-panel[data-id="${vendedorId}"]`);
        if (!item) return;
        item.classList.toggle('editing');
    }

    async function saveEditedVendedorModal(vendedorId) {
        const item = document.querySelector(`#lista-vendedores-panel-modal .vendedor-item-panel[data-id="${vendedorId}"]`);
        if (!item) return;

        const newId = item.querySelector('.edit-vendedor-id-panel').value.trim();
        const newNome = item.querySelector('.edit-vendedor-nome-panel').value.trim();

        if (!newId || !newNome) {
            showCustomAlert("ID e Nome do vendedor não podem ser vazios!", "warning");
            return;
        }

        const index = vendedores.findIndex(v => v.id === vendedorId);
        if (index === -1) {
            showCustomAlert("Vendedor não encontrado!", "error");
            return;
        }

        if (newId !== vendedorId && vendedores.some((v, i) => i !== index && v.id === newId)) {
            showCustomAlert("Este ID de vendedor já existe para outro vendedor. Por favor, use um ID diferente.", "warning");
            return;
        }

        vendedores[index].id = newId;
        vendedores[index].nome = newNome;

        const salvou = await salvarDadosAdmin();
        if (salvou) {
            showCustomAlert("Vendedor atualizado com sucesso!", "success");
            renderizarListaVendedoresModal(); // Atualiza a lista no modal
            atualizarSelectVendedores(); // Atualiza o select na calculadora
        } else {
            showCustomAlert("Erro ao atualizar vendedor. Tente novamente.", "error");
        }
    }

    function cancelEditVendedorModal(vendedorId) {
        const item = document.querySelector(`#lista-vendedores-panel-modal .vendedor-item-panel[data-id="${vendedorId}"]`);
        if (!item) return;
        // Restaura os valores originais nos campos de input
        const originalVendedor = vendedores.find(v => v.id === vendedorId);
        if (originalVendedor) {
            item.querySelector('.edit-vendedor-id-panel').value = originalVendedor.id;
            item.querySelector('.edit-vendedor-nome-panel').value = originalVendedor.nome;
        }
        toggleEditVendedorModal(vendedorId);
    }

    async function removerVendedorModal(vendedorId) {
        if (confirm(`Tem certeza que deseja remover o vendedor com ID ${vendedorId}?`)) {
            vendedores = vendedores.filter(v => v.id !== vendedorId);
            const salvou = await salvarDadosAdmin();
            if (salvou) {
                showCustomAlert("Vendedor removido com sucesso!", "success");
                renderizarListaVendedoresModal(); // Atualiza a lista no modal
                atualizarSelectVendedores(); // Atualiza o select na calculadora
            } else {
                showCustomAlert("Erro ao remover vendedor. Tente novamente.", "error");
            }
        }
    }

    // Funções para Gerenciar Munições
    function atualizarSelectMunicoes() {
        const select = document.getElementById('arma');
        select.innerHTML = ''; // Limpa as opções existentes
        if (municoes.length === 0) {
            const option = document.createElement('option');
            option.value = "";
            option.textContent = "-- Nenhuma Munição Cadastrada --";
            select.appendChild(option);
            document.getElementById("btn-calcular").disabled = true;
            document.getElementById("btn-adicionar").disabled = true;
        } else {
            municoes.forEach(m => {
                const option = document.createElement('option');
                option.value = m.nome;
                option.textContent = m.nome;
                select.appendChild(option);
            });
            document.getElementById("btn-calcular").disabled = false;
            document.getElementById("btn-adicionar").disabled = false;
        }
        calcular(); // Recalcula com a primeira munição da lista (or limpa se não houver)
    }

    async function atualizarListaMunicoes() {
        const lista = document.getElementById('lista-municoes');
        lista.innerHTML = '';
        if (municoes.length === 0) {
            lista.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma munição cadastrada ainda.</p>';
            return;
        }
        municoes.forEach((m, index) => {
            const item = document.createElement('div');
            item.className = 'municao-admin-item';

            item.innerHTML = `
                <span class="municao-name">${m.nome}</span>
                <div class="action-buttons">
                    <button class="btn-icon edit" data-index="${index}" onclick="openEditMunicaoModal(${index})" title="Editar Munição">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon remove" data-index="${index}" onclick="removerMunicao(${index})" title="Remover Munição">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            lista.appendChild(item);
        });
    }

    async function adicionarMunicao() {
        const nome = document.getElementById('municao-nome').value.trim();
        const precoNormal = parseInt(document.getElementById('municao-preco-normal').value);
        const precoDesconto = parseInt(document.getElementById('municao-preco-desconto').value);
        const baseProducao = parseInt(document.getElementById('municao-base-producao').value);


        if (!nome || isNaN(precoNormal) || isNaN(precoDesconto) || precoNormal < 0 || precoDesconto < 0 || isNaN(baseProducao) || baseProducao < 1) {
            showCustomAlert("Por favor, preencha todos os campos de munição com valores válidos.", "warning");
            return;
        }
        if (municoes.some(m => m.nome.toLowerCase() === nome.toLowerCase())) {
            showCustomAlert("Já existe uma munição com este nome. Por favor, use um nome diferente ou edite a existente.", "warning");
            return;
        }

        municoes.push({
            nome: nome,
            materiais: {}, // Começa sem materiais, serão adicionados via edição
            precoNormal: precoNormal,
            precoDesconto: precoDesconto,
            baseProducao: baseProducao
        });

        const salvou = await salvarDadosAdmin();
        if (salvou) {
            showCustomAlert("Munição adicionada com sucesso! Você pode adicionar materiais editando-a.", "success");
            document.getElementById('municao-nome').value = '';
            document.getElementById('municao-preco-normal').value = '';
            document.getElementById('municao-preco-desconto').value = '';
            document.getElementById('municao-base-producao').value = '';
            atualizarListaMunicoes();
            atualizarSelectMunicoes();
        } else {
            showCustomAlert("Erro ao adicionar munição. Tente novamente.", "error");
        }
    }

    async function removerMunicao(index) {
        if (confirm(`Tem certeza que deseja remover a munição "${municoes[index].nome}"?`)) {
            municoes.splice(index, 1);
            await salvarDadosAdmin();
            atualizarListaMunicoes();
            atualizarSelectMunicoes();
            showCustomAlert("Munição removida com sucesso!", "success");
        }
    }

    let currentEditMunicaoIndex = -1;

    function openEditMunicaoModal(index) {
        currentEditMunicaoIndex = index;
        const municao = municoes[index];
        document.getElementById('edit-municao-nome').value = municao.nome;
        document.getElementById('edit-municao-preco-normal').value = municao.precoNormal;
        document.getElementById('edit-municao-preco-desconto').value = municao.precoDesconto;
        document.getElementById('edit-municao-base-producao').value = municao.baseProducao;

        renderMaterialsForEdit(municao.materiais);
        document.getElementById('editMunicaoModal').style.display = 'block';
    }

    function renderMaterialsForEdit(materials) {
        const grid = document.getElementById('edit-municao-materials-grid');
        grid.innerHTML = '';
        for (const materialName in materials) {
            const materialQuantity = materials[materialName];
            const itemDiv = document.createElement('div');
            itemDiv.className = 'material-item';
            itemDiv.innerHTML = `
                <input type="text" value="${materialName}" readonly data-material-name="${materialName}">
                <input type="number" value="${materialQuantity}" min="0" data-material-name="${materialName}">
                <button class="btn-danger" onclick="removeMaterialFromEdit(this, '${materialName}')"><i class="fas fa-times"></i></button>
            `;
            grid.appendChild(itemDiv);
        }
    }

    function removeMaterialFromEdit(buttonElement, materialName) {
        const municao = municoes[currentEditMunicaoIndex];
        delete municao.materiais[materialName];
        buttonElement.closest('.material-item').remove(); // Remove o elemento da DOM
    }

    document.getElementById('btn-add-material').addEventListener('click', function () {
        const newMaterialName = document.getElementById('new-material-name').value.trim();
        const newMaterialQuantity = parseInt(document.getElementById('new-material-quantity').value);

        if (!newMaterialName || isNaN(newMaterialQuantity) || newMaterialQuantity < 1) {
            showCustomAlert("Por favor, insira um nome e uma quantidade válida para o material.", "warning");
            return;
        }

        const municao = municoes[currentEditMunicaoIndex];
        if (municao.materiais[newMaterialName]) {
            showCustomAlert(`O material "${newMaterialName}" já existe para esta munição. Edite a quantidade existente.`, "warning");
            return;
        }

        municao.materiais[newMaterialName] = newMaterialQuantity;

        document.getElementById('new-material-name').value = '';
        document.getElementById('new-material-quantity').value = '';
        renderMaterialsForEdit(municao.materiais); // Atualiza a exibição dos materiais
    });

    async function saveEditedMunicao() {
        if (currentEditMunicaoIndex === -1) return;

        const municao = municoes[currentEditMunicaoIndex];
        const newName = document.getElementById('edit-municao-nome').value.trim();
        const newNormalPrice = parseInt(document.getElementById('edit-municao-preco-normal').value);
        const newDescontoPrice = parseInt(document.getElementById('edit-municao-preco-desconto').value);
        const newBaseProducao = parseInt(document.getElementById('edit-municao-base-producao').value);


        if (!newName || isNaN(newNormalPrice) || isNaN(newDescontoPrice) || newNormalPrice < 0 || newDescontoPrice < 0 || isNaN(newBaseProducao) || newBaseProducao < 1) {
            showCustomAlert("Por favor, preencha todos os campos de munição com valores válidos.", "warning");
            return;
        }

        // Verifica se o nome foi alterado para um nome já existente (exceto o próprio)
        if (newName.toLowerCase() !== municao.nome.toLowerCase() && municoes.some(m => m.nome.toLowerCase() === newName.toLowerCase())) {
            showCustomAlert("Já existe outra munição com este nome. Por favor, use um nome diferente.", "warning");
            return;
        }

        municao.nome = newName;
        municao.precoNormal = newNormalPrice;
        municao.precoDesconto = newDescontoPrice;
        municao.baseProducao = newBaseProducao;

        // Atualiza as quantidades dos materiais existentes
        const materialInputs = document.querySelectorAll('#edit-municao-materials-grid input[type="number"]');
        materialInputs.forEach(input => {
            const matName = input.dataset.materialName;
            const matQuantity = parseInt(input.value);
            if (!isNaN(matQuantity) && matQuantity >= 0) {
                municao.materiais[matName] = matQuantity;
            } else {
                // Se a quantidade for inválida, remove o material
                delete municao.materiais[matName];
            }
        });

        const salvou = await salvarDadosAdmin();
        if (salvou) {
            showCustomAlert("Munição atualizada com sucesso!", "success");
            closeEditMunicaoModal();
            atualizarListaMunicoes();
            atualizarSelectMunicoes();
        } else {
            showCustomAlert("Erro ao atualizar munição. Tente novamente.", "error");
        }
    }

    function closeEditMunicaoModal() {
        document.getElementById('editMunicaoModal').style.display = 'none';
        currentEditMunicaoIndex = -1;
    }

    // Event Listeners para o modal de edição de munição
    document.getElementById('btn-salvar-edicao-municao').addEventListener('click', saveEditedMunicao);
    document.getElementById('btn-cancelar-edicao-municao').addEventListener('click', closeEditMunicaoModal);
    document.getElementById('closeEditMunicaoModal').addEventListener('click', closeEditMunicaoModal);
    window.addEventListener('click', (event) => {
        if (event.target == document.getElementById('editMunicaoModal')) {
            closeEditMunicaoModal();
        }
    });


    // ================= TELA DE LOGIN PRINCIPAL =================
    // Chave para armazenar a senha no localStorage
    const LOCAL_STORAGE_KEY_ROLE = "fivem_system_user_role";
    const LOCAL_STORAGE_KEY_PASSWORD = "fivem_system_password";

    // Função para carregar a senha salva e o tipo de usuário ao iniciar
    // MODIFICADO: Esta função agora apenas preenche o campo e marca o checkbox, não faz login automático.
    async function loadSavedLogin() {
        const savedPassword = localStorage.getItem(LOCAL_STORAGE_KEY_PASSWORD);
        const savedRole = localStorage.getItem(LOCAL_STORAGE_KEY_ROLE);

        if (savedPassword && savedRole) {
            document.getElementById("senha").value = savedPassword;
            document.getElementById("lembrar-me").checked = true;
            // A lógica de login automático foi removida daqui.
            // O usuário precisará clicar em um dos botões de login.
        }
    }

    async function handleLogin(role, isAutoLogin = false) {
        const senhaInput = document.getElementById("senha");
        const senha = senhaInput.value;
        const loginContainer = document.querySelector('.login-container');
        const loginMessage = document.getElementById('login-message');
        const lembrarMeCheckbox = document.getElementById("lembrar-me");

        let correctPassword = false;
        if (role === 'membro' && senha === SENHA_MEMBRO) {
            correctPassword = true;
        } else if (role === 'admin' && senha === SENHA_ADMIN) {
            correctPassword = true;
        }

        if (correctPassword) {
            loginMessage.textContent = "";
            loginMessage.style.color = "var(--accent)";
            currentUserRole = role; // Define o tipo de usuário logado

            // Salva a senha e o tipo de usuário se "Lembrar-me" estiver marcado
            if (lembrarMeCheckbox.checked) {
                localStorage.setItem(LOCAL_STORAGE_KEY_PASSWORD, senha);
                localStorage.setItem(LOCAL_STORAGE_KEY_ROLE, role);
            } else {
                localStorage.removeItem(LOCAL_STORAGE_KEY_PASSWORD);
                localStorage.removeItem(LOCAL_STORAGE_KEY_ROLE);
            }

            // A transição e exibição do conteúdo principal permanecem as mesmas
            loginContainer.style.opacity = "0";
            loginContainer.style.transform = "translate(-50%, -50%) scale(0.9)";
            createFireworks();


            setTimeout(async () => {
                loginContainer.style.display = "none";
                document.querySelector('.footer-note').style.display = "none";
                document.getElementById('particles-js').style.display = "none";
                document.getElementById('main-content').style.display = "block";

                // Ajusta a visibilidade das abas com base no papel do usuário
                updateTabVisibility(role);

                // Carregar TODOS os dados administrativos da bin única
                await carregarDadosAdmin();
                await loadLastBackupDate(); // Carrega a data do último backup
                atualizarSelectVendedores();
                atualizarSelectMunicoes(); // Atualiza o select de munições
                await carregarResumoGlobal();

            }, 700); // Tempo da animação

        } else {
            // Se a senha salva for inválida (por exemplo, alterada), limpa o localStorage
            // A lógica de auto-login falha aqui, mas como não estamos mais auto-logando,
            // esta parte se torna menos crítica para o problema original.
            if (isAutoLogin) { // Esta parte só seria relevante se ainda houvesse auto-login
                console.warn("Senha salva inválida. Limpando localStorage.");
                localStorage.removeItem(LOCAL_STORAGE_KEY_PASSWORD);
                localStorage.removeItem(LOCAL_STORAGE_KEY_ROLE);
                lembrarMeCheckbox.checked = false;
            }

            loginMessage.textContent = "Senha incorreta! Tente novamente.";
            loginMessage.style.color = "var(--danger)";
            senhaInput.value = ""; // Limpa o campo da senha
            // Sempre remove do localStorage em caso de falha de login, mesmo que não seja auto-login
            localStorage.removeItem(LOCAL_STORAGE_KEY_PASSWORD);
            localStorage.removeItem(LOCAL_STORAGE_KEY_ROLE);
            lembrarMeCheckbox.checked = false; // Desmarca "Lembrar-me"

            loginContainer.classList.remove('error-shake');
            void loginContainer.offsetWidth; // Trigger reflow
            loginContainer.classList.add('error-shake');
        }
    }

    function updateTabVisibility(role) {
        const tabs = document.querySelectorAll('.nav-tab');
        const sections = document.querySelectorAll('.section');

        tabs.forEach(tab => tab.style.display = 'none');
        sections.forEach(section => section.classList.remove('active'));

        if (role === 'membro') {
            document.getElementById('tab-calculadora').style.display = 'flex';
            document.getElementById('calculadora').classList.add('active');
            // Esconde as seções de admin e munições
            document.getElementById('admin-content-wrapper').classList.remove('active');
            document.getElementById('municao-content-wrapper').classList.remove('active');
        } else if (role === 'admin') {
            tabs.forEach(tab => tab.style.display = 'flex');
            document.getElementById('calculadora').classList.add('active'); // Define a calculadora como a aba inicial para admin também
            document.getElementById('tab-calculadora').classList.add('active');
            // Exibe as seções de admin e munições diretamente
            document.getElementById('admin-content-wrapper').classList.add('active');
            document.getElementById('municao-content-wrapper').classList.add('active');
            // Garante que a lista de munições e vendedores sejam renderizadas
            atualizarListaMunicoes();
            renderizarListaVendedoresModal();
        }
    }

    document.getElementById("btn-login-membro").addEventListener("click", () => handleLogin('membro'));
    document.getElementById("btn-login-admin").addEventListener("click", () => handleLogin('admin'));

    document.getElementById("senha").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            // Por padrão, o Enter no campo de senha pode tentar o login de membro
            // ou você pode adicionar um botão padrão para Enter
            handleLogin('membro'); // Ou 'admin' se preferir um padrão
        }
    });

    function initParticles() {
        const container = document.getElementById('particles-js');
        const particlesCount = 80;

        for (let i = 0; i < particlesCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.position = 'absolute';
            particle.style.width = `${Math.random() * 5 + 2}px`;
            particle.style.height = particle.style.width;
            particle.style.background = `rgba(${Math.floor(Math.random() * 100 + 156)}, ${Math.floor(Math.random() * 100 + 68)}, ${Math.floor(Math.random() * 150 + 105)}, ${Math.random() * 0.5 + 0.3})`;
            particle.style.borderRadius = '50%';
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.boxShadow = '0 0 10px rgba(142, 68, 255, 0.5)';
            particle.style.zIndex = '0';

            container.appendChild(particle);

            animateParticle(particle);
        }
    }

    function animateParticle(particle) {
        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        const endX = Math.random() * 100;
        const endY = Math.random() * 100;
        const duration = Math.random() * 20000 + 10000;

        particle.style.left = `${startX}%`;
        particle.style.top = `${startY}%`;

        const keyframes = [
            {transform: `translate(0, 0)`},
            {transform: `translate(${endX - startX}vw, ${endY - startY}vh)`}
        ];

        const options = {
            duration: duration,
            iterations: Infinity,
            direction: 'alternate',
            easing: 'ease-in-out'
        };

        particle.animate(keyframes, options);
    }

    function createFireworks() {
        const container = document.getElementById('fireworks');
        const colors = ['#ff4c4c', '#00cec9', '#8e44ff', '#fdcb6e', '#ffffff'];
        const fireworkCount = 30;

        for (let i = 0; i < fireworkCount; i++) {
            setTimeout(() => {
                const firework = document.createElement('div');
                firework.className = 'firework';

                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                firework.style.left = `${posX}%`;
                firework.style.top = `${posY}%`;

                const color = colors[Math.floor(Math.random() * colors.length)];
                firework.style.backgroundColor = color;
                firework.style.boxShadow = `0 0 10px ${color}`;

                container.appendChild(firework);

                const size = Math.random() * 8 + 4;
                const animation = firework.animate([
                    {transform: 'scale(0)', opacity: 1},
                    {transform: `scale(${size})`, opacity: 0}
                ], {
                    duration: Math.random() * 1000 + 500,
                    easing: 'ease-out'
                });

                animation.onfinish = () => {
                    firework.remove();
                };
            }, i * 200);
        }
    }

    window.addEventListener('load', initParticles);

    // ================= SISTEMA PRINCIPAL =================
    document.addEventListener('DOMContentLoaded', async () => {
        // Carrega a senha salva e o tipo de usuário ao iniciar
        // MODIFICADO: Apenas preenche o campo de senha se houver, não tenta logar automaticamente.
        loadSavedLogin();

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Apenas permite a troca de abas se o usuário for admin
                if (currentUserRole === 'admin') {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.add('active');

                    // Se a aba clicada for 'admin' ou 'gerenciar-municoes', garante que o conteúdo seja exibido
                    if (tab.dataset.target === 'admin') {
                        document.getElementById('admin-content-wrapper').classList.add('active');
                        document.getElementById('municao-content-wrapper').classList.remove('active'); // Garante que a outra seção esteja oculta
                        // Atualiza os campos da administração
                        document.getElementById('webhook-url').value = discordWebhookUrl;
                        document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
                        document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
                        loadLastBackupDate(); // Carrega a data do último backup ao entrar no admin
                    } else if (tab.dataset.target === 'gerenciar-municoes') {
                        document.getElementById('municao-content-wrapper').classList.add('active');
                        document.getElementById('admin-content-wrapper').classList.remove('active'); // Garante que a outra seção esteja oculta
                        atualizarListaMunicoes(); // Atualiza a lista de munições
                    } else {
                        document.getElementById('admin-content-wrapper').classList.remove('active');
                        document.getElementById('municao-content-wrapper').classList.remove('active');
                    }

                } else if (currentUserRole === 'membro' && tab.dataset.target === 'calculadora') {
                    // Membros só podem clicar na aba calculadora
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.add('active');
                    // Esconde as seções de admin e munições
                    document.getElementById('admin-content-wrapper').classList.remove('active');
                    document.getElementById('municao-content-wrapper').classList.remove('active');
                } else {
                    showCustomAlert("Acesso restrito. Você não tem permissão para acessar esta seção.", "error", 3000);
                }
            });
        });

        document.getElementById('recibo-upload').addEventListener('change', function (e) {
            arquivosSelecionados = Array.from(e.target.files);
            verificarDuplicados(); // Adicionado para verificar duplicados
            atualizarListaArquivos();
        });

        document.getElementById('btn-processar').addEventListener('click', processarRecibos);

        document.getElementById('btn-arquivar-recibos').addEventListener('click', arquivarRecibos);

        // Event listener para abrir o modal de recibos arquivados
        document.getElementById('btn-abrir-recibos-arquivados').addEventListener('click', function () {
            exibirArquivadosModal(); // Exibe os recibos arquivados no modal
            document.getElementById('arquivedReceiptsModal').style.display = 'block';
        });

        // Event listeners para o modal de recibos arquivados
        document.getElementById('closeArquivedReceiptsModal').addEventListener('click', function () {
            document.getElementById('arquivedReceiptsModal').style.display = 'none';
        });
        document.getElementById('btn-limpar-arquivados-modal').addEventListener('click', function () {
            document.getElementById('confirmClearArchivedModal').style.display = 'block';
            document.getElementById('clear-archived-password').value = ''; // Limpa o campo de senha
            document.getElementById('clear-archived-message').textContent = ''; // Limpa a mensagem de erro
        });
        window.addEventListener('click', (event) => {
            if (event.target == document.getElementById('arquivedReceiptsModal')) {
                document.getElementById('arquivedReceiptsModal').style.display = 'none';
            }
        });


        // Event listeners para o modal de confirmação de limpeza (que é chamado do modal de arquivados)
        document.getElementById('closeClearArchivedModal').addEventListener('click', function () {
            document.getElementById('confirmClearArchivedModal').style.display = 'none';
        });
        document.getElementById('btn-cancel-clear-archived').addEventListener('click', function () {
            document.getElementById('confirmClearArchivedModal').style.display = 'none';
        });
        document.getElementById('btn-confirm-clear-archived').addEventListener('click', limparRecibosArquivadosComSenha);

        // Removido o bloco de login administrativo ÚNICO
        // Removido o bloco de login de Gerenciamento de Munições

        // Botão de adicionar vendedor no painel antigo (será removido ou adaptado)
        document.getElementById('btn-adicionar-vendedor').addEventListener('click', async function () {
            const id = document.getElementById('vendedor-id').value.trim();
            const nome = document.getElementById('vendedor-nome').value.trim();

            if (!id || !nome) {
                return showCustomAlert("Preencha ID e Nome do vendedor!", "warning");
            }
            if (vendedores.some(v => v.id === id)) {
                return showCustomAlert("Este ID de vendedor já existe!", "warning");
            }

            vendedores.push({id, nome});
            const salvou = await salvarDadosAdmin(); // Salva na bin única
            if (salvou) {
                document.getElementById('vendedor-id').value = '';
                document.getElementById('vendedor-nome').value = '';
                renderizarListaVendedoresModal(); // Atualiza a lista no modal
                atualizarSelectVendedores();
                showCustomAlert("Vendedor adicionado com sucesso!", "success"); // ALERTA ADICIONADO
            } else {
                showCustomAlert("Erro ao adicionar vendedor. Tente novamente.", "error");
            }
        });

        // O botão de salvar configurações agora salva tudo junto
        document.getElementById('btn-salvar-config').addEventListener('click', async function () {
            const url = document.getElementById('webhook-url').value.trim();
            if (!url && enviarReciboDiscord) { // Só alerta se a URL estiver vazia E o envio para Discord estiver ativado
                showCustomAlert("Por favor, insira a URL da Webhook para enviar recibos para o Discord.", "warning");
                return;
            }
            discordWebhookUrl = url; // Atualiza a variável global
            // As variáveis globais enviarReciboDiscord e baixarReciboLocalmente já são atualizadas
            // pelas funções toggle, então basta chamar salvarDadosAdmin()
            await salvarDadosAdmin(); // Salva na bin única
            showCustomAlert("Configurações salvas com sucesso!", "success");
        });

        document.getElementById('btn-adicionar-municao').addEventListener('click', adicionarMunicao);

        initEvents();

        // Carregar todos os dados administrativos e o resumo global ao iniciar o sistema principal
        await carregarDadosAdmin();
        await loadLastBackupDate(); // Carrega a data do último backup ao iniciar
        atualizarSelectVendedores();
        atualizarSelectMunicoes(); // Garante que as munições sejam carregadas e o select populado

        // NOVO: Event listeners para os botões de Backup/Restauração
        document.getElementById('btn-criar-backup').addEventListener('click', function () {
            openBackupRestoreModal('backup');
        });

        document.getElementById('btn-restaurar-backup').addEventListener('click', function () {
            openBackupRestoreModal('restore');
        });

        document.getElementById('btn-restaurar-padrao').addEventListener('click', function () {
            openBackupRestoreModal('default');
        });

        // NOVO: Event listeners para o modal de Backup/Restauração
        document.getElementById('closeBackupRestoreModal').addEventListener('click', closeBackupRestoreModal);
        document.getElementById('btn-cancel-backup-action').addEventListener('click', closeBackupRestoreModal);
        window.addEventListener('click', (event) => {
            if (event.target == document.getElementById('backupRestoreModal')) {
                closeBackupRestoreModal();
            }
        });

        // NOVO: Event listener para o botão de confirmação dentro do modal
        document.getElementById('btn-confirm-backup-action').addEventListener('click', handleBackupRestoreConfirmation);

        // NOVO: Event listeners para o botão "Lista de Vendedores" e o modal
        document.getElementById('btn-abrir-lista-vendedores').addEventListener('click', function() {
          renderizarListaVendedoresModal(); // Atualiza a lista antes de abrir o modal
          document.getElementById('vendedoresListModal').style.display = 'block';
        });

        document.getElementById('closeVendedoresListModal').addEventListener('click', function() {
          document.getElementById('vendedoresListModal').style.display = 'none';
        });

        window.addEventListener('click', (event) => {
          if (event.target == document.getElementById('vendedoresListModal')) {
            document.getElementById('vendedoresListModal').style.display = 'none';
          }
        });
    });

    function initEvents() {
        document.getElementById("btn-calcular").addEventListener("click", calcular);
        document.getElementById("btn-adicionar").addEventListener("click", adicionarCompra);
        document.getElementById("desconto").addEventListener("change", () => {
            calcular();
            atualizarResumo();
        });

        document.getElementById("botao-copiar").addEventListener("click", () => {
            const texto = document.getElementById("propt-container").textContent;
            navigator.clipboard.writeText(texto).then(() => {
                const originalText = document.getElementById("botao-copiar").innerHTML;
                document.getElementById("botao-copiar").innerHTML = '<i class="fas fa-check"></i> Copiado!';
                setTimeout(() => {
                    document.getElementById("botao-copiar").innerHTML = originalText;
                }, 1500);
                showCustomAlert("PROPT copiado para a área de transferência!", "success", 2000); // ALERTA ADICIONADO
            }).catch(err => {
                console.error('Erro ao copiar texto: ', err);
                showCustomAlert("Erro ao copiar PROPT. Tente manualmente.", "error", 2000); // ALERTA ADICIONADO
            });
        });

        document.getElementById("baixar-recibo").addEventListener("click", baixarRecibo);

        // Removido event listeners para filtro e ordenação na Análise de Recibos
    }

    function calcular() {
        const tipoNome = document.getElementById("arma").value;
        const municaoSelecionada = municoes.find(m => m.nome === tipoNome);
        const calculadoraDica = document.getElementById("calculadora-dica");

        if (!municaoSelecionada) {
            document.getElementById("propt-container").textContent = "Selecione um tipo de munição válido.";
            document.getElementById("preco-unitario").innerHTML = `<strong>-</strong>`;
            document.getElementById("preco-total").innerHTML = `<strong>-</strong>`;
            calculadoraDica.textContent = "Para evitar falta de materiais, use quantidades múltiplas da base de produção da munição selecionada.";
            return;
        }

        let qnt = parseInt(document.getElementById("quantidade").value);
        if (isNaN(qnt) || qnt < 1) qnt = 1;

        // Usa a baseProducao da munição selecionada
        const lotes = Math.ceil(qnt / municaoSelecionada.baseProducao);
        const materiais = municaoSelecionada.materiais;
        let linha = `Acrescente número ${lotes} na fabricação: `;
        for (let item in materiais) {
            linha += `${item} ${materiais[item] * lotes} - `;
        }
        document.getElementById("propt-container").textContent = linha.slice(0, -3);

        const aplicarDesconto = document.getElementById("desconto").checked;
        const unitario = aplicarDesconto ? municaoSelecionada.precoDesconto : municaoSelecionada.precoNormal;
        const total = unitario * qnt;

        document.getElementById("preco-unitario").innerHTML =
            `<span style="color: ${aplicarDesconto ? '#00cec9' : '#fdcb6e'}">R$ ${unitario.toLocaleString('pt-BR')}</span>`;

        document.getElementById("preco-total").innerHTML =
            `<span style="color: ${aplicarDesconto ? '#00cec9' : '#fdcb6e'}">R$ ${total.toLocaleString('pt-BR')}</span>`;

        // Atualiza a dica com a base de produção da munição selecionada
        calculadoraDica.textContent = `Para evitar falta de materiais, use quantidades múltiplas de ${municaoSelecionada.baseProducao} (ex: ${municaoSelecionada.baseProducao}, ${municaoSelecionada.baseProducao * 2}, ${municaoSelecionada.baseProducao * 3}, etc.).`;
    }

    function adicionarCompra() {
        const btnAdicionar = document.getElementById("btn-adicionar");
        btnAdicionar.disabled = true;

        const tipoNome = document.getElementById("arma").value;
        const municaoSelecionada = municoes.find(m => m.nome === tipoNome);

        if (!municaoSelecionada) {
            showCustomAlert("Selecione um tipo de munição válido para adicionar.", "warning");
            btnAdicionar.disabled = false;
            return;
        }

        let qnt = parseInt(document.getElementById("quantidade").value);
        if (isNaN(qnt) || qnt < 1) qnt = 1;

        const itemExistente = compras.find(c => c.arma === tipoNome);
        if (itemExistente) itemExistente.quantidade += qnt;
        else compras.push({arma: tipoNome, quantidade: qnt});

        atualizarResumo();
        setTimeout(() => {
            btnAdicionar.disabled = false;
        }, 700);

        btnAdicionar.innerHTML = '<i class="fas fa-check"></i> Adicionado!';
        setTimeout(() => {
            btnAdicionar.innerHTML = '<i class="fas fa-cart-plus"></i> Adicionar ao Resumo';
        }, 1500);
        showCustomAlert("Item adicionado ao resumo!", "success", 2000); // ALERTA ADICIONADO
    }

    function atualizarResumo() {
        const container = document.getElementById("lista-compras");
        container.innerHTML = "";
        let totalGeral = 0;
        const aplicarDesconto = document.getElementById("desconto").checked;

        compras.forEach((item, i) => {
            const municao = municoes.find(m => m.nome === item.arma);
            if (!municao) return; // Pula se a munição não for encontrada (ex: foi removida)

            const precoUnit = aplicarDesconto ? municao.precoDesconto : municao.precoNormal;
            const totalItem = precoUnit * item.quantidade;
            totalGeral += totalItem;

            const div = document.createElement("div");
            div.className = "linha-compra";

            div.innerHTML = `
          <div>
            <strong>${item.quantidade}x</strong> ${item.arma}
            <div style="color: #c3a6ff; font-size: 0.9rem;">R$ ${totalItem.toLocaleString('pt-BR')}</div>
          </div>
          <button title="Remover item">
            <i class="fas fa-times"></i>
          </button>
        `;

            div.querySelector("button").onclick = () => {
                compras.splice(i, 1);
                atualizarResumo();
                showCustomAlert("Item removido do resumo.", "info", 1500); // ALERTA ADICIONADO
            };

            container.appendChild(div);
        });

        document.getElementById("total-geral").innerHTML =
            `<span style="color: #00cec9">R$ ${totalGeral.toLocaleString('pt-BR')}</span>`;
    }

    function toggleDesconto() {
        const descontoCheckbox = document.getElementById("desconto");
        descontoCheckbox.checked = !descontoCheckbox.checked;
        calcular();
        atualizarResumo();

        const checkboxContainer = document.querySelector('.checkbox-container');
        if (descontoCheckbox.checked) {
            checkboxContainer.style.background = "rgba(0, 184, 148, 0.15)";
            checkboxContainer.style.borderColor = "#00b894";
            showCustomAlert("Desconto de parceria aplicado!", "info", 1500); // ALERTA ADICIONADO
        } else {
            checkboxContainer.style.background = "rgba(142, 68, 255, 0.1)";
            checkboxContainer.style.borderColor = "rgba(142, 68, 255, 0.3)";
            showCustomAlert("Desconto de parceria removido.", "info", 1500); // ALERTA ADICIONADO
        }
    }

    function toggleEnviarReciboDiscord() {
        enviarReciboDiscord = !enviarReciboDiscord;
        document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
        showCustomAlert(`Envio para Discord: ${enviarReciboDiscord ? 'Ativado' : 'Desativado'}`, "info", 1500); // ALERTA ADICIONADO
    }

    function toggleBaixarReciboLocalmente() {
        baixarReciboLocalmente = !baixarReciboLocalmente;
        document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
        showCustomAlert(`Download local: ${baixarReciboLocalmente ? 'Ativado' : 'Desativado'}`, "info", 1500); // ALERTA ADICIONADO
    }

    function formatarDataHora() {
        const agora = new Date();
        const dia = String(agora.getDate()).padStart(2, '0');
        const mes = String(agora.getMonth() + 1).padStart(2, '0');
        const ano = agora.getFullYear();
        const horas = String(agora.getHours()).padStart(2, '0');
        const minutos = String(agora.getMinutes()).padStart(2, '0');
        const segundos = String(agora.getSeconds()).padStart(2, '0');

        return `${dia}-${mes}-${ano}_${horas}-${minutos}-${segundos}`;
    }

    async function baixarRecibo() {
        if (compras.length === 0) {
            showCustomAlert("Adicione ao menos um item para finalizar a venda.", "warning");
            return;
        }
        const vendedorId = document.getElementById("nome-comprador").value;
        if (!vendedorId) {
            showCustomAlert("Selecione quem realizou a venda.", "warning");
            return;
        }

        const vendedor = vendedores.find(v => v.id === vendedorId);
        const vendedorNome = vendedor ? vendedor.nome : "Desconhecido";
        const aplicarDesconto = document.getElementById("desconto").checked;

        let conteudo = "===== RECIBO DE VENDAS =====\n";
        conteudo += `SISTEMA DE VENDAS FIVEM v6.0\n`;
        conteudo += `Data: ${new Date().toLocaleDateString()}\n\n`;
        conteudo += `VENDIDO POR: ${vendedorNome}\n\n`;
        conteudo += "ITENS VENDIDOS:\n";
        conteudo += "--------------------------------\n";

        let totalGeral = 0;
        compras.forEach(item => {
            const municao = municoes.find(m => m.nome === item.arma);
            if (!municao) return; // Pula se a munição não for encontrada

            const precoUnit = aplicarDesconto ? municao.precoDesconto : municao.precoNormal;
            const totalItem = precoUnit * item.quantidade;
            totalGeral += totalItem;

            conteudo += `${item.quantidade}x ${item.arma}\n`;
            conteudo += `  Preço unid: R$ ${precoUnit.toLocaleString('pt-BR')}\n`;
            conteudo += `  Total: R$ ${totalItem.toLocaleString('pt-BR')}\n`;
            conteudo += "--------------------------------\n";
        });

        conteudo += `\nTOTAL GERAL: R$ ${totalGeral.toLocaleString('pt-BR')}\n`;
        conteudo += aplicarDesconto ? "DESCONTO DE PARCERIA APLICADO\n" : "";
        conteudo += "===============================\n";
        conteudo += "Sistema de Vendas FiveM © 2025 - Todos os direitos reservados";

        const fileName = `Comprovante de Venda - ${formatarDataHora()}.txt`;
        const blob = new Blob([conteudo], {type: "text/plain"});

        if (baixarReciboLocalmente) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            console.log("Recibo baixado localmente.");
            showCustomAlert("Recibo baixado localmente!", "success", 2000); // ALERTA ADICIONADO
        } else {
            console.log("Download local do recibo desativado.");
        }

        if (enviarReciboDiscord && discordWebhookUrl) {
            const formData = new FormData();
            formData.append('file', blob, fileName);

            const vendedorDiscordId = vendedor && vendedor.discordId ? `<@${vendedor.discordId}>` : `@${vendedorNome}`;
            const messageContent = `**Novo Recibo de Venda Gerado!**\n**Vendido Por:** ${vendedorDiscordId}`;
            formData.append('content', messageContent);

            try {
                const webhookResponse = await fetch(discordWebhookUrl, {
                    method: "POST",
                    body: formData
                });

                if (webhookResponse.ok) {
                    console.log("Recibo (.txt) enviado para o Discord com sucesso!");
                    showCustomAlert("Recibo enviado para o Discord!", "success", 2000); // ALERTA ADICIONADO
                } else {
                    console.error("Erro ao enviar recibo para o Discord:", webhookResponse.status, webhookResponse.statusText);
                    showCustomAlert("Erro ao enviar recibo para o Discord. Verifique a URL da webhook.", "error", 3000);
                }
            } catch (error) {
                console.error("Erro na requisição da webhook do Discord:", error);
                showCustomAlert("Erro na requisição da webhook do Discord. Verifique sua conexão ou a URL.", "error", 3000);
            }
        } else {
            console.warn("Envio de recibo para o Discord desativado ou URL da Webhook não configurada.");
            if (enviarReciboDiscord && !discordWebhookUrl) {
                showCustomAlert("Envio para Discord ativado, mas URL da Webhook não configurada.", "warning", 3000); // ALERTA ADICIONADO
            }
        }

        compras = [];
        atualizarResumo();

        const originalText = document.getElementById("baixar-recibo").innerHTML;
        document.getElementById("baixar-recibo").innerHTML = '<i class="fas fa-check"></i> Recibo Gerado!';
        setTimeout(() => {
            document.getElementById("baixar-recibo").innerHTML = originalText;
        }, 2000);

        const lembreteContainer = document.getElementById("lembrete-container");
        lembreteContainer.innerHTML = `
        <div class="lembrete-comissao">
          <i class="fas fa-exclamation-circle"></i>
          Lembre-se de retirar sua comissão de 50% e adicionar os outros 50% no Painel da Facção
        </div>
      `;
        showCustomAlert("Venda finalizada e recibo gerado!", "success", 2500); // ALERTA ADICIONADO
    }

    // Funções de análise de recibos
    function verificarDuplicados() {
        const duplicadosContainer = document.getElementById('duplicados-container');
        duplicadosContainer.innerHTML = '';

        const duplicados = [];
        const nomesArquivos = new Set();

        arquivosSelecionados.forEach(arquivo => {
            if (nomesArquivos.has(arquivo.name) || arquivosProcessadosSet.has(arquivo.name)) {
                duplicados.push(arquivo.name);
            } else {
                nomesArquivos.add(arquivo.name);
            }
        });

        if (duplicados.length > 0) {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'duplicado-warning';
            warningDiv.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>Atenção!</strong> Os seguintes arquivos já foram processados ou estão duplicados na seleção:
            <ul style="margin-top: 5px; padding-left: 20px;">
              ${duplicados.map(nome => `<li>${nome}</li>`).join('')}
            </ul>
          </div>
        `;
            duplicadosContainer.appendChild(warningDiv);
            showCustomAlert("Arquivos duplicados ou já processados detectados!", "warning", 4000); // ALERTA ADICIONADO
        }
    }

    function atualizarListaArquivos() {
        const listaArquivos = document.getElementById('lista-arquivos');
        listaArquivos.innerHTML = '';

        if (arquivosSelecionados.length === 0) {
            listaArquivos.innerHTML = '<p>Nenhum arquivo selecionado</p>';
            return;
        }

        // Adiciona contador de arquivos
        const header = document.createElement('div');
        header.innerHTML = `<p><strong>${arquivosSelecionados.length} arquivo(s) selecionado(s)</strong></p>`;
        listaArquivos.appendChild(header);

        arquivosSelecionados.forEach(arquivo => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `<i class="fas fa-file-alt"></i> ${arquivo.name}`;
            listaArquivos.appendChild(fileItem);
        });
    }

    async function processarRecibos() {
        if (arquivosSelecionados.length === 0) {
            showCustomAlert('Selecione pelo menos um arquivo de recibo para processar.', "warning");
            return;
        }

        const btnProcessar = document.getElementById('btn-processar');
        const originalText = btnProcessar.innerHTML;
        btnProcessar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        btnProcessar.disabled = true;

        const resumo = {};
        let arquivosProcessadosComSucessoCount = 0; // Contador para arquivos processados nesta sessão

        const promises = arquivosSelecionados.map(arquivo => {
            return new Promise((resolve) => {
                // Verificar se o arquivo já foi processado anteriormente ou é duplicado na seleção atual
                if (arquivosProcessadosSet.has(arquivo.name)) {
                    resolve(); // Pular arquivos já processados/duplicados
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const conteudo = e.target.result;
                    const vendedorMatch = conteudo.match(/VENDIDO POR: (.+)/);

                    if (vendedorMatch && vendedorMatch[1]) {
                        const vendedor = vendedorMatch[1].trim();
                        const totalGeralMatch = conteudo.match(/TOTAL GERAL: R\$\s*([\d.,]+)/);

                        let totalValor = 0;

                        if (totalGeralMatch && totalGeralMatch[1]) {
                            const valorString = totalGeralMatch[1];
                            const valorLimpo = valorString.replace(/\./g, '').replace(',', '.');
                            totalValor = parseFloat(valorLimpo);

                            if (isNaN(totalValor)) {
                                console.error('Erro ao parsear valor:', valorString);
                                totalValor = 0;
                            }
                        }

                        // Armazena os dados completos
                        if (!resumo[vendedor]) {
                            resumo[vendedor] = {totalValor: 0};
                        }

                        resumo[vendedor].totalValor += totalValor;

                        // Adiciona o nome do arquivo ao set de arquivos processados
                        arquivosProcessadosSet.add(arquivo.name);
                        arquivosProcessadosComSucessoCount++;
                    }
                    resolve();
                };

                reader.readAsText(arquivo);
            });
        });

        await Promise.all(promises); // Espera todas as promises serem resolvidas

        if (arquivosProcessadosComSucessoCount > 0) {
            resultadosAnaliseAtual = resumo; // Armazena os resultados para possível adição ao resumo
            exibirResumoSimples(resumo);
            showCustomAlert(`${arquivosProcessadosComSucessoCount} recibo(s) processado(s) com sucesso!`, "success", 2500); // ALERTA ADICIONADO
        } else {
            showCustomAlert('Nenhum novo arquivo válido foi processado. Verifique o formato ou se já foram processados.', "warning", 4000);
        }

        btnProcessar.innerHTML = originalText;
        btnProcessar.disabled = false;
    }

    function exibirResumoSimples(resumo) {
        const resumoContainer = document.getElementById('resumo-vendedores-simples');
        resumoContainer.innerHTML = '';

        const vendedoresProcessados = Object.entries(resumo)
            .map(([nome, dados]) => ({nome, ...dados}))
            .sort((a, b) => b.totalValor - a.totalValor); // Ordena por valor total

        if (vendedoresProcessados.length === 0) {
            resumoContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhum dado válido encontrado nos recibos</p>';
            return;
        }

        vendedoresProcessados.forEach(vendedor => {
            const vendedorItem = document.createElement('div');
            vendedorItem.className = 'vendedor-item'; // Reutiliza o estilo existente

            vendedorItem.innerHTML = `
                <div class="vendedor-header">
                    <div class="vendedor-nome">${vendedor.nome}</div>
                    <div class="vendedor-total">R$ ${vendedor.totalValor.toLocaleString('pt-BR')}</div>
                </div>
            `;
            resumoContainer.appendChild(vendedorItem);
        });
    }

    async function arquivarRecibos() {
        if (Object.keys(resultadosAnaliseAtual).length === 0) {
            showCustomAlert("Não há recibos processados para arquivar. Por favor, processe os recibos primeiro.", "warning");
            return;
        }

        const confirmacao = confirm("Deseja realmente arquivar os recibos processados? Isso irá adicioná-los à lista de arquivados e limpar os resultados da análise atual.");
        if (!confirmacao) {
            return;
        }

        // Adicionar os resultados da análise atual aos recibos arquivados
        const dataArquivamento = new Date().toLocaleString('pt-BR');
        for (const vendedorNome in resultadosAnaliseAtual) {
            const dadosVendedor = resultadosAnaliseAtual[vendedorNome];
            // Para o arquivamento, precisamos dos detalhes completos (munições, comissão, etc.)
            // Como o processarRecibos simples não extrai tudo, vamos re-processar para arquivar com detalhes
            // Ou, idealmente, processarRecibos já deveria extrair tudo e armazenar em resultadosAnaliseAtual
            // Para simplificar, vou assumir que resultadosAnaliseAtual já tem os detalhes necessários
            // Se não tiver, você precisaria ajustar processarRecibos para extrair mais dados.
            recibosArquivados.push({
                nome: vendedorNome,
                totalMuni: dadosVendedor.totalMuni || 0, // Adicionado para compatibilidade
                totalValor: dadosVendedor.totalValor,
                comissao: dadosVendedor.totalValor * 0.5, // Calcula comissão aqui para arquivamento
                detalhes: dadosVendedor.detalhes || 'Detalhes não disponíveis na análise simples', // Adicionado para compatibilidade
                dataArquivamento: dataArquivamento
            });
        }

        // Salvar os dados administrativos atualizados (incluindo os recibos arquivados)
        const salvou = await salvarDadosAdmin();
        if (salvou) {
            showCustomAlert("Recibos arquivados com sucesso!", "success");

            // Limpar os resultados da análise atual e a lista de arquivos selecionados
            resultadosAnaliseAtual = {};
            arquivosSelecionados = [];
            arquivosProcessadosSet.clear();
            document.getElementById('recibo-upload').value = '';
            document.getElementById('resumo-vendedores-simples').innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Selecione e processe os recibos para ver os resultados</p>';
            document.getElementById('duplicados-container').innerHTML = '';
            atualizarListaArquivos(); // Atualiza a lista de arquivos selecionados para mostrar "Nenhum arquivo selecionado"

            // Atualizar a exibição dos recibos arquivados no modal (se estiver aberto)
            if (document.getElementById('arquivedReceiptsModal').style.display === 'block') {
                exibirArquivadosModal();
            }
        } else {
            showCustomAlert("Erro ao arquivar recibos. Tente novamente.", "error");
        }
    }

    async function limparRecibosArquivadosComSenha() {
        const senhaDigitada = document.getElementById('clear-archived-password').value;
        const messageElement = document.getElementById('clear-archived-message');

        if (senhaDigitada !== SENHA_ADMIN) { // Usa a mesma senha ADMIN para limpar arquivados
            messageElement.textContent = 'Senha incorreta!';
            messageElement.style.color = 'var(--danger)';
            return;
        }

        if (recibosArquivados.length === 0) {
            messageElement.textContent = "Não há recibos arquivados para limpar.";
            messageElement.style.color = 'var(--warning)';
            return;
        }

        recibosArquivados = []; // Zera o array de recibos arquivados
        const salvou = await salvarDadosAdmin(); // Salva a alteração na bin

        if (salvou) {
            showCustomAlert("Recibos arquivados limpos com sucesso!", "success");
            document.getElementById('confirmClearArchivedModal').style.display = 'none'; // Fecha o modal
            document.getElementById('arquivedReceiptsModal').style.display = 'none'; // Fecha o modal de arquivados
            exibirArquivadosModal(); // Atualiza a exibição para mostrar que está vazio
        } else {
            messageElement.textContent = "Erro ao limpar recibos arquivados. Tente novamente.";
            messageElement.style.color = 'var(--danger)';
        }
    }

    // NOVO: Função para exibir recibos arquivados no modal
    function exibirArquivadosModal() {
        const listaArquivadosContainer = document.getElementById('lista-arquivados-modal');
        listaArquivadosContainer.innerHTML = '';

        if (recibosArquivados.length === 0) {
            listaArquivadosContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhum recibo arquivado ainda.</p>';
            return;
        }

        // Agrupar por vendedor para exibir o total acumulado
        const resumoArquivadosPorVendedor = {};
        recibosArquivados.forEach(recibo => {
            if (!resumoArquivadosPorVendedor[recibo.nome]) {
                resumoArquivadosPorVendedor[recibo.nome] = {
                    totalMuni: 0,
                    totalValor: 0,
                    comissao: 0,
                    detalhesRecibos: [] // Armazena os detalhes de cada recibo individualmente
                };
            }
            resumoArquivadosPorVendedor[recibo.nome].totalMuni += recibo.totalMuni;
            resumoArquivadosPorVendedor[recibo.nome].totalValor += recibo.totalValor;
            resumoArquivadosPorVendedor[recibo.nome].comissao += recibo.comissao;
            resumoArquivadosPorVendedor[recibo.nome].detalhesRecibos.push({
                data: recibo.dataArquivamento,
                valor: recibo.totalValor,
                municoes: recibo.totalMuni,
                comissao: recibo.comissao,
                tipos: recibo.detalhes // Detalhes dos tipos de munição
            });
        });

        // Converter para array e ordenar por nome do vendedor
        const vendedoresArquivados = Object.entries(resumoArquivadosPorVendedor)
            .map(([nome, dados]) => ({nome, ...dados}))
            .sort((a, b) => a.nome.localeCompare(b.nome));

        vendedoresArquivados.forEach(vendedor => {
            const item = document.createElement('div');
            item.className = 'arquived-receipt-item';

            item.innerHTML = `
                <div class="receipt-header">
                    <div class="vendedor-nome">${vendedor.nome}</div>
                    <div class="vendedor-total">R$ ${vendedor.totalValor.toLocaleString('pt-BR')}</div>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div class="receipt-details">
                    <p class="receipt-info">
                        <span><i class="fas fa-box"></i> Total Munições: ${vendedor.totalMuni.toLocaleString('pt-BR')}</span>
                        <span><i class="fas fa-hand-holding-usd"></i> Comissão Total: R$ ${vendedor.comissao.toLocaleString('pt-BR')}</span>
                    </p>
                    <h4 style="margin-top: 15px; color: var(--text-secondary);">Recibos Individuais:</h4>
                    <div style="max-height: 200px; overflow-y: auto; padding-right: 5px;">
                        ${vendedor.detalhesRecibos.map(recibo => `
                            <div style="background: rgba(30, 30, 50, 0.5); padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid var(--accent);">
                                <p><strong>Data:</strong> ${recibo.data}</p>
                                <p><strong>Valor:</strong> R$ ${recibo.valor.toLocaleString('pt-BR')}</p>
                                <p><strong>Munições:</strong> ${recibo.municoes.toLocaleString('pt-BR')}</p>
                                <p><strong>Comissão:</strong> R$ ${recibo.comissao.toLocaleString('pt-BR')}</p>
                                <p><strong>Tipos:</strong> ${recibo.tipos}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            item.querySelector('.receipt-header').addEventListener('click', function () {
                item.classList.toggle('expanded');
            });

            listaArquivadosContainer.appendChild(item);
        });
    }


    // NOVO: Função para abrir o modal de backup/restauração
    let currentBackupAction = ''; // 'backup', 'restore' ou 'default'

    function openBackupRestoreModal(action) {
        currentBackupAction = action;
        const modalTitle = document.getElementById('backup-modal-title');
        const modalMessage = document.getElementById('backup-modal-message');
        const confirmButton = document.getElementById('btn-confirm-backup-action');
        const passwordInput = document.getElementById('backup-admin-password');
        const messageElement = document.getElementById('backup-action-message');

        passwordInput.value = ''; // Limpa a senha
        messageElement.textContent = ''; // Limpa a mensagem de erro

        if (action === 'backup') {
            modalTitle.textContent = 'Confirmar Criação de Backup';
            modalMessage.innerHTML = 'Você está prestes a criar um backup dos dados atuais do sistema. Este backup substituirá qualquer backup anterior.';
            confirmButton.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Criar Backup';
            confirmButton.classList.remove('btn-danger', 'btn-warning');
            confirmButton.classList.add('btn-success');
        } else if (action === 'restore') {
            modalTitle.textContent = 'Confirmar Restauração de Backup';
            modalMessage.innerHTML = '<strong style="color: var(--danger);">ATENÇÃO:</strong> A restauração de um backup substituirá TODOS os dados atuais do sistema (vendedores, munições, configurações, recibos arquivados) pelos dados do último backup salvo. Esta ação é irreversível.';
            confirmButton.innerHTML = '<i class="fas fa-cloud-download-alt"></i> Restaurar Backup';
            confirmButton.classList.remove('btn-success', 'btn-danger');
            confirmButton.classList.add('btn-warning');
        } else if (action === 'default') {
            modalTitle.textContent = 'Confirmar Restauração Padrão';
            modalMessage.innerHTML = '<strong style="color: var(--danger);">ATENÇÃO:</strong> A restauração para o padrão de fábrica substituirá TODOS os dados atuais do sistema pelos dados iniciais. Esta ação é irreversível e não pode ser desfeita.';
            confirmButton.innerHTML = '<i class="fas fa-undo-alt"></i> Restaurar Padrão';
            confirmButton.classList.remove('btn-success', 'btn-warning');
            confirmButton.classList.add('btn-danger');
        }

        document.getElementById('backupRestoreModal').style.display = 'block';
    }

    // NOVO: Função para fechar o modal de backup/restauração
    function closeBackupRestoreModal() {
        document.getElementById('backupRestoreModal').style.display = 'none';
        document.getElementById('backup-admin-password').value = '';
        document.getElementById('backup-action-message').textContent = '';
        currentBackupAction = '';
    }

    // NOVO: Função para lidar com a confirmação da ação de backup/restauração
    async function handleBackupRestoreConfirmation() {
        const senhaDigitada = document.getElementById('backup-admin-password').value;
        const messageElement = document.getElementById('backup-action-message');

        if (senhaDigitada !== SENHA_ADMIN) {
            messageElement.textContent = 'Senha administrativa incorreta!';
            messageElement.style.color = 'var(--danger)';
            return;
        }

        messageElement.textContent = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        messageElement.style.color = 'var(--accent)';
        document.getElementById('btn-confirm-backup-action').disabled = true;

        let success = false;
        if (currentBackupAction === 'backup') {
            success = await criarBackup();
            if (success) {
                messageElement.textContent = 'Backup criado com sucesso!';
                messageElement.style.color = 'var(--success)';
                showCustomAlert("Backup criado com sucesso!", "success"); // ALERTA ADICIONADO
            } else {
                messageElement.textContent = 'Erro ao criar backup.';
                messageElement.style.color = 'var(--danger)';
                showCustomAlert("Erro ao criar backup.", "error"); // ALERTA ADICIONADO
            }
        } else if (currentBackupAction === 'restore') {
            success = await restaurarBackup();
            if (success) {
                messageElement.textContent = 'Backup restaurado com sucesso! Recarregando dados...';
                messageElement.style.color = 'var(--success)';
                // Após restaurar, recarrega todos os dados e atualiza a UI
                await carregarDadosAdmin();
                await loadLastBackupDate(); // Recarrega a data do último backup
                atualizarSelectVendedores();
                renderizarListaVendedoresModal(); // Atualiza a lista no modal
                atualizarSelectMunicoes();
                atualizarListaMunicoes();
                document.getElementById('webhook-url').value = discordWebhookUrl;
                document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
                document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
                // Não chama exibirArquivados() diretamente, pois agora é um modal
                showCustomAlert("Backup restaurado com sucesso!", "success"); // ALERTA ADICIONADO
            } else {
                messageElement.textContent = 'Erro ao restaurar backup.';
                messageElement.style.color = 'var(--danger)';
                showCustomAlert("Erro ao restaurar backup.", "error"); // ALERTA ADICIONADO
            }
        } else if (currentBackupAction === 'default') {
            success = await restaurarPadrao();
            if (success) {
                messageElement.textContent = 'Dados padrão restaurados com sucesso! Recarregando dados...';
                messageElement.style.color = 'var(--success)';
                // Após restaurar padrão, recarrega todos os dados e atualiza a UI
                await carregarDadosAdmin();
                await loadLastBackupDate(); // Recarrega a data do último backup (que deve ser nula)
                atualizarSelectVendedores();
                renderizarListaVendedoresModal(); // Atualiza a lista no modal
                atualizarSelectMunicoes();
                atualizarListaMunicoes();
                document.getElementById('webhook-url').value = discordWebhookUrl;
                document.getElementById('toggle-discord-send').checked = enviarReciboDiscord;
                document.getElementById('toggle-local-download').checked = baixarReciboLocalmente;
                // Não chama exibirArquivados() diretamente, pois agora é um modal
                showCustomAlert("Dados padrão restaurados com sucesso!", "success"); // ALERTA ADICIONADO
            } else {
                messageElement.textContent = 'Erro ao restaurar dados padrão.';
                messageElement.style.color = 'var(--danger)';
                showCustomAlert("Erro ao restaurar dados padrão.", "error"); // ALERTA ADICIONADO
            }
        }

        setTimeout(() => {
            closeBackupRestoreModal();
            document.getElementById('btn-confirm-backup-action').disabled = false;
        }, success ? 1500 : 3000); // Fecha mais rápido se for sucesso
    }
</script>
</body>
</html>
